<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìƒµ | TRAVEL SHIFT</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Noto Sans KR',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}
    .app-container{max-width:420px;margin:0 auto;background:#fff;min-height:100vh;box-shadow:0 0 20px rgba(0,0,0,.1)}
    .app-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:20px;text-align:center}
    .app-title{font-size:1.2em;font-weight:700;margin-bottom:6px}
    .app-subtitle{opacity:.95}
    .status-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #eee;background:#f8f9fa}
    .connection-status{display:flex;align-items:center;gap:8px;font-size:.85em}
    .status-dot{width:8px;height:8px;border-radius:50%}
    .status-online{background:#28a745}.status-offline{background:#dc3545}
    .main-content{padding:16px}
    .google-login{background:#fff;border:1px solid #eee;border-radius:12px;padding:18px}
    .login-btn{width:100%;background:#4285f4;color:#fff;border:none;border-radius:10px;padding:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px}
    .login-btn:hover{background:#3367d6}
    .user-info{display:none;align-items:center;gap:12px;padding:14px;background:#f8f9fa;border-radius:10px;margin-top:12px}
    .user-avatar{width:40px;height:40px;border-radius:50%;background:#667eea;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
    .menu-grid{display:none;grid-template-columns:1fr 1fr;gap:12px;margin:18px 0 6px}
    .menu-item{position:relative;background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;text-align:center;cursor:pointer;transition:.25s;box-shadow:0 2px 8px rgba(0,0,0,.06);overflow:hidden}
    .menu-item:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(0,0,0,.12)}
    .menu-item.active::before{left:0}
    .menu-item::before{content:"";position:absolute;inset:0;left:-100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);transition:.25s;z-index:0}
    .menu-item>*{position:relative;z-index:1}
    .menu-item.active,.menu-item.active .menu-icon{color:#fff;-webkit-text-fill-color:#fff}
    .menu-icon{font-size:2.2em;margin-bottom:8px;color:#667eea}
    .menu-title{font-size:.92em;font-weight:700}
    .menu-desc{font-size:.72em;color:#666;margin-top:6px}
    .app-translate{background:#fff;border:1px solid #eee;border-radius:12px;padding:14px}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000}
    .modal-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:12px;max-width:92%;width:360px;max-height:85%;overflow-y:auto}
    .close-btn{position:absolute;top:10px;right:12px;background:none;border:none;font-size:1.2em;cursor:pointer;color:#666}
    .modal-header{padding:18px 18px 0}
    .mbti-test{padding:18px}
    .question-card{background:#f8f9fa;border-radius:12px;padding:16px}
    .question-number{color:#667eea;font-weight:700;margin-bottom:8px}
    .question-text{line-height:1.5;margin-bottom:14px}
    .answer-btn{width:100%;background:#fff;border:2px solid #eee;border-radius:10px;padding:12px;text-align:left;margin-top:10px;cursor:pointer}
    .answer-btn:hover{border-color:#667eea;background:#f0f0ff}
    .answer-btn.selected{border-color:#667eea;background:#667eea;color:#fff}
    .progress-bar{height:4px;background:#eee;border-radius:2px;margin-bottom:12px}
    .progress-fill{height:100%;width:0;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:2px;transition:width .3s}
    .participants-list{max-height:320px;overflow:auto;padding:0 14px 14px}
    .participant-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid #eee}
    .participant-avatar{width:30px;height:30px;border-radius:50%;background:#667eea;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85em}
    .sync-btn{background:#667eea;color:#fff;border:none;border-radius:8px;padding:10px 12px;cursor:pointer}
    @media (max-width:480px){.app-container{max-width:100%}.menu-icon{font-size:2em}}
  </style>
</head>
<body>
  <div class="app-container">
    <div class="app-header">
      <div class="app-title">íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìƒµ</div>
      <div class="app-subtitle">TRAVEL SHIFT</div>
    </div>

    <div class="status-bar">
      <div class="connection-status">
        <div id="connectionDot" class="status-dot"></div>
        <span id="connectionText">ì—°ê²° í™•ì¸ ì¤‘...</span>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div id="lastSync">ë™ê¸°í™”: -</div>
        <button onclick="syncData()" title="ë°ì´í„° ë™ê¸°í™”" style="background:none;border:none;cursor:pointer;font-size:1.1em">ğŸ”„</button>
        <button id="logoutBtn" onclick="logout()" style="background:none;border:1px solid #ddd;border-radius:6px;padding:6px 10px;cursor:pointer">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div class="main-content">
      <div id="loginSection" class="google-login">
        <button id="googleLoginBtn" class="login-btn">
          <i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸
        </button>
        <p style="font-size:.82em;color:#666;margin-top:10px;text-align:center">
          ì›Œí¬ìƒµ ì°¸ì—¬ë¥¼ ìœ„í•´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤
        </p>
      </div>

      <div id="userInfo" class="user-info">
        <div id="userAvatar" class="user-avatar">U</div>
        <div class="user-details">
          <h4 id="userName" style="font-size:.98em;margin-bottom:2px">ì‚¬ìš©ì</h4>
          <p id="userEmail" style="font-size:.78em;color:#666">user@example.com</p>
        </div>
      </div>

      <div id="mainMenu" class="menu-grid">
        <div class="menu-item" data-action="participants" onclick="openModal('participantsModal')">
          <div class="menu-icon">ğŸ‘¥</div>
          <div class="menu-title">ì°¸ê°€ì í˜„í™©</div>
          <div class="menu-desc">ì‹¤ì‹œê°„ ì°¸ê°€ì ì •ë³´ í™•ì¸</div>
        </div>

        <div class="menu-item" data-action="schedule" onclick="openScheduleOptions()">
          <div class="menu-icon">ğŸ“…</div>
          <div class="menu-title">ì›Œí¬ìƒµ ì¼ì •</div>
          <div class="menu-desc">ìƒì„¸ ì¼ì • ë° í”„ë¡œê·¸ë¨</div>
        </div>

        <div class="menu-item" data-action="mbti" onclick="startMBTITest()">
          <div class="menu-icon">ğŸ§ </div>
          <div class="menu-title">MBTI ê²€ì‚¬</div>
          <div class="menu-desc">ì„±ê²© ìœ í˜• ê²€ì‚¬ ì‹¤ì‹œ</div>
        </div>

        <div class="menu-item" data-action="ticket" onclick="openTourpassTicket()">
          <div class="menu-icon">ğŸ«</div>
          <div class="menu-title">ì‚¬ìš© ì¤‘ì¸ íˆ¬ì–´íŒ¨ìŠ¤ ì—´ê¸°</div>
          <div class="menu-desc">ì§€ì •ëœ íˆ¬ì–´íŒ¨ìŠ¤ ë§í¬ ì—°ê²°</div>
        </div>

        <div class="menu-item" data-action="survey" onclick="openModal('surveyModal')">
          <div class="menu-icon">ğŸ“</div>
          <div class="menu-title">ì„¤ë¬¸ì¡°ì‚¬</div>
          <div class="menu-desc">ì›Œí¬ìƒµ ë§Œì¡±ë„ ì¡°ì‚¬</div>
        </div>

        <div class="menu-item" data-action="tourpassbox" onclick="openModal('tourpassBoxModal')">
          <div class="menu-icon">ğŸ“¦</div>
          <div class="menu-title">íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</div>
          <div class="menu-desc">ê°œì¸ ë§í¬ ì €ì¥ì†Œ</div>
        </div>
      </div>

      <div class="app-translate">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <h4>ğŸŒ ì•± ë²ˆì—­í•˜ê¸°</h4>
          <select id="languageSelect" onchange="translateApp()" style="padding:6px;border-radius:6px;border:1px solid #ddd">
            <option value="ko">í•œêµ­ì–´</option>
            <option value="en">English</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="zh">ä¸­æ–‡</option>
          </select>
        </div>
        <div style="font-size:.82em;color:#666">ì–¸ì–´ë¥¼ ì„ íƒí•˜ë©´ ì•± ì „ì²´ê°€ ë²ˆì—­ë©ë‹ˆë‹¤</div>
      </div>
    </div>
  </div>

  <!-- ì°¸ê°€ì ëª¨ë‹¬ -->
  <div id="participantsModal" class="modal">
    <div class="modal-content" style="width:680px;max-width:95%">
      <button class="close-btn" onclick="closeModal('participantsModal')">&times;</button>
      <div class="modal-header">
        <h3>ì°¸ê°€ì í˜„í™©</h3>
      </div>
      <div style="padding:14px 0">
        <div class="participants-list" id="participantsList"></div>
        <div style="padding:0 14px 14px">
          <button class="sync-btn" style="width:100%" onclick="showMBTIRelationshipIfReady()">
            <i class="fas fa-sitemap"></i> MBTI ê´€ê³„ë„ ë³´ê¸°
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MBTI ëª¨ë‹¬ -->
  <div id="mbtiModal" class="modal">
    <div class="modal-content" style="width:680px;max-width:95%">
      <button class="close-btn" onclick="closeMBTITest()">&times;</button>
      <div class="mbti-test">
        <div class="progress-bar"><div id="progressBar" class="progress-fill"></div></div>
        <div class="question-card">
          <div id="questionNumber" class="question-number">ì§ˆë¬¸ 1/10</div>
          <div id="questionText" class="question-text">ìƒˆë¡œìš´ ì‚¬ëŒì„ ë§Œë‚¬ì„ ë•Œ</div>
          <div id="answerOptions"></div>
        </div>
        <button id="nextBtn" onclick="nextQuestion()" style="display:none;background:#667eea;color:#fff;border:none;border-radius:8px;padding:12px 18px;cursor:pointer;margin-top:14px">
          ë‹¤ìŒ ì§ˆë¬¸
        </button>
      </div>
    </div>
  </div>

  <!-- ì„¤ë¬¸ ëª¨ë‹¬ -->
  <div id="surveyModal" class="modal">
    <div class="modal-content" style="width:680px;max-width:95%">
      <button class="close-btn" onclick="closeModal('surveyModal')">&times;</button>
      <div class="modal-header"><h3>ì›Œí¬ìƒµ ë§Œì¡±ë„ ì¡°ì‚¬</h3></div>
      <div style="padding:16px 18px 22px">
        <div id="surveyForm">
          <div style="margin-bottom:16px">
            <label style="display:block;margin-bottom:8px;font-weight:600">ì „ì²´ì ì¸ ë§Œì¡±ë„</label>
            <input id="satisfaction" type="range" min="1" max="5" value="3" style="width:100%" oninput="document.getElementById('satisfactionValue').textContent=this.value">
            <div style="text-align:center;margin-top:6px"><span id="satisfactionValue">3</span>/5</div>
          </div>
          <div style="margin-bottom:16px">
            <label style="display:block;margin-bottom:8px;font-weight:600">ê°€ì¥ ë§Œì¡±í–ˆë˜ í™œë™</label>
            <select id="bestActivity" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px">
              <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
              <option value="wonjun-tour">ì›ì¤€ë‹˜ì˜ ë„ìŠ¨íŠ¸ íˆ¬ì–´</option>
              <option value="accommodation">ìˆ™ì†Œ</option>
              <option value="chungnam-tourpass">ì¶©ë‚¨íˆ¬ì–´íŒ¨ìŠ¤ ì²´í—˜</option>
              <option value="food">ìŒì‹</option>
              <option value="performance-sharing">ì„±ê³¼ê³µìœ  ë° ë¹„ì „ê³µìœ </option>
            </select>
          </div>
          <div style="margin-bottom:16px">
            <label style="display:block;margin-bottom:8px;font-weight:600">ê°œì„  ì˜ê²¬ ë° í”¼ë“œë°±</label>
            <textarea id="feedback" placeholder="ììœ ë¡­ê²Œ ì˜ê²¬ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..." style="width:100%;height:90px;padding:10px;border:1px solid #ddd;border-radius:8px;resize:vertical"></textarea>
          </div>
          <button onclick="submitWorkshopSurvey()" class="sync-btn" style="width:100%">ì„¤ë¬¸ì¡°ì‚¬ ì œì¶œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨ -->
  <div id="tourpassBoxModal" class="modal">
    <div class="modal-content" style="width:680px;max-width:95%">
      <button class="close-btn" onclick="closeModal('tourpassBoxModal')">&times;</button>
      <div class="modal-header"><h3>ğŸ“¦ íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</h3></div>
      <div style="padding:16px 18px 22px">
        <div style="margin-bottom:14px">
          <button onclick="showAddLinkForm()" style="background:#28a745;color:#fff;border:none;border-radius:8px;padding:10px 14px;cursor:pointer">â• ìƒˆ ë§í¬ ì¶”ê°€</button>
        </div>
        <div id="addLinkForm" style="display:none;background:#f8f9fa;padding:14px;border-radius:10px;margin-bottom:14px">
          <h4 style="margin-bottom:10px">ğŸ”— ìƒˆ ë§í¬ ì¶”ê°€</h4>
          <div style="margin-bottom:8px">
            <label style="display:block;margin-bottom:6px;font-weight:600">ì œëª©</label>
            <input id="linkTitle" type="text" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px">
          </div>
          <div style="margin-bottom:8px">
            <label style="display:block;margin-bottom:6px;font-weight:600">URL</label>
            <input id="linkUrl" type="url" placeholder="https://example.com" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px">
          </div>
          <div style="margin-bottom:10px">
            <label style="display:block;margin-bottom:6px;font-weight:600">ë¹„ë°€ë²ˆí˜¸(ì„ íƒ)</label>
            <input id="linkPassword" type="password" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px">
          </div>
          <div style="display:flex;gap:8px">
            <button onclick="saveNewLink()" class="sync-btn">ğŸ’¾ ì €ì¥</button>
            <button onclick="cancelAddLink()" style="background:#6c757d;color:#fff;border:none;border-radius:8px;padding:10px 12px;cursor:pointer">âŒ ì·¨ì†Œ</button>
          </div>
        </div>
        <div id="linksList" style="max-height:320px;overflow:auto"></div>
      </div>
    </div>
  </div>

  <script>
    // ====== ì „ì—­ ======
    let currentUser = null;
    let isOnline = false;
    let currentQuestion = 0;
    let mbtiAnswers = [];

    // ğŸ”— GAS ì›¹ì•± URL (ë°°í¬ë³¸)
    const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyQyuXtoF6LOh7Ag8w1N9yVbTV9MecJSg16UyP5VSb1kt2SDplndvsxX6OpDgGIXiv8/exec';

    // ====== ê³µí†µ í†µì‹  í—¬í¼ ======
    async function callGoogleAppsScript(data, method = 'GET') {
      let url = GAS_WEB_APP_URL;
      const opts = { method };

      if (method === 'GET') {
        url += '?' + new URLSearchParams(data).toString();
      } else {
        opts.headers = { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' };
        opts.body = new URLSearchParams({ payload: JSON.stringify(data) }).toString();
      }

      const res = await fetch(url, opts);
      const text = await res.text();
      let result;
      try { result = JSON.parse(text); } catch(e){ throw new Error('ì„œë²„ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨'); }
      if (!result.success) throw new Error(result.data?.error || 'ì„œë²„ ì˜¤ë¥˜');
      return result.data;
    }

    // ====== ì—°ê²° ìƒíƒœ/ë™ê¸°í™” ======
    function updateConnectionStatus() {
      const dot = document.getElementById('connectionDot');
      const text = document.getElementById('connectionText');
      if (isOnline) {
        dot.className = 'status-dot status-online';
        text.textContent = 'ì˜¨ë¼ì¸';
      } else {
        dot.className = 'status-dot status-offline';
        text.textContent = 'ì˜¤í”„ë¼ì¸';
      }
    }

    function checkConnection() {
      isOnline = navigator.onLine;
      updateConnectionStatus();
      window.addEventListener('online', () => { isOnline = true; updateConnectionStatus(); syncData(); });
      window.addEventListener('offline', () => { isOnline = false; updateConnectionStatus(); });
    }

    async function checkBackendConnection() {
      try {
        await callGoogleAppsScript({ action: 'healthCheck' });
        return true;
      } catch {
        return false;
      }
    }

    function syncData() {
      const t = new Date().toLocaleTimeString();
      document.getElementById('lastSync').textContent = 'ë™ê¸°í™”: ' + t;
      // í•„ìš” ì‹œ GET ë°ì´í„° ë™ê¸°í™” ì¶”ê°€ ê°€ëŠ¥
    }

    // ====== ë¡œê·¸ì¸/ì„¸ì…˜ ======
    function logout() {
      localStorage.removeItem('tourpassUser');
      currentUser = null;
      document.getElementById('userInfo').style.display = 'none';
      document.getElementById('mainMenu').style.display = 'none';
      document.getElementById('loginSection').style.display = 'block';
    }

    function checkLoginStatus() {
      const savedUser = localStorage.getItem('tourpassUser');
      if (savedUser) {
        const u = JSON.parse(savedUser);
        if (confirm(`${u.name} (${u.email}) ì‚¬ìš©ìë¡œ ì´ì–´ì„œ ì´ìš©í•˜ì‹œê² ì–´ìš”?`)) {
          currentUser = u;
          showMainApp();
        } else {
          logout();
        }
      }
    }

    function importRecordsToLocal(records, user) {
      try {
        const existing = JSON.parse(localStorage.getItem('mbtiResults') || '[]')
          .filter(r => r.email !== user.email);
        if (records && records.mbtiLatest) {
          existing.push({
            name: records.mbtiLatest.name,
            email: records.mbtiLatest.email,
            mbtiType: records.mbtiLatest.mbtiType,
            timestamp: records.mbtiLatest.timestamp,
            team: user.team,
            position: user.position
          });
        }
        localStorage.setItem('mbtiResults', JSON.stringify(existing));
      } catch (e) {
        console.warn('importRecordsToLocal ì‹¤íŒ¨:', e);
      }
    }

    async function googleLogin() {
      const btn = document.getElementById('googleLoginBtn');
      try {
        btn.innerHTML = 'â³ ë¡œê·¸ì¸ ì¤‘...';
        let name = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
        if (!name) { btn.innerHTML = '<i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸'; return; }
        name = name.trim();

        let email = prompt('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:');
        if (!email) { btn.innerHTML = '<i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸'; return; }
        email = email.trim().toLowerCase();

        // 1) ê¸°ì¡´ ì‚¬ìš©ì ë²ˆë“¤ ì¡°íšŒ
        try {
          const found = await callGoogleAppsScript({ action: 'getUserBundle', name, email }, 'POST');
          if (found && found.user) {
            currentUser = {
              name: found.user.name,
              email: found.user.email,
              team: found.user.team,
              position: found.user.position,
              avatar: found.user.name.substring(0,1)
            };
            importRecordsToLocal(found.records, currentUser);
            alert(`${currentUser.name}ë‹˜, ê¸°ì¡´ ê¸°ë¡ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            showMainApp();
            btn.innerHTML = '<i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸';
            return;
          }
        } catch (e) {
          const msg = (e && e.message) || '';
          if (msg.includes('EMAIL_NAME_MISMATCH')) {
            alert('ì´ ì´ë©”ì¼ì€ ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆì–´ìš”. ê¸°ì¡´ ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ê±°ë‚˜ ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            btn.innerHTML = '<i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸';
            return;
          }
          // NOT_FOUNDë©´ ì‹ ê·œ ë“±ë¡ ì§„í–‰
        }

        // 2) ì‹ ê·œ ë“±ë¡(ë˜ëŠ” ë™ì¼ ì •ë³´ë©´ ê¸°ì¡´ ë°˜í™˜)
        const res = await callGoogleAppsScript({
          action: 'registerUser',
          name, email, team: 'íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€', position: 'ì§ì›'
        }, 'POST');

        const { user, records } = res;
        currentUser = {
          name: user.name, email: user.email,
          team: user.team, position: user.position,
          avatar: user.name.substring(0,1)
        };
        importRecordsToLocal(records, currentUser);
        showMainApp();
        btn.innerHTML = '<i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸';

      } catch (error) {
        console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
        alert('ë¡œê·¸ì¸ ì˜¤ë¥˜: ' + (error.message || error));
        btn.innerHTML = '<i class="fab fa-google"></i> ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸';
      }
    }

    function showMainApp() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('userInfo').style.display = 'flex';
      document.getElementById('mainMenu').style.display = 'grid';
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userAvatar').textContent = currentUser.avatar;
      localStorage.setItem('tourpassUser', JSON.stringify(currentUser));
      setTimeout(updateMBTIButtonState, 50);
      syncData();
    }

    // ====== ëª¨ë‹¬/ë©”ë‰´ ======
    function activateMenuButton(action){
      document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));
      const target = document.querySelector(`[data-action="${action}"]`);
      if (target) target.classList.add('active');
    }
    function deactivateMenuButton(action){
      const target = document.querySelector(`[data-action="${action}"]`);
      if (target) target.classList.remove('active');
    }
    function openModal(id){
      const action = id.replace('Modal','');
      activateMenuButton(action);
      document.getElementById(id).style.display='block';
      if (id==='participantsModal') renderParticipants();
      if (id==='tourpassBoxModal') updateLinksList();
    }
    function closeModal(id){
      const action = id.replace('Modal','');
      deactivateMenuButton(action);
      document.getElementById(id).style.display='none';
    }

    // ====== ì°¸ê°€ì ======
    function renderParticipants(){
      const participantsList = document.getElementById('participantsList');
      const local = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
      if (local.length === 0) {
        participantsList.innerHTML = '<div style="text-align:center;color:#666;padding:20px">í‘œì‹œí•  ì°¸ê°€ì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      participantsList.innerHTML = local
        .sort((a,b)=> (a.name||'').localeCompare(b.name||'','ko'))
        .map(p=>`
          <div class="participant-item">
            <div class="participant-avatar">${(p.name||'?').substring(0,1)}</div>
            <div>
              <div><strong>${p.name||'-'}</strong> ${p.mbtiType?`<span style="color:#667eea">[${p.mbtiType}]</span>`:''}</div>
              <div style="font-size:.8em;color:#666">${p.team||''} ${p.position||''}</div>
            </div>
          </div>
        `).join('');
    }

    function showMBTIRelationshipIfReady(){
      const list = JSON.parse(localStorage.getItem('mbtiResults')||'[]');
      const me = list.find(r=> r.email === currentUser.email);
      if (!me || list.length<2){
        alert('ê´€ê³„ë„ë¥¼ í‘œì‹œí•˜ë ¤ë©´ ë” ë§ì€ ì°¸ê°€ì MBTI ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      alert(`ë‹¹ì‹ (${me.mbtiType})ê³¼ íŒ€ì›ë“¤ì˜ ê´€ê³„ë„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. (ìƒ˜í”Œ UI)`);
      // ì‹¤ì œ ê´€ê³„ë„ UIëŠ” í•„ìš” ì‹œ ì¶”ê°€ êµ¬í˜„ ê°€ëŠ¥
    }

    // ====== MBTI ======
    const mbtiQuestions = [
      { q: 'ìƒˆë¡œìš´ ì‚¬ëŒì„ ë§Œë‚¬ì„ ë•Œ', a:[{t:'ë¨¼ì € ë‹¤ê°€ê°€ ë¶„ìœ„ê¸°ë¥¼ ì£¼ë„í•œë‹¤',k:'E'},{t:'ìƒëŒ€ê°€ ë¨¼ì € ë‹¤ê°€ì˜¤ê¸¸ ê¸°ë‹¤ë¦°ë‹¤',k:'I'}]},
      { q: 'ì£¼ë§ ê³„íšì´ ì·¨ì†Œë˜ì—ˆì„ ë•Œ', a:[{t:'ìƒˆ ì•½ì†ì„ ì¡ê±°ë‚˜ ë°–ì—ì„œ í™œë™',k:'E'},{t:'í˜¼ì ì‰¬ë©° ì¬ì¶©ì „',k:'I'}]},
      { q: 'ì—¬í–‰ ì¤€ë¹„ ìŠ¤íƒ€ì¼', a:[{t:'ì„¸ë¶€ ê³„íšì„ ì •ë¦¬í•´ì•¼ ì•ˆì‹¬',k:'J'},{t:'ëŒ€ëµë§Œ ì •í•˜ê³  í˜„ì§€ì—ì„œ ìœ ì—°í•˜ê²Œ',k:'P'}]},
      { q: 'ë¬¸ì œ ì ‘ê·¼', a:[{t:'ì‚¬ì‹¤/ë°ì´í„° ê¸°ë°˜',k:'S'},{t:'ê°€ëŠ¥ì„±/ê°€ì • íƒìƒ‰',k:'N'}]},
      { q: 'ì¹œêµ¬ê°€ í˜ë“¤ ë•Œ', a:[{t:'ê°ì • ê³µê° ë¨¼ì €',k:'F'},{t:'í•´ê²°ì±… ì œì‹œ ë¨¼ì €',k:'T'}]},
      { q: 'ìƒˆ í”„ë¡œì íŠ¸ ì°¸ì—¬', a:[{t:'ë‹¨ê³„ë³„ ê³„íšë¶€í„°',k:'J'},{t:'í° ë°©í–¥ ì¡ê³  ì¦‰ì‹œ ì‹œì‘',k:'P'}]},
      { q: 'íšŒì˜ ì¤‘ ë‚´ ëª¨ìŠµ', a:[{t:'ë…¼ë¦¬ë¡œ í† ë¡ /ë°˜ë°•',k:'T'},{t:'ë¶„ìœ„ê¸° ì¡°ìœ¨/ê³µê°',k:'F'}]},
      { q: 'ì •ë³´ ìŠµë“', a:[{t:'ì§ì ‘ ê²½í—˜/êµ¬ì²´ì  ì‚¬ì‹¤',k:'S'},{t:'ì§ê´€/ëŠë‚Œ',k:'N'}]},
      { q: 'ìƒˆ ë™ë£Œ ì…ì‚¬', a:[{t:'ë¨¼ì € ë§ì„ ê±¸ê³  ì¹œí•´ì§',k:'E'},{t:'í•„ìš”í•  ë•Œ ë„ì›€',k:'I'}]},
      { q: 'ì¤‘ìš”í•œ ì„ íƒ', a:[{t:'ê°ê´€/íš¨ìœ¨',k:'T'},{t:'ë§ˆìŒì˜ í¸ì•ˆí•¨',k:'F'}]},
    ];

    function startMBTITest(){
      const results = JSON.parse(localStorage.getItem('mbtiResults')||'[]');
      const my = results.find(r=> r.email===currentUser.email);
      if (my){
        if (confirm(`ì´ë¯¸ MBTIë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.\nê²°ê³¼: ${my.mbtiType}\nê´€ê³„ë„ë¥¼ ë³´ì‹œê² ì–´ìš”?`)){
          showMBTIRelationshipIfReady();
        }
        return;
      }
      window.mbtiStartTime = Date.now();
      currentQuestion = 0;
      mbtiAnswers = [];
      updateMBTIQuestion();
      openModal('mbtiModal');
    }

    function updateMBTIQuestion(){
      if (currentQuestion >= mbtiQuestions.length) { showMBTIResult(); return; }
      const q = mbtiQuestions[currentQuestion];
      document.getElementById('questionNumber').textContent = `ì§ˆë¬¸ ${currentQuestion+1}/${mbtiQuestions.length}`;
      document.getElementById('questionText').textContent = q.q;
      const box = document.getElementById('answerOptions');
      box.innerHTML = '';
      q.a.forEach((opt,idx)=>{
        const b = document.createElement('button');
        b.className='answer-btn';
        b.textContent = opt.t;
        b.onclick=()=>selectAnswer(idx);
        box.appendChild(b);
      });
      document.getElementById('progressBar').style.width = (currentQuestion/mbtiQuestions.length*100)+'%';
      document.getElementById('nextBtn').style.display='none';
    }

    function selectAnswer(i){
      document.querySelectorAll('.answer-btn').forEach(b=>b.classList.remove('selected'));
      document.querySelectorAll('.answer-btn')[i].classList.add('selected');
      mbtiAnswers[currentQuestion] = mbtiQuestions[currentQuestion].a[i];
      document.getElementById('nextBtn').style.display='inline-block';
    }

    function nextQuestion(){ currentQuestion++; updateMBTIQuestion(); }

    async function showMBTIResult(){
      const c = {E:0,I:0,S:0,N:0,T:0,F:0,J:0,P:0};
      mbtiAnswers.forEach(a=> c[a.k]++);
      const mbtiType =
        (c.E>c.I?'E':'I') + (c.S>c.N?'S':'N') + (c.T>c.F?'T':'F') + (c.J>c.P?'J':'P');
      const testDuration = Math.floor((Date.now()-window.mbtiStartTime)/1000);

      try{
        await callGoogleAppsScript({
          action:'saveMBTIResult',
          name: currentUser.name,
          email: currentUser.email,
          mbtiType,
          answers: mbtiAnswers,
          testDuration
        }, 'POST');

        // ë¡œì»¬ ì €ì¥(ì¤‘ë³µ ì œê±° í›„ ì¶”ê°€)
        const arr = JSON.parse(localStorage.getItem('mbtiResults')||'[]').filter(r=> r.email!==currentUser.email);
        arr.push({
          name: currentUser.name,
          email: currentUser.email,
          mbtiType,
          timestamp: new Date().toISOString(),
          team: currentUser.team,
          position: currentUser.position
        });
        localStorage.setItem('mbtiResults', JSON.stringify(arr));
        updateMBTIButtonState();

        alert(`MBTI ê²€ì‚¬ ì™„ë£Œ!\në‹¹ì‹ ì˜ ìœ í˜•: ${mbtiType}\nê²°ê³¼ê°€ ì„œë²„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);

        if (arr.length>1 && confirm('ë‹¤ë¥¸ ì°¸ê°€ìë“¤ê³¼ì˜ MBTI ê´€ê³„ë„ë¥¼ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
          showMBTIRelationshipIfReady();
        }
      } catch(e){
        console.error('MBTI ì €ì¥ ì‹¤íŒ¨:',e);
        alert(`MBTI: ${mbtiType}\nì„œë²„ ì €ì¥ì— ì‹¤íŒ¨í–ˆì§€ë§Œ ë¡œì»¬ì—ëŠ” ì €ì¥ë©ë‹ˆë‹¤.`);
        const arr = JSON.parse(localStorage.getItem('mbtiResults')||'[]').filter(r=> r.email!==currentUser.email);
        arr.push({
          name: currentUser.name,
          email: currentUser.email,
          mbtiType,
          timestamp: new Date().toISOString(),
          team: currentUser.team,
          position: currentUser.position
        });
        localStorage.setItem('mbtiResults', JSON.stringify(arr));
        updateMBTIButtonState();
      }
      closeMBTITest();
    }

    function updateMBTIButtonState(){
      const arr = JSON.parse(localStorage.getItem('mbtiResults')||'[]');
      const my = arr.find(r=> r.email===currentUser.email);
      const btn = document.querySelector('[data-action="mbti"]');
      if (!btn) return;
      if (my){
        btn.querySelector('.menu-title').textContent='MBTI ê²°ê³¼';
        btn.querySelector('.menu-desc').textContent=`ì™„ë£Œë¨: ${my.mbtiType}`;
        if (!btn.querySelector('.completed-badge')){
          const b = document.createElement('div');
          b.className='completed-badge';
          b.textContent='âœ“';
          b.style.cssText='position:absolute;top:6px;right:6px;background:#28a745;color:#fff;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:.75em;font-weight:700';
          btn.appendChild(b);
        }
      }
    }

    function closeMBTITest(){ closeModal('mbtiModal'); }

    // ====== ì„¤ë¬¸ ======
    async function submitWorkshopSurvey(){
      const satisfaction = document.getElementById('satisfaction').value;
      const bestActivity = document.getElementById('bestActivity').value;
      const feedback = document.getElementById('feedback').value;
      if (!bestActivity){ alert('ê°€ì¥ ë§Œì¡±í–ˆë˜ í™œë™ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

      try {
        await callGoogleAppsScript({
          action:'saveSurvey',
          name: currentUser.name,
          email: currentUser.email,
          satisfaction: parseInt(satisfaction,10),
          feedback,
          answers: { bestActivity, satisfactionLevel:satisfaction }
        }, 'POST');
        alert('ì„¤ë¬¸ì´ ì„œë²„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
      } catch(e){
        console.error('ì„¤ë¬¸ ì €ì¥ ì‹¤íŒ¨:',e);
        alert('ì„¤ë¬¸ ì €ì¥ ì‹¤íŒ¨: '+(e.message||e));
      }
      closeModal('surveyModal');
    }

    // ====== ì¼ì • ======
    function openScheduleOptions(){
      activateMenuButton('schedule');
      const html = `
        <div class="modal" id="scheduleOptionsModal" style="display:block">
          <div class="modal-content" style="width:420px">
            <button class="close-btn" onclick="closeScheduleOptions()">&times;</button>
            <div class="modal-header"><h3>ì›Œí¬ìƒµ ì¼ì • ì„ íƒ</h3></div>
            <div style="padding:16px">
              <div onclick="openScheduleLink('phase1')" style="display:flex;gap:12px;align-items:center;padding:12px;border:1px solid #eee;border-radius:10px;margin-bottom:12px;cursor:pointer">
                <i class="fas fa-graduation-cap" style="color:#28a745;font-size:1.3em"></i>
                <div><div style="font-weight:700">1ì°¨ ì—­ëŸ‰ê°•í™” ì›Œí¬ìƒµ</div></div>
              </div>
              <div onclick="openScheduleLink('phase2')" style="display:flex;gap:12px;align-items:center;padding:12px;border:1px solid #eee;border-radius:10px;margin-bottom:12px;cursor:pointer">
                <i class="fas fa-users" style="color:#667eea;font-size:1.3em"></i>
                <div><div style="font-weight:700">2ì°¨ ì†Œí†µê°•í™” ì›Œí¬ìƒµ (ìƒì„¸)</div></div>
              </div>
              <div onclick="openScheduleLink('phase3')" style="display:flex;gap:12px;align-items:center;padding:12px;border:1px solid #eee;border-radius:10px;cursor:pointer">
                <i class="fas fa-rocket" style="color:#fd7e14;font-size:1.3em"></i>
                <div><div style="font-weight:700">3ì°¨ ì„œë°‹/ì—‘ìŠ¤í¬ ì„¸ë¯¸ë‚˜</div></div>
              </div>
            </div>
          </div>
        </div>`;
      document.body.insertAdjacentHTML('beforeend', html);
    }

    function closeScheduleOptions(){
      const m = document.getElementById('scheduleOptionsModal');
      if (m) m.remove();
      deactivateMenuButton('schedule');
    }

    function openScheduleLink(phase){
      const links = {
        phase1: 'https://form.naver.com/response/ktPwJoHoW2VFRo8AUa6yrg',
        phase2: 'detailed', // ë‚´ë¶€ ìƒì„¸ í‘œì‹œ
        phase3: 'https://www.aisummit.co.kr/'
      };
      if (phase==='phase2'){ showDetailedSchedule(); }
      else if (links[phase]){ window.open(links[phase],'_blank'); }
      else { alert('ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.'); }
      closeScheduleOptions();
    }

    function showDetailedSchedule(){
      const html = `
        <div class="modal" id="detailedScheduleModal" style="display:block">
          <div class="modal-content" style="width:720px;max-width:95%">
            <button class="close-btn" onclick="closeDetailedSchedule()">&times;</button>
            <div class="modal-header"><h3>2ì°¨ ì†Œí†µê°•í™” ì›Œí¬ìƒµ ìƒì„¸ì¼ì •</h3></div>
            <div style="padding:16px 18px 22px">
              <div style="margin-bottom:16px;background:#f8f9fa;border-radius:10px;padding:12px">
                <h4 style="margin-bottom:8px;color:#667eea">1day</h4>
                <div class="schedule-item"><div class="time" style="width:60px;font-weight:700;color:#667eea">14:50</div><div class="activity" style="flex:1">ì½”ë¹„ ì§‘í•©</div><div class="location" style="width:140px;text-align:right;color:#666">ë¶€ì—¬ë°±ì œë§ˆë¦¬ì¡°íŠ¸</div></div>
                <div class="schedule-item"><div class="time">15:10</div><div class="activity">ì²´í¬ì¸ ë° ë°©ë°°ì •</div><div class="location">êµ¬ë“œë ˆì„ ì‹ë‹¹</div></div>
                <div class="schedule-item"><div class="time">15:50</div><div class="activity">ë¯¼ì†ì˜ ê°€ëŒê³¨ íƒë°©</div><div class="location">ë‚™í™”ì•”/ê³ ë€ì‚¬</div></div>
                <div class="schedule-item"><div class="time">18:30</div><div class="activity">ì €ë…ì‹ì‚¬</div><div class="location">ì„œë™í•œì˜¥</div></div>
              </div>
              <div style="background:#f8f9fa;border-radius:10px;padding:12px">
                <h4 style="margin-bottom:8px;color:#667eea">2day</h4>
                <div class="schedule-item"><div class="time" style="width:60px;font-weight:700;color:#667eea">11:00</div><div class="activity" style="flex:1">ë¸Œë¦¬í•‘ & ì ì‹¬</div><div class="location" style="width:140px;text-align:right;color:#666">í˜„ì¥</div></div>
                <div class="schedule-item"><div class="time">13:10</div><div class="activity">ì„±ê³¼ ê³µìœ  ì‹œê°„</div><div class="location">ì„¸ì…˜ë£¸</div></div>
                <div class="schedule-item"><div class="time">14:10</div><div class="activity">ë§ˆë¬´ë¦¬</div><div class="location">-</div></div>
              </div>
            </div>
          </div>
        </div>`;
      document.body.insertAdjacentHTML('beforeend', html);
    }
    function closeDetailedSchedule(){
      const m = document.getElementById('detailedScheduleModal');
      if (m) m.remove();
    }

    // ====== íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨ ======
    function showAddLinkForm(){ document.getElementById('addLinkForm').style.display='block'; document.getElementById('linkTitle').focus(); }
    function cancelAddLink(){ document.getElementById('addLinkForm').style.display='none'; clearLinkForm(); }
    function clearLinkForm(){ linkTitle.value=''; linkUrl.value=''; linkPassword.value=''; }
    function isValidUrl(s){ try{ new URL(s); return true; }catch{return false;} }

    function saveNewLink(){
      const title = linkTitle.value.trim();
      const url = linkUrl.value.trim();
      const password = linkPassword.value.trim();
      if (!title){ alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      if (!url || !isValidUrl(url)){ alert('ì˜¬ë°”ë¥¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      const links = JSON.parse(localStorage.getItem('tourpassLinks')||'[]');
      links.push({ id: Date.now(), title, url, password: password||null, createdAt: new Date().toISOString() });
      localStorage.setItem('tourpassLinks', JSON.stringify(links));
      updateLinksList();
      cancelAddLink();
      alert('ë§í¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function updateLinksList(){
      const list = document.getElementById('linksList');
      const links = JSON.parse(localStorage.getItem('tourpassLinks')||'[]');
      if (links.length===0){
        list.innerHTML = '<div style="text-align:center;color:#666;padding:28px"><i class="fas fa-inbox" style="font-size:2.2em;margin-bottom:12px"></i><div>ì €ì¥ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div></div>';
        return;
      }
      list.innerHTML = links.map(l=>`
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border:1px solid #eee;border-radius:10px;margin-bottom:10px">
          <div style="flex:1;min-width:0">
            <div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${l.title}</div>
            <div style="font-size:.82em;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${l.url}</div>
          </div>
          <div style="display:flex;gap:6px;margin-left:8px">
            <button onclick="setDefaultTourpass(${l.id})" title="ê¸°ë³¸ì„¤ì •" style="background:#28a745;color:#fff;border:none;border-radius:8px;padding:8px 10px;cursor:pointer;font-size:.82em">ê¸°ë³¸</button>
            <button onclick="openLink(${l.id})" title="ì—´ê¸°" style="background:#667eea;color:#fff;border:none;border-radius:8px;padding:8px 10px;cursor:pointer"><i class="fas fa-external-link-alt"></i></button>
          </div>
        </div>
      `).join('');
    }
    function openLink(id){
      const links = JSON.parse(localStorage.getItem('tourpassLinks')||'[]');
      const l = links.find(x=> x.id===id);
      if (l) window.open(l.url,'_blank');
    }
    function setDefaultTourpass(id){
      localStorage.setItem('defaultTourpass', id);
      alert('ê¸°ë³¸ íˆ¬ì–´íŒ¨ìŠ¤ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function openTourpassTicket(){
      activateMenuButton('ticket');
      const links = JSON.parse(localStorage.getItem('tourpassLinks')||'[]');
      if (links.length===0){ alert('ì €ì¥ëœ íˆ¬ì–´íŒ¨ìŠ¤ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë³´ê´€í•¨ì— ë§í¬ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.'); deactivateMenuButton('ticket'); return; }
      const def = localStorage.getItem('defaultTourpass');
      if (def){
        const d = links.find(l=> l.id == def);
        if (d && confirm(`ê¸°ë³¸ íˆ¬ì–´íŒ¨ìŠ¤ë¥¼ ì—´ê¹Œìš”?\n${d.title}`)){ openLink(d.id); deactivateMenuButton('ticket'); return; }
      }
      showTourpassSelector(links);
    }

    function showTourpassSelector(links){
      const html = `
        <div class="modal" id="tourpassSelectorModal" style="display:block">
          <div class="modal-content" style="width:520px;max-width:95%">
            <button class="close-btn" onclick="closeTourpassSelector()">&times;</button>
            <div class="modal-header"><h3>ğŸ« íˆ¬ì–´íŒ¨ìŠ¤ ì„ íƒ</h3></div>
            <div style="padding:16px">
              ${links.map(l=>`
                <div class="tourpass-item" style="display:flex;justify-content:space-between;align-items:center;padding:12px;border:1px solid #eee;border-radius:10px;margin-bottom:10px">
                  <div style="min-width:0">
                    <div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${l.title}</div>
                    <div style="font-size:.82em;color:#666;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${l.url}</div>
                  </div>
                  <div style="display:flex;gap:6px;margin-left:8px">
                    <button onclick="event.stopPropagation(); setDefaultTourpass(${l.id})" style="background:#28a745;color:#fff;border:none;border-radius:8px;padding:8px 10px;cursor:pointer;font-size:.8em">ê¸°ë³¸ì„¤ì •</button>
                    <button onclick="event.stopPropagation(); selectTourpass(${l.id})" style="background:#667eea;color:#fff;border:none;border-radius:8px;padding:8px 10px;cursor:pointer;font-size:.8em">ì—´ê¸°</button>
                  </div>
                </div>`).join('')}
            </div>
          </div>
        </div>`;
      document.body.insertAdjacentHTML('beforeend', html);
    }
    function selectTourpass(id){ openLink(id); closeTourpassSelector(); }
    function closeTourpassSelector(){
      const m = document.getElementById('tourpassSelectorModal');
      if (m) m.remove();
      deactivateMenuButton('ticket');
    }

    // ====== ë²ˆì—­ (ê°„ë‹¨) ======
    function translateApp(){
      const lang = document.getElementById('languageSelect').value;
      const map = {
        ko:{title:'íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìƒµ',sub:'TRAVEL SHIFT',login:'ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸',online:'ì˜¨ë¼ì¸',offline:'ì˜¤í”„ë¼ì¸',checking:'ì—°ê²° í™•ì¸ ì¤‘...',sync:'ë™ê¸°í™”: '},
        en:{title:'TourPass BU 2025 Workshop',sub:'TRAVEL SHIFT',login:'Sign in with name',online:'Online',offline:'Offline',checking:'Checking connection...',sync:'Sync: '},
        ja:{title:'ãƒ„ã‚¢ãƒ¼ãƒ‘ã‚¹äº‹æ¥­éƒ¨ 2025 ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—',sub:'TRAVEL SHIFT',login:'åå‰ã§ãƒ­ã‚°ã‚¤ãƒ³',online:'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³',offline:'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³',checking:'æ¥ç¶šç¢ºèªä¸­...',sync:'åŒæœŸ: '},
        zh:{title:'æ—…æ¸¸é€šè¡Œè¯äº‹ä¸šéƒ¨ 2025 ç ”ä¹ ç­',sub:'TRAVEL SHIFT',login:'ç”¨å§“åç™»å½•',online:'åœ¨çº¿',offline:'ç¦»çº¿',checking:'æ£€æŸ¥è¿æ¥ä¸­...',sync:'åŒæ­¥: '}
      };
      const t = map[lang]||map.ko;
      document.querySelector('.app-title').textContent = t.title;
      document.querySelector('.app-subtitle').textContent = t.sub;
      const ct = document.getElementById('connectionText').textContent;
      if (ct.includes('ì˜¨ë¼ì¸')||ct.includes('Online')||ct.includes('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³')||ct.includes('åœ¨çº¿')) document.getElementById('connectionText').textContent=t.online;
      else if (ct.includes('ì˜¤í”„ë¼ì¸')||ct.includes('Offline')||ct.includes('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³')||ct.includes('ç¦»çº¿')) document.getElementById('connectionText').textContent=t.offline;
      else document.getElementById('connectionText').textContent=t.checking;
      document.getElementById('googleLoginBtn').innerHTML = `<i class="fab fa-google"></i> ${t.login}`;
      const ls = document.getElementById('lastSync');
      const time = (ls.textContent.split(': ')[1])||'-';
      ls.textContent = t.sync + time;
      alert(lang==='ko'?'í•œêµ­ì–´ë¡œ ë²ˆì—­ë˜ì—ˆìŠµë‹ˆë‹¤':lang==='en'?'Translated to English':lang==='ja'?'æ—¥æœ¬èªã«ç¿»è¨³ã•ã‚Œã¾ã—ãŸ':'å·²ç¿»è¯‘ä¸ºä¸­æ–‡');
    }

    // ====== ì´ˆê¸°í™” ======
    async function initializeApp(){
      checkConnection();
      const ok = await checkBackendConnection();
      const dot = document.getElementById('connectionDot');
      if (ok){ dot.className='status-dot status-online'; document.getElementById('connectionText').textContent='ì˜¨ë¼ì¸'; }
      else { dot.className='status-dot status-offline'; document.getElementById('connectionText').textContent='ì˜¤í”„ë¼ì¸'; }
      checkLoginStatus();
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      initializeApp();
      document.getElementById('googleLoginBtn').addEventListener('click', googleLogin);
    });
  </script>
</body>
</html>
