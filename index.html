<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투어패스사업부 2025 워크샵 | TRAVEL SHIFT</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .app-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .status-bar {
            background: #f8f9fa;
            padding: 10px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .connection-status {
            display: flex;
            align-items: center;
            font-size: 0.8em;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }

        .main-content {
            padding: 20px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .menu-item {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: left 0.3s ease;
            z-index: 0;
        }

        .menu-item.active::before {
            left: 0;
        }

        .menu-item.active {
            color: white;
        }

        .menu-item.active .menu-icon {
            -webkit-text-fill-color: white;
            color: white;
        }

        .menu-item > * {
            position: relative;
            z-index: 1;
        }

        .menu-item:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .menu-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #667eea;
        }

        .menu-title {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .menu-desc {
            font-size: 0.7em;
            color: #666;
            line-height: 1.4;
        }

        .google-login {
            background: white;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .login-btn {
            width: 100%;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-btn:hover {
            background: #3367d6;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-details h4 {
            font-size: 0.9em;
            margin-bottom: 2px;
        }

        .user-details p {
            font-size: 0.7em;
            color: #666;
        }

        .app-translate {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 350px;
            width: 90%;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #666;
        }

        .participants-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .participant-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .participant-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 600;
        }

        .mbti-test {
            padding: 20px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1em;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-btn {
            background: white;
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .answer-btn:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .answer-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #eee;
            border-radius: 2px;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .schedule-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .link-item:hover {
            background: #f8f9fa;
        }

        .material-item:hover {
            background: #f0f0ff;
            border-color: #667eea;
        }

        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
            }
            
            .menu-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .menu-item {
                padding: 15px 10px;
            }
            
            .menu-icon {
                font-size: 2em;
            }
            
            .menu-title {
                font-size: 0.8em;
            }
            
            .menu-desc {
                font-size: 0.6em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="app-title">투어패스사업부 2025 워크샵</div>
            <div class="app-subtitle">TRAVEL SHIFT</div>
        </div>

        <div class="status-bar">
            <div class="connection-status">
                <div class="status-dot" id="connectionDot"></div>
                <span id="connectionText">연결 확인 중...</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <div id="lastSync">동기화: -</div>
                <button onclick="syncData()" style="background: none; border: none; color: #667eea; cursor: pointer; font-size: 1.1em;" title="데이터 동기화">
                    🔄
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="google-login" id="loginSection">
                <button class="login-btn" id="googleLoginBtn">
                    <i class="fab fa-google"></i>
                    이름으로 로그인
                </button>
                <p style="font-size: 0.8em; color: #666; margin-top: 10px; text-align: center;">
                    워크샵 참여를 로그인이 필요합니다
                </p>
            </div>

            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <h4 id="userName">사용자</h4>
                    <p id="userEmail">user@example.com</p>
                </div>
            </div>

            <div class="menu-grid" id="mainMenu" style="display: none;">
                <div class="menu-item" onclick="openModal('participantsModal')" data-action="participants">
                    <div class="menu-icon">👥</div>
                    <div class="menu-title">참가자 현황</div>
                    <div class="menu-desc">실시간 참가자 정보 확인</div>
                </div>

                <div class="menu-item" onclick="openScheduleOptions()" data-action="schedule">
                    <div class="menu-icon">📅</div>
                    <div class="menu-title">워크샵 일정</div>
                    <div class="menu-desc">상세 일정 및 프로그램</div>
                </div>

                <div class="menu-item" onclick="startMBTITest()" data-action="mbti">
                    <div class="menu-icon">🧠</div>
                    <div class="menu-title">MBTI 검사</div>
                    <div class="menu-desc">성격 유형 검사 실시</div>
                </div>

                <div class="menu-item" onclick="openTourpassTicket()" data-action="ticket">
                    <div class="menu-icon">🎫</div>
                    <div class="menu-title">사용 중인 투어패스 열기</div>
                    <div class="menu-desc">지정된 투어패스 링크 연결</div>
                </div>

                <div class="menu-item" onclick="openModal('surveyModal')" data-action="survey">
                    <div class="menu-icon">📝</div>
                    <div class="menu-title">설문조사</div>
                    <div class="menu-desc">워크샵 만족도 조사</div>
                </div>

                <div class="menu-item" onclick="openModal('tourpassBoxModal')" data-action="tourpassbox">
                    <div class="menu-icon">📦</div>
                    <div class="menu-title">투어패스 보관함</div>
                    <div class="menu-desc">개인 링크 저장소</div>
                </div>
            </div>

            <div class="app-translate">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4>🌐 앱 번역하기</h4>
                    <select id="languageSelect" onchange="translateApp()" style="padding: 5px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="ko">한국어</option>
                        <option value="en">English</option>
                        <option value="ja">日本語</option>
                        <option value="zh">中文</option>
                    </select>
                </div>
                <div style="font-size: 0.8em; color: #666;">
                    언어를 선택하면 앱 전체가 번역됩니다
                </div>
            </div>
        </div>
    </div>

    <!-- 참가자 현황 모달 -->
    <div class="modal" id="participantsModal">
        <div class="modal-content" style="max-width: 90%; max-height: 80%;">
            <button class="close-btn" onclick="closeModal('participantsModal')">&times;</button>
            <div class="modal-header">
                <h3>참가자 현황</h3>
            </div>
            <div style="padding: 20px;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button onclick="showParticipantsList()" id="participantsTab" class="tab-btn active" style="background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                        👥 참가자 목록
                    </button>
                    <button onclick="showRockPaperScissors()" id="gameTab" class="tab-btn" style="background: #f8f9fa; color: #333; border: 1px solid #ddd; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                        ✂️ 가위바위보
                    </button>
                </div>
                
                <!-- 참가자 목록 -->
                <div id="participantsContent">
                    <div class="participants-list" id="participantsList">
                        <div class="participant-item">
                            <div class="participant-avatar">남</div>
                            <div>
                                <div><strong>남도현</strong></div>
                                <div style="font-size: 0.8em; color: #666;">투어패스사업부 이사</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 가위바위보 게임 -->
                <div id="gameContent" style="display: none;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h4>가위바위보 게임</h4>
                        <p style="color: #666; font-size: 0.9em;">참가자를 선택하여 가위바위보를 해보세요!</p>
                    </div>
                    
                    <!-- 상대방 선택 -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 500;">대전 상대 선택:</label>
                        <select id="opponentSelect" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">상대를 선택하세요</option>
                        </select>
                    </div>
                    
                    <!-- 게임 영역 -->
                    <div id="gameArea" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="text-align: center;">
                                <div style="font-weight: 600;">나</div>
                                <div style="font-size: 4em; margin: 10px 0;" id="myChoice">❓</div>
                                <div id="myName" style="font-size: 0.9em; color: #666;"></div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-size: 2em; color: #667eea;">VS</div>
                            </div>
                            
                            <div style="text-align: center;">
                                <div style="font-weight: 600;">상대</div>
                                <div style="font-size: 4em; margin: 10px 0;" id="opponentChoice">❓</div>
                                <div id="opponentName" style="font-size: 0.9em; color: #666;"></div>
                            </div>
                        </div>
                        
                        <!-- 선택 버튼들 -->
                        <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;" id="choiceButtons">
                            <button onclick="makeChoice('rock')" style="background: #f8f9fa; border: 2px solid #ddd; border-radius: 8px; padding: 15px; cursor: pointer; font-size: 2em;">
                                ✊
                            </button>
                            <button onclick="makeChoice('paper')" style="background: #f8f9fa; border: 2px solid #ddd; border-radius: 8px; padding: 15px; cursor: pointer; font-size: 2em;">
                                ✋
                            </button>
                            <button onclick="makeChoice('scissors')" style="background: #f8f9fa; border: 2px solid #ddd; border-radius: 8px; padding: 15px; cursor: pointer; font-size: 2em;">
                                ✌️
                            </button>
                        </div>
                        
                        <!-- 결과 표시 -->
                        <div id="gameResult" style="display: none; text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
                            <div id="resultText" style="font-size: 1.2em; font-weight: 600; margin-bottom: 10px;"></div>
                            <div id="resultDetail" style="color: #666;"></div>
                        </div>
                        
                        <!-- 다시하기 버튼 -->
                        <div style="text-align: center;">
                            <button onclick="resetGame()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                                🔄 다시 하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MBTI 검사 모달 -->
    <div class="modal" id="mbtiModal">
        <div class="modal-content" style="max-width: 90%; max-height: 80%;">
            <button class="close-btn" onclick="closeMBTITest()">&times;</button>
            <div class="mbti-test">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="question-card">
                    <div class="question-number" id="questionNumber">질문 1/10</div>
                    <div class="question-text" id="questionText">
                        새로운 사람을 만났을 때
                    </div>
                    <div class="answer-options" id="answerOptions">
                        <button class="answer-btn" onclick="selectAnswer(0)">
                            먼저 다가가서 질문을 던지고 분위기를 주도한다
                        </button>
                        <button class="answer-btn" onclick="selectAnswer(1)">
                            상대가 먼저 다가오길 기다리며 관찰한다
                        </button>
                    </div>
                </div>
                <button id="nextBtn" onclick="nextQuestion()" style="display: none; background: #667eea; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; margin-top: 20px;">
                    다음 질문
                </button>
            </div>
        </div>
    </div>

    <!-- 설문조사 모달 -->
    <div class="modal" id="surveyModal">
        <div class="modal-content" style="max-width: 90%; max-height: 80%;">
            <button class="close-btn" onclick="closeModal('surveyModal')">&times;</button>
            <div class="modal-header">
                <h3>워크샵 만족도 조사</h3>
            </div>
            <div style="padding: 20px; max-height: 400px; overflow-y: auto;">
                <div id="surveyForm">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 500;">전체적인 만족도</label>
                        <input type="range" id="satisfaction" min="1" max="5" value="3" style="width: 100%;" oninput="document.getElementById('satisfactionValue').textContent = this.value">
                        <div style="text-align: center; margin-top: 5px;">
                            <span id="satisfactionValue">3</span>/5
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 500;">가장 만족했던 활동</label>
                        <select id="bestActivity" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">선택해주세요</option>
                            <option value="wonjun-tour">원준님의 도슨트 투어</option>
                            <option value="accommodation">숙소</option>
                            <option value="chungnam-tourpass">충남투어패스 체험</option>
                            <option value="food">음식</option>
                            <option value="performance-sharing">성과공유 및 비전공유</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 500;">개선 의견 및 피드백</label>
                        <textarea id="feedback" placeholder="자유롭게 의견을 작성해주세요..." style="width: 100%; height: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
                    </div>
                    
                    <button onclick="submitWorkshopSurvey()" style="width: 100%; background: #667eea; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">
                        설문조사 제출
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 투어패스 보관함 모달 -->
    <div class="modal" id="tourpassBoxModal">
        <div class="modal-content" style="max-width: 90%; max-height: 80%;">
            <button class="close-btn" onclick="closeModal('tourpassBoxModal')">&times;</button>
            <div class="modal-header">
                <h3>📦 투어패스 보관함</h3>
            </div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <button onclick="showAddLinkForm()" style="background: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                        ➕ 새 링크 추가
                    </button>
                </div>
                
                <!-- 링크 추가 폼 (숨김 상태) -->
                <div id="addLinkForm" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">🔗 새 링크 추가</h4>
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">제목:</label>
                        <input type="text" id="linkTitle" placeholder="링크 제목을 입력하세요" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">URL:</label>
                        <input type="url" id="linkUrl" placeholder="https://example.com" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">비밀번호 (선택사항):</label>
                        <input type="password" id="linkPassword" placeholder="링크 보호용 비밀번호" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="saveNewLink()" style="background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                            💾 저장
                        </button>
                        <button onclick="cancelAddLink()" style="background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                            ❌ 취소
                        </button>
                    </div>
                </div>
                
                <div id="linksList" style="max-height: 300px; overflow-y: auto;">
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentUser = null;
        let isOnline = false;
        let currentQuestion = 0;
        let mbtiAnswers = [];
        
        // Google Apps Script 웹앱 URL - 실제 배포 ID로 업데이트
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyQyuXtoF6LOh7Ag8w1N9yVbTV9MecJSg16UyP5VSb1kt2SDplndvsxX6OpDgGIXiv8/exec';
        
        // API 호출 개선 함수
async function callGoogleAppsScript(data, method = 'GET') {
  let url = GAS_WEB_APP_URL;
  const opts = { method };

  if (method === 'GET') {
    url += '?' + new URLSearchParams(data).toString();
  } else {
    // application/json 대신 폼 인코딩 사용 → OPTIONS 안 뜸
    opts.headers = { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' };
    opts.body = new URLSearchParams({ payload: JSON.stringify(data) }).toString();
  }

  const res = await fetch(url, opts);
  const text = await res.text();
  const result = JSON.parse(text);
  if (!result.success) throw new Error(result.data?.error || '서버 오류');
  return result.data;
}

        
        // MBTI 질문 배열 (문자열 안전하게 처리)
        const mbtiQuestions = [
            {
                question: "새로운 사람을 만났을 때",
                answers: [
                    { text: "먼저 다가가서 질문을 던지고 분위기를 주도한다", type: "E" },
                    { text: "상대가 먼저 다가오길 기다리며 관찰한다", type: "I" }
                ]
            },
            {
                question: "주말 계획이 갑자기 취소되었을 때",
                answers: [
                    { text: "다른 사람과 새 약속을 잡거나 밖에서 활동한다", type: "E" },
                    { text: "혼자만의 시간을 즐기며 책이나 넷플릭스 등으로 쉰다", type: "I" }
                ]
            },
            {
                question: "여행 준비 스타일",
                answers: [
                    { text: "날짜, 숙소, 일정을 세부적으로 기록해야 안심된다", type: "J" },
                    { text: "목적지만 정하고 현지에서 상황에 맞게 움직인다", type: "P" }
                ]
            },
            {
                question: "문제 해결 접근법",
                answers: [
                    { text: "실제로 일어난 사실과 데이터를 기반으로 생각한다", type: "S" },
                    { text: "만약에 라는 가정을 세우고 가능성을 탐색한다", type: "N" }
                ]
            },
            {
                question: "친구가 힘든 일을 겪을 때",
                answers: [
                    { text: "그건 정말 속상했겠다 하고 감정을 먼저 공감한다", type: "F" },
                    { text: "그럼 이렇게 해결해보는 건 어때 하고 방법을 제시한다", type: "T" }
                ]
            },
            {
                question: "새로운 프로젝트에 참여할 때",
                answers: [
                    { text: "목표 달성까지의 단계별 계획을 먼저 만든다", type: "J" },
                    { text: "전체 그림과 방향성만 잡고 즉시 시작한다", type: "P" }
                ]
            },
            {
                question: "회의 중 내 모습",
                answers: [
                    { text: "다른 사람의 의견에 논리적으로 반박하며 토론한다", type: "T" },
                    { text: "분위기를 부드럽게 만들며 모두가 동의할 수 있게 돕는다", type: "F" }
                ]
            },
            {
                question: "정보 습득 방식",
                answers: [
                    { text: "직접 경험하거나 구체적인 사실을 봐야 믿는다", type: "S" },
                    { text: "직관적으로 이건 될 것 같다 라는 느낌을 따른다", type: "N" }
                ]
            },
            {
                question: "직장에서 새로운 동료가 들어왔을 때",
                answers: [
                    { text: "먼저 말을 걸고 친해지며 팀 분위기를 이끈다", type: "E" },
                    { text: "조용히 지켜보다가 필요할 때 도움을 준다", type: "I" }
                ]
            },
            {
                question: "중요한 선택을 할 때",
                answers: [
                    { text: "객관적 기준과 결과의 효율성을 따진다", type: "T" },
                    { text: "나와 주변 사람의 마음이 편한지를 먼저 고려한다", type: "F" }
                ]
            }
        ];

// 구글 로그인(데모용) - 기존 사용자 기록 불러오기 기능 추가
async function googleLogin() {
  const btn = document.getElementById('googleLoginBtn');
  try {
    btn.innerHTML = '⏳ 로그인 중...';

    const name = prompt('이름을 입력하세요:');
    if (!name) { btn.innerHTML = '이름으로 로그인'; return; }

    const email = prompt('이메일을 입력하세요:');
    if (!email) { btn.innerHTML = '이름으로 로그인'; return; }

    // 1) 먼저 기존 참가자 목록 조회
    let existingUser = null;
    try {
      const check = await callGoogleAppsScript({ action: 'getParticipants' });
      if (check.participants) {
        existingUser = check.participants.find(p =>
          p.name === name && p.email === email
        );
      }
    } catch (e) {
      console.warn('참가자 조회 실패:', e.message);
    }

    if (existingUser) {
      // 2) 기존 사용자면 그대로 로그인
      currentUser = {
        name: existingUser.name,
        email: existingUser.email,
        team: existingUser.team,
        position: existingUser.position,
        avatar: existingUser.name.substring(0, 1)
      };
      alert(`${name}님, 기존 기록으로 로그인되었습니다.`);
      showMainApp();
      return;
    }

    // 3) 신규 사용자 등록
    const userData = {
      action: 'registerUser',
      name: name,
      email: email,
      team: '투어패스사업부',
      position: '직원'
    };

    const response = await callGoogleAppsScript(userData, 'POST');
    currentUser = {
      name: response.user.name,
      email: response.user.email,
      team: response.user.team,
      position: response.user.position,
      avatar: response.user.name.substring(0, 1)
    };

    showMainApp();

  } catch (error) {
    alert('로그인 실패: ' + error.message);
  } finally {
    btn.innerHTML = '이름으로 로그인';
  }
}

        // 실제 백엔드와 연동한 데이터 동기화
        async function syncData() {
            const syncBtn = document.querySelector('button[onclick="syncData()"]');
            if (syncBtn) {
                syncBtn.innerHTML = '⏳';
                syncBtn.style.animation = 'spin 2s linear infinite';
            }
            
            try {
                // 참가자 목록 동기화
                const participantsData = await callGoogleAppsScript({action: 'getParticipants'});
                if (participantsData.participants) {
                    updateParticipantsList(participantsData.participants);
                }
                
                // MBTI 결과 동기화  
                const mbtiData = await callGoogleAppsScript({action: 'getMBTIResults'});
                if (mbtiData.results) {
                    // 로컬 스토리지 업데이트
                    localStorage.setItem('mbtiResults', JSON.stringify(mbtiData.results));
                }
                
                const now = new Date().toLocaleTimeString('ko-KR');
                document.getElementById('lastSync').textContent = '동기화: ' + now;
                
            } catch (error) {
                console.error('동기화 실패:', error);
                alert('데이터 동기화에 실패했습니다. 백엔드 연결을 확인해주세요.');
            } finally {
                if (syncBtn) {
                    syncBtn.innerHTML = '🔄';
                    syncBtn.style.animation = 'none';
                }
            }
        }

        // MBTI 결과 실제 저장
        async function showMBTIResult() {
            const counts = {E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0};
            
            mbtiAnswers.forEach(function(answer) {
                counts[answer.type]++;
            });
            
            const E_I = counts.E > counts.I ? 'E' : 'I';
            const S_N = counts.S > counts.N ? 'S' : 'N';
            const T_F = counts.T > counts.F ? 'T' : 'F';
            const J_P = counts.J > counts.P ? 'J' : 'P';
            
            const mbtiType = E_I + S_N + T_F + J_P;
            const testDuration = Math.floor((Date.now() - window.mbtiStartTime) / 1000);
            
            try {
                // 백엔드에 MBTI 결과 저장
                const resultData = {
                    action: 'saveMBTIResult',
                    name: currentUser.name,
                    email: currentUser.email,
                    mbtiType: mbtiType,
                    answers: mbtiAnswers,
                    testDuration: testDuration
                };
                
                await callGoogleAppsScript(resultData, 'POST');
                
                // 로컬 스토리지에도 저장
                const mbtiResults = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
                const userResult = {
                    name: currentUser.name,
                    email: currentUser.email,
                    mbtiType: mbtiType,
                    timestamp: new Date().toISOString(),
                    team: currentUser.team,
                    position: currentUser.position
                };
                
                // 중복 제거 후 추가
                const filteredResults = mbtiResults.filter(r => r.email !== currentUser.email);
                filteredResults.push(userResult);
                localStorage.setItem('mbtiResults', JSON.stringify(filteredResults));
                
                // 버튼 상태 업데이트
                updateMBTIButtonState();
                
                const descriptions = {
                    'INTJ': '건축가 - 상상력이 풍부하고 전략적인 사고를 하는 성격',
                    'INTP': '논리술사 - 지식을 갈망하는 혁신적인 발명가',
                    'ENTJ': '통솔자 - 대담하고 상상력이 풍부한 강력한 의지의 지도자',
                    'ENTP': '변론가 - 똑똑하고 호기심이 많은 사색가',
                    'INFJ': '옹호자 - 선의의 목적과 의미를 추구하는 이상주의자',
                    'INFP': '중재자 - 항상 선을 행할 준비가 되어 있는 시적이고 친절한 이타주의자',
                    'ENFJ': '선도자 - 카리스마 넘치고 영감을 주는 지도자',
                    'ENFP': '활동가 - 열정적이고 창의적인 사회자',
                    'ISTJ': '논리주의자 - 실용적이고 사실에 기반한 신뢰할 수 있는 성격',
                    'ISFJ': '수호자 - 따뜻한 마음과 헌신적인 성격',
                    'ESTJ': '경영자 - 훌륭한 관리자이며 규칙이나 전통을 중시하는 성격',
                    'ESFJ': '집정관 - 배려심이 많고 사교적이며 인기가 높은 성격',
                    'ISTP': '만능재주꾼 - 대담하면서도 현실적인 사고를 하는 실험정신이 강한 성격',
                    'ISFP': '모험가 - 유연하고 매력적인 예술가 기질의 성격',
                    'ESTP': '사업가 - 영리하고 에너지 넘치며 현실 감각이 뛰어난 성격',
                    'ESFP': '연예인 - 즉흥적이고 열정적이며 사람과 어울리기 좋아하는 성격'
                };
                
                alert('MBTI 검사 완료!\n\n당신의 성격 유형: ' + mbtiType + '\n' + (descriptions[mbtiType] || '') + '\n\n결과가 서버에 저장되었습니다!');
                
                // 관계도 보기 여부 확인
                if (filteredResults.length > 1 && confirm('다른 참가자들과의 MBTI 관계도를 확인하시겠습니까?')) {
                    setTimeout(() => showMBTIRelationship(), 500);
                }
                
            } catch (error) {
                console.error('MBTI 결과 저장 실패:', error);
                
                // 백엔드 저장 실패 시 로컬에만 저장
                const mbtiResults = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
                const userResult = {
                    name: currentUser.name,
                    email: currentUser.email,
                    mbtiType: mbtiType,
                    timestamp: new Date().toISOString(),
                    team: currentUser.team,
                    position: currentUser.position
                };
                
                const filteredResults = mbtiResults.filter(r => r.email !== currentUser.email);
                filteredResults.push(userResult);
                localStorage.setItem('mbtiResults', JSON.stringify(filteredResults));
                
                updateMBTIButtonState();
                
                alert('MBTI 검사 완료!\n당신의 유형: ' + mbtiType + '\n\n백엔드 저장에 실패했지만 로컬에 저장되었습니다.');
            }
            
            closeMBTITest();
        }

        // 설문조사 실제 저장
        async function submitWorkshopSurvey() {
            const satisfaction = document.getElementById('satisfaction').value;
            const bestActivity = document.getElementById('bestActivity').value;
            const feedback = document.getElementById('feedback').value;
            
            if (!bestActivity) {
                alert('가장 만족했던 활동을 선택해주세요.');
                return;
            }
            
            try {
                const surveyData = {
                    action: 'saveSurvey',
                    name: currentUser.name,
                    email: currentUser.email,
                    satisfaction: parseInt(satisfaction),
                    feedback: feedback,
                    answers: {
                        bestActivity: bestActivity,
                        satisfactionLevel: satisfaction
                    }
                };
                
                await callGoogleAppsScript(surveyData, 'POST');
                alert('설문조사가 서버에 저장되었습니다. 감사합니다!');
                
            } catch (error) {
                console.error('설문 저장 실패:', error);
                alert('설문 저장에 실패했습니다: ' + error.message);
            }
            
            closeModal('surveyModal');
        }

        // 백엔드 연결 상태 확인
        async function checkBackendConnection() {
            try {
                await callGoogleAppsScript({action: 'healthCheck'});
                console.log('백엔드 연결 성공');
                return true;
            } catch (error) {
                console.warn('백엔드 연결 실패 - 오프라인 모드로 작동:', error.message);
                return false;
            }
        }

        // 앱 초기화 개선
        async function initializeApp() {
            checkConnection();
            
            // 백엔드 연결 확인
            const backendConnected = await checkBackendConnection();
            
            if (!backendConnected) {
                // 백엔드 미연결 시 알림
                const statusElement = document.getElementById('connectionText');
                if (statusElement) {
                    statusElement.textContent = '오프라인 모드';
                    document.getElementById('connectionDot').className = 'status-dot status-offline';
                }
            }
            
            checkLoginStatus();
        }

        // 연결 상태 확인
        function checkConnection() {
            isOnline = navigator.onLine;
            updateConnectionStatus();
            
            window.addEventListener('online', function() {
                isOnline = true;
                updateConnectionStatus();
                syncData();
            });
            
            window.addEventListener('offline', function() {
                isOnline = false;
                updateConnectionStatus();
            });
        }

        function updateConnectionStatus() {
            const dot = document.getElementById('connectionDot');
            const text = document.getElementById('connectionText');
            
            if (isOnline) {
                dot.className = 'status-dot status-online';
                text.textContent = '온라인';
            } else {
                dot.className = 'status-dot status-offline';
                text.textContent = '오프라인';
            }
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('tourpassUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        }

        function showMainApp() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('mainMenu').style.display = 'grid';
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            
            localStorage.setItem('tourpassUser', JSON.stringify(currentUser));
            
            // MBTI 버튼 상태 업데이트
            setTimeout(updateMBTIButtonState, 100);
            
            syncData();
        }

        // 모달 관리
        function activateMenuButton(action) {
            document.querySelectorAll('.menu-item').forEach(function(item) {
                item.classList.remove('active');
            });
            
            const targetButton = document.querySelector('[data-action="' + action + '"]');
            if (targetButton) {
                targetButton.classList.add('active');
            }
        }

        function deactivateMenuButton(action) {
            const targetButton = document.querySelector('[data-action="' + action + '"]');
            if (targetButton) {
                targetButton.classList.remove('active');
            }
        }

        function openModal(modalId) {
            const action = modalId.replace('Modal', '');
            activateMenuButton(action);
            document.getElementById(modalId).style.display = 'block';
            
            if (modalId === 'tourpassBoxModal') {
                updateLinksList();
            }
        }

        function closeModal(modalId) {
            const action = modalId.replace('Modal', '');
            deactivateMenuButton(action);
            document.getElementById(modalId).style.display = 'none';
        }

        // MBTI 검사 시작 전 완료 여부 확인
        function startMBTITest() {
            // 이미 완료했는지 확인
            const mbtiResults = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
            const userResult = mbtiResults.find(r => r.email === currentUser.email);
            
            if (userResult) {
                if (confirm(`이미 MBTI 검사를 완료했습니다.\n결과: ${userResult.mbtiType}\n\n관계도를 다시 확인하시겠습니까?`)) {
                    showMBTIRelationship();
                }
                return;
            }
            
            // 새로운 검사 시작
            window.mbtiStartTime = Date.now();
            currentQuestion = 0;
            mbtiAnswers = [];
            updateMBTIQuestion();
            openModal('mbtiModal');
        }

        // 메뉴에서 MBTI 버튼 상태 업데이트
        function updateMBTIButtonState() {
            const mbtiResults = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
            const userResult = mbtiResults.find(r => r.email === currentUser.email);
            const mbtiButton = document.querySelector('[data-action="mbti"]');
            
            if (mbtiButton && userResult) {
                const titleElement = mbtiButton.querySelector('.menu-title');
                const descElement = mbtiButton.querySelector('.menu-desc');
                
                titleElement.textContent = 'MBTI 결과';
                descElement.textContent = `완료됨: ${userResult.mbtiType}`;
                
                // 완료 표시 아이콘 추가
                mbtiButton.style.position = 'relative';
                if (!mbtiButton.querySelector('.completed-badge')) {
                    const badge = document.createElement('div');
                    badge.className = 'completed-badge';
                    badge.innerHTML = '✓';
                    badge.style.cssText = `
                        position: absolute;
                        top: 5px;
                        right: 5px;
                        background: #28a745;
                        color: white;
                        border-radius: 50%;
                        width: 20px;
                        height: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 0.7em;
                        font-weight: bold;
                        z-index: 2;
                    `;
                    mbtiButton.appendChild(badge);
                }
            }
        }

        function updateMBTIQuestion() {
            if (currentQuestion >= mbtiQuestions.length) {
                showMBTIResult();
                return;
            }

            const question = mbtiQuestions[currentQuestion];
            document.getElementById('questionNumber').textContent = '질문 ' + (currentQuestion + 1) + '/' + mbtiQuestions.length;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            question.answers.forEach(function(answer, index) {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer.text;
                button.onclick = function() { selectAnswer(index); };
                optionsContainer.appendChild(button);
            });

            const progress = (currentQuestion / mbtiQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectAnswer(answerIndex) {
            document.querySelectorAll('.answer-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            
            document.querySelectorAll('.answer-btn')[answerIndex].classList.add('selected');
            
            const question = mbtiQuestions[currentQuestion];
            mbtiAnswers[currentQuestion] = question.answers[answerIndex];
            
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            currentQuestion++;
            updateMBTIQuestion();
        }

        // MBTI 관계도 표시
        function showMBTIRelationship() {
            const mbtiResults = JSON.parse(localStorage.getItem('mbtiResults') || '[]');
            const currentUserMBTI = mbtiResults.find(r => r.email === currentUser.email);
            
            if (!currentUserMBTI || mbtiResults.length < 2) {
                alert('관계도를 표시하기 위해서는 더 많은 참가자의 MBTI 검사가 필요합니다.');
                return;
            }
            
            const relationshipHTML = createMBTIRelationshipHTML(currentUserMBTI, mbtiResults);
            document.body.insertAdjacentHTML('beforeend', relationshipHTML);
        }

        function createMBTIRelationshipHTML(currentUser, allResults) {
            const relationships = calculateMBTIRelationships(currentUser, allResults);
            
            return `
                <div class="modal" id="mbtiRelationshipModal" style="display: block;">
                    <div class="modal-content" style="max-width: 95%; max-height: 90%; overflow-y: auto;">
                        <button class="close-btn" onclick="closeMBTIRelationship()">&times;</button>
                        <div class="modal-header">
                            <h3>${currentUser.name}님의 MBTI 관계도</h3>
                            <p style="color: #667eea; font-weight: 500;">당신의 유형: ${currentUser.mbtiType}</p>
                        </div>
                        <div style="padding: 20px;">
                            ${relationships.map(category => `
                                <div class="relationship-category" style="margin-bottom: 25px;">
                                    <h4 style="background: ${category.color}; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center;">
                                        <span style="font-size: 1.2em; margin-right: 8px;">${category.emoji}</span>
                                        ${category.title} (${category.members.length}명)
                                    </h4>
                                    <div style="background: ${category.bgColor}; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                        <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">${category.description}</p>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                                            ${category.members.map(member => `
                                                <div class="member-card" style="background: white; padding: 12px; border-radius: 6px; border-left: 4px solid ${category.color};">
                                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                                        <div>
                                                            <strong>${member.name}</strong>
                                                            <div style="font-size: 0.8em; color: #666;">${member.team || ''} ${member.position || ''}</div>
                                                        </div>
                                                        <div style="background: ${category.color}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold;">
                                                            ${member.mbtiType}
                                                        </div>
                                                    </div>
                                                    <div style="margin-top: 8px; font-size: 0.8em; color: #666;">
                                                        궁합도: ${member.compatibilityScore}%
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <div class="mbti-statistics" style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 20px;">
                                <h4 style="margin-bottom: 15px; color: #333;">팀 MBTI 통계</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    ${generateMBTIStatistics(allResults)}
                                </div>
                            </div>
                            
                            <div class="team-building-tips" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-top: 20px;">
                                <h4 style="margin-bottom: 15px;">팀워크 향상 팁</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                    ${generateTeamBuildingTips(currentUser.mbtiType)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                .relationship-category {
                    animation: fadeInUp 0.5s ease-out;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .member-card {
                    transition: transform 0.2s ease;
                }
                
                .member-card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                }
                </style>
            `;
        }

        function calculateMBTIRelationships(currentUser, allResults) {
            const others = allResults.filter(r => r.email !== currentUser.email);
            
            const relationships = {
                perfect: [],
                great: [],
                good: [],
                okay: [],
                challenging: []
            };
            
            others.forEach(other => {
                const compatibility = getMBTICompatibility(currentUser.mbtiType, other.mbtiType);
                const member = {
                    ...other,
                    compatibilityScore: compatibility.score
                };
                
                if (compatibility.score >= 95) {
                    relationships.perfect.push(member);
                } else if (compatibility.score >= 85) {
                    relationships.great.push(member);
                } else if (compatibility.score >= 70) {
                    relationships.good.push(member);
                } else if (compatibility.score >= 60) {
                    relationships.okay.push(member);
                } else {
                    relationships.challenging.push(member);
                }
            });
            
            return [
                {
                    title: '환상의 궁합',
                    emoji: '💖',
                    color: '#e91e63',
                    bgColor: '#fce4ec',
                    members: relationships.perfect,
                    description: '가장 이상적인 관계입니다. 서로를 완벽하게 보완하며 자연스럽게 조화를 이룹니다.'
                },
                {
                    title: '최고의 파트너',
                    emoji: '🌟',
                    color: '#ff9800',
                    bgColor: '#fff3e0',
                    members: relationships.great,
                    description: '매우 좋은 관계입니다. 서로에게 긍정적인 영향을 주며 함께 성장할 수 있습니다.'
                },
                {
                    title: '좋은 협력자',
                    emoji: '🤝',
                    color: '#4caf50',
                    bgColor: '#e8f5e8',
                    members: relationships.good,
                    description: '원활한 협력이 가능한 관계입니다. 서로의 차이점을 인정하며 잘 어울립니다.'
                },
                {
                    title: '평범한 관계',
                    emoji: '😊',
                    color: '#2196f3',
                    bgColor: '#e3f2fd',
                    members: relationships.okay,
                    description: '무난한 관계입니다. 서로를 이해하려는 노력이 필요하지만 좋은 관계를 유지할 수 있습니다.'
                },
                {
                    title: '성장의 기회',
                    emoji: '💪',
                    color: '#9c27b0',
                    bgColor: '#f3e5f5',
                    members: relationships.challenging,
                    description: '서로 다른 면이 많아 도전적이지만, 이를 통해 더욱 성장할 수 있는 관계입니다.'
                }
            ].filter(category => category.members.length > 0);
        }

        function getMBTICompatibility(type1, type2) {
            const compatibilityMatrix = {
                // 환상의 궁합 (95-100점)
                'ENFP': ['INTJ', 'INFJ'], 'ENTP': ['INTJ', 'INFJ'],
                'INFP': ['ENTJ', 'ENFJ'], 'INTP': ['ENTJ', 'ENFJ'],
                'ENFJ': ['INFP', 'INTP'], 'ENTJ': ['INFP', 'INTP'],
                'INFJ': ['ENFP', 'ENTP'], 'INTJ': ['ENFP', 'ENTP'],
                'ESFP': ['ISTJ', 'ISFJ'], 'ESTP': ['ISTJ', 'ISFJ'],
                'ISFP': ['ESTJ', 'ESFJ'], 'ISTP': ['ESTJ', 'ESFJ'],
                'ESFJ': ['ISFP', 'ISTP'], 'ESTJ': ['ISFP', 'ISTP'],
                'ISFJ': ['ESFP', 'ESTP'], 'ISTJ': ['ESFP', 'ESTP']
            };
            
            // 환상의 궁합 체크
            if (compatibilityMatrix[type1] && compatibilityMatrix[type1].includes(type2)) {
                return { score: 96, level: 'perfect' };
            }
            
            // 기본 호환성 계산
            let score = 70; // 기본 점수
            
            // E/I 호환성
            if (type1[0] !== type2[0]) score += 8; // 반대 성향은 보완적
            else score += 3; // 같은 성향은 이해 가능
            
            // S/N 호환성
            if (type1[1] === type2[1]) score += 10; // 같은 인식 기능
            else score -= 5;
            
            // T/F 호환성
            if (type1[2] !== type2[2]) score += 7; // 다른 판단 기능은 균형
            else score += 4;
            
            // J/P 호환성
            if (type1[3] !== type2[3]) score += 6; // 다른 생활 양식은 보완적
            else score += 2;
            
            return { 
                score: Math.min(95, Math.max(55, score)), 
                level: score >= 85 ? 'great' : score >= 70 ? 'good' : score >= 60 ? 'okay' : 'challenging'
            };
        }

        function generateMBTIStatistics(results) {
            const typeCounts = {};
            const dimensionCounts = {E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0};
            
            results.forEach(result => {
                const type = result.mbtiType;
                typeCounts[type] = (typeCounts[type] || 0) + 1;
                
                if (type) {
                    dimensionCounts[type[0]]++;
                    dimensionCounts[type[1]]++;
                    dimensionCounts[type[2]]++;
                    dimensionCounts[type[3]]++;
                }
            });
            
            const mostCommon = Object.keys(typeCounts).reduce((a, b) => 
                typeCounts[a] > typeCounts[b] ? a : b, '');
            
            return `
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <strong>가장 많은 유형</strong><br>
                    <span style="color: #667eea; font-size: 1.1em;">${mostCommon} (${typeCounts[mostCommon] || 0}명)</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <strong>외향 vs 내향</strong><br>
                    E: ${dimensionCounts.E}명 | I: ${dimensionCounts.I}명
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <strong>감각 vs 직관</strong><br>
                    S: ${dimensionCounts.S}명 | N: ${dimensionCounts.N}명
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <strong>사고 vs 감정</strong><br>
                    T: ${dimensionCounts.T}명 | F: ${dimensionCounts.F}명
                </div>
            `;
        }

        function generateTeamBuildingTips(mbtiType) {
            const tips = {
                'ENFP': ['창의적 아이디어 회의 주도', '팀 분위기 메이커 역할', '새로운 관점 제시'],
                'INTJ': ['전략적 계획 수립', '장기적 비전 제시', '효율적 시스템 구축'],
                'ESFJ': ['팀원 간 화합 도모', '일정 관리 및 조율', '세심한 배려와 지원'],
                'ISTP': ['실무적 문제 해결', '기술적 지원 제공', '침착한 위기 대응']
            };
            
            const userTips = tips[mbtiType] || ['팀워크 기여', '협력적 소통', '상호 존중'];
            
            return userTips.map(tip => `
                <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 6px;">
                    <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>${tip}
                </div>
            `).join('');
        }

        function closeMBTIRelationship() {
            const modal = document.getElementById('mbtiRelationshipModal');
            if (modal) {
                modal.remove();
            }
        }

        // 참가자 현황에서도 MBTI 관계도 보기 추가
        function updateParticipantsList(participants) {
            const participantsList = document.getElementById('participantsList');
            participantsList.innerHTML = '';
            
            participants.forEach(participant => {
                const participantItem = document.createElement('div');
                participantItem.className = 'participant-item';
                participantItem.innerHTML = `
                    <div class="participant-avatar">${participant.name.substring(0, 1)}</div>
                    <div>
                        <div><strong>${participant.name}</strong> 
                            ${participant.mbtiType ? `<span style="color: #667eea;">[${participant.mbtiType}]</span>` : ''}
                        </div>
                        <div style="font-size: 0.8em; color: #666;">${participant.team} ${participant.position}</div>
                    </div>
                `;
                participantsList.appendChild(participantItem);
            });
            
            // MBTI 관계도 보기 버튼 추가
            const mbtiButton = document.createElement('button');
            mbtiButton.innerHTML = '<i class="fas fa-sitemap"></i> MBTI 관계도 보기';
            mbtiButton.className = 'sync-btn';
            mbtiButton.style.width = '100%';
            mbtiButton.style.marginTop = '15px';
            mbtiButton.onclick = function() {
                if (currentUser && currentUser.name) {
                    showMBTIRelationship();
                } else {
                    alert('MBTI 검사를 먼저 완료해주세요.');
                }
            };
            participantsList.appendChild(mbtiButton);
        }

        function closeMBTITest() {
            closeModal('mbtiModal');
        }

        // 워크샵 일정 옵션
        function openScheduleOptions() {
            activateMenuButton('schedule');
            const modalHTML = '<div class="modal" id="scheduleOptionsModal" style="display: block;">' +
                '<div class="modal-content">' +
                '<button class="close-btn" onclick="closeScheduleOptions()">&times;</button>' +
                '<div class="modal-header"><h3>워크샵 일정 선택</h3></div>' +
                '<div style="padding: 20px;">' +
                '<div onclick="openScheduleLink(\'phase1\')" style="display: flex; align-items: center; padding: 15px; margin-bottom: 15px; border: 1px solid #eee; border-radius: 8px; cursor: pointer;">' +
                '<i class="fas fa-graduation-cap" style="color: #28a745; font-size: 1.5em; margin-right: 15px;"></i>' +
                '<div><div style="font-weight: 600;">1차 역량강화 워크샵 일정</div></div></div>' +
                '<div onclick="openScheduleLink(\'phase2\')" style="display: flex; align-items: center; padding: 15px; margin-bottom: 15px; border: 1px solid #eee; border-radius: 8px; cursor: pointer;">' +
                '<i class="fas fa-users" style="color: #667eea; font-size: 1.5em; margin-right: 15px;"></i>' +
                '<div><div style="font-weight: 600;">2차 소통강화 워크샵 세부일정</div></div></div>' +
                '<div onclick="openScheduleLink(\'phase3\')" style="display: flex; align-items: center; padding: 15px; border: 1px solid #eee; border-radius: 8px; cursor: pointer;">' +
                '<i class="fas fa-rocket" style="color: #fd7e14; font-size: 1.5em; margin-right: 15px;"></i>' +
                '<div><div style="font-weight: 600;">3차 2025서밋서울앤엑스포2025 세미나</div></div></div>' +
                '</div></div></div>';
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function closeScheduleOptions() {
            const modal = document.getElementById('scheduleOptionsModal');
            if (modal) {
                modal.remove();
            }
            deactivateMenuButton('schedule');
        }

        function openScheduleLink(phase) {
            const scheduleLinks = {
                'phase1': 'https://form.naver.com/response/ktPwJoHoW2VFRo8AUa6yrg',
                'phase2': 'detailed_schedule', // 상세 일정 표시
                'phase3': 'https://www.aisummit.co.kr/'
            };
            
            const phaseNames = {
                'phase1': '1차 역량강화 워크샵',
                'phase2': '2차 소통강화 워크샵',
                'phase3': '3차 2025서밋서울앤엑스포2025 세미나'
            };
            
            if (phase === 'phase2') {
                showDetailedSchedule();
            } else if (scheduleLinks[phase]) {
                window.open(scheduleLinks[phase], '_blank');
            } else {
                alert(phaseNames[phase] + ' 일정 링크가 준비 중입니다.');
            }
            closeScheduleOptions();
        }

        // 2차 워크샵 상세 일정 표시
        function showDetailedSchedule() {
            const detailedScheduleHTML = `
                <div class="modal" id="detailedScheduleModal" style="display: block;">
                    <div class="modal-content" style="max-width: 90%; max-height: 90%; overflow-y: auto;">
                        <button class="close-btn" onclick="closeDetailedSchedule()">&times;</button>
                        <div class="modal-header">
                            <h3>2차 소통강화 워크샵 상세일정</h3>
                            <p style="color: #667eea; font-weight: 500;">부여군 소통강화 워크샵</p>
                        </div>
                        <div style="padding: 20px;">
                            <!-- 1일차 일정 -->
                            <div class="schedule-day">
                                <h4 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                                    1day
                                </h4>
                                <div class="schedule-items">
                                    <div class="schedule-item">
                                        <div class="time">14:50</div>
                                        <div class="activity">코비 집합</div>
                                        <div class="location">부여백제마리조트</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">15:10</div>
                                        <div class="activity">체크인 및 방배정</div>
                                        <div class="location">구드레선식당</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">15:20</div>
                                        <div class="activity">환복후비</div>
                                        <div class="location">룸소산장</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">15:50</div>
                                        <div class="activity">'숨니은 민속의 가람골'<br>(선화왕 > 낙화암 > 고란사 탐방)</div>
                                        <div class="location">구드레선식당</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">16:30</div>
                                        <div class="activity">이쁘시 버랫과 만들기<br>'충남에이스 가람골'</div>
                                        <div class="location">스키장YM5</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">17:20</div>
                                        <div class="activity">지영탈 자유시간</div>
                                        <div class="location"></div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">18:30</div>
                                        <div class="activity">저녁식사</div>
                                        <div class="location">서동한옥 구입원</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">21:00</div>
                                        <div class="activity">회식 및 교재에이스<br>'안주 사랑톡명'</div>
                                        <div class="location">부여백제마리조트</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">22:00</div>
                                        <div class="activity">자유휴식</div>
                                        <div class="location"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2일차 일정 -->
                            <div class="schedule-day" style="margin-top: 30px;">
                                <h4 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                                    2day
                                </h4>
                                <div class="schedule-items">
                                    <div class="schedule-item">
                                        <div class="time">11:00</div>
                                        <div class="activity">아침원 점심식사</div>
                                        <div class="location">침진원덕우</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">12:30</div>
                                        <div class="activity">부굽로 집합</div>
                                        <div class="location"></div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">12:30</div>
                                        <div class="activity">2024 실버인 식사</div>
                                        <div class="location"></div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">13:10</div>
                                        <div class="activity">3협 공유시간</div>
                                        <div class="location">서버123철커텐터</div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">13:30</div>
                                        <div class="activity">2협 공유시간</div>
                                        <div class="location"></div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">13:50</div>
                                        <div class="activity">1협 공유시간</div>
                                        <div class="location"></div>
                                    </div>
                                    <div class="schedule-item">
                                        <div class="time">14:10</div>
                                        <div class="activity">마무리</div>
                                        <div class="location"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                .schedule-item {
                    display: flex;
                    align-items: flex-start;
                    padding: 12px 0;
                    border-bottom: 1px solid #eee;
                }
                .schedule-item:last-child {
                    border-bottom: none;
                }
                .schedule-item .time {
                    width: 60px;
                    font-weight: 600;
                    color: #667eea;
                    flex-shrink: 0;
                }
                .schedule-item .activity {
                    flex: 1;
                    margin: 0 15px;
                    line-height: 1.4;
                    font-weight: 500;
                }
                .schedule-item .location {
                    width: 120px;
                    color: #666;
                    font-size: 0.9em;
                    text-align: right;
                    flex-shrink: 0;
                }
                .schedule-day {
                    margin-bottom: 20px;
                }
                </style>
            `;
            
            document.body.insertAdjacentHTML('beforeend', detailedScheduleHTML);
        }

        function closeDetailedSchedule() {
            const modal = document.getElementById('detailedScheduleModal');
            if (modal) {
                modal.remove();
            }
        }

        // 투어패스 보관함 - 개선된 링크 관리
        function showAddLinkForm() {
            document.getElementById('addLinkForm').style.display = 'block';
            document.getElementById('linkTitle').focus();
        }

        function cancelAddLink() {
            document.getElementById('addLinkForm').style.display = 'none';
            clearLinkForm();
        }

        function clearLinkForm() {
            document.getElementById('linkTitle').value = '';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkPassword').value = '';
        }

        function saveNewLink() {
            const title = document.getElementById('linkTitle').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            const password = document.getElementById('linkPassword').value.trim();
            
            if (!title) {
                alert('제목을 입력해주세요.');
                return;
            }
            
            if (!url) {
                alert('URL을 입력해주세요.');
                return;
            }
            
            // URL 형식 검증
            if (!isValidUrl(url)) {
                alert('올바른 URL 형식을 입력해주세요. (예: https://example.com)');
                return;
            }
            
            const links = JSON.parse(localStorage.getItem('tourpassLinks') || '[]');
            const newLink = {
                id: Date.now(),
                title: title,
                url: url,
                password: password || null,
                createdAt: new Date().toISOString(),
                locked: false
            };
            
            links.push(newLink);
            localStorage.setItem('tourpassLinks', JSON.stringify(links));
            
            updateLinksList();
            cancelAddLink();
            
            alert('링크가 성공적으로 저장되었습니다!');
        }

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function addNewLink() {
            // 기존 함수는 새로운 폼 방식으로 대체
            showAddLinkForm();
        }

        function updateLinksList() {
            const linksList = document.getElementById('linksList');
            const links = JSON.parse(localStorage.getItem('tourpassLinks') || '[]');
            
            if (links.length === 0) {
                linksList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">' +
                    '<i class="fas fa-inbox" style="font-size: 3em; margin-bottom: 15px;"></i>' +
                    '<p>저장된 링크가 없습니다.</p></div>';
                return;
            }
            
            linksList.innerHTML = links.map(function(link) {
                return '<div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="flex: 1;"><div style="font-weight: 600;">' + link.title + '</div>' +
                    '<div style="font-size: 0.8em; color: #666;">' + link.url + '</div></div>' +
                    '<div><button onclick="openLink(' + link.id + ')" style="background: #667eea; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; margin-left: 5px;">' +
                    '<i class="fas fa-external-link-alt"></i></button></div></div>';
            }).join('');
        }

        function openLink(linkId) {
            const links = JSON.parse(localStorage.getItem('tourpassLinks') || '[]');
            const link = links.find(function(l) { return l.id === linkId; });
            
            if (link) {
                window.open(link.url, '_blank');
            }
        }

        // 투어패스 티켓 기능
        function openTourpassTicket() {
            activateMenuButton('ticket');
            
            const links = JSON.parse(localStorage.getItem('tourpassLinks') || '[]');
            
            if (links.length === 0) {
                alert('저장된 투어패스 링크가 없습니다.\n먼저 투어패스 보관함에 링크를 추가해주세요.');
                deactivateMenuButton('ticket');
                return;
            }
            
            // 기본 투어패스 확인
            const defaultTicket = localStorage.getItem('defaultTourpass');
            
            if (defaultTicket) {
                const defaultLink = links.find(link => link.id == defaultTicket);
                if (defaultLink) {
                    if (confirm(`기본 투어패스를 열까요?\n${defaultLink.title}`)) {
                        openLink(defaultLink.id);
                        deactivateMenuButton('ticket');
                        return;
                    }
                }
            }
            
            // 투어패스 선택 모달
            showTourpassSelector(links);
        }

        function showTourpassSelector(links) {
            const selectorHTML = `
                <div class="modal" id="tourpassSelectorModal" style="display: block;">
                    <div class="modal-content">
                        <button class="close-btn" onclick="closeTourpassSelector()">&times;</button>
                        <div class="modal-header">
                            <h3>🎫 투어패스 선택</h3>
                        </div>
                        <div style="padding: 20px;">
                            <p style="margin-bottom: 15px; color: #666;">열고 싶은 투어패스를 선택하세요:</p>
                            ${links.map(link => `
                                <div class="tourpass-item" onclick="selectTourpass(${link.id})" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s ease;">
                                    <div>
                                        <div style="font-weight: 600;">${link.title}</div>
                                        <div style="font-size: 0.8em; color: #666;">${link.url}</div>
                                    </div>
                                    <div style="display: flex; gap: 5px;">
                                        <button onclick="event.stopPropagation(); setDefaultTourpass(${link.id})" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7em;">
                                            기본설정
                                        </button>
                                        <button onclick="event.stopPropagation(); selectTourpass(${link.id})" style="background: #667eea; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7em;">
                                            열기
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <style>
                .tourpass-item:hover {
                    background: #f0f0ff;
                    border-color: #667eea;
                }
                </style>
            `;
            
            document.body.insertAdjacentHTML('beforeend', selectorHTML);
        }

        function selectTourpass(linkId) {
            openLink(linkId);
            closeTourpassSelector();
        }

        function setDefaultTourpass(linkId) {
            localStorage.setItem('defaultTourpass', linkId);
            alert('기본 투어패스로 설정되었습니다!');
            closeTourpassSelector();
        }

        function closeTourpassSelector() {
            const modal = document.getElementById('tourpassSelectorModal');
            if (modal) {
                modal.remove();
            }
            deactivateMenuButton('ticket');
        }

        // 가위바위보 게임 기능
        let gameState = {
            opponent: null,
            myChoice: null,
            opponentChoice: null,
            gameStarted: false
        };

        function showParticipantsList() {
            document.getElementById('participantsTab').className = 'tab-btn active';
            document.getElementById('gameTab').className = 'tab-btn';
            document.getElementById('participantsTab').style.cssText = 'background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;';
            document.getElementById('gameTab').style.cssText = 'background: #f8f9fa; color: #333; border: 1px solid #ddd; padding: 8px 15px; border-radius: 4px; cursor: pointer;';
            
            document.getElementById('participantsContent').style.display = 'block';
            document.getElementById('gameContent').style.display = 'none';
        }

        function showRockPaperScissors() {
            document.getElementById('gameTab').className = 'tab-btn active';
            document.getElementById('participantsTab').className = 'tab-btn';
            document.getElementById('gameTab').style.cssText = 'background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;';
            document.getElementById('participantsTab').style.cssText = 'background: #f8f9fa; color: #333; border: 1px solid #ddd; padding: 8px 15px; border-radius: 4px; cursor: pointer;';
            
            document.getElementById('participantsContent').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
            
            loadOpponentsList();
        }

        function loadOpponentsList() {
            // 로컬 스토리지나 백엔드에서 참가자 목록 가져오기
            const participants = [
                '남도현', '김수인', '고다현', '심재호', '판티니안', 
                '김현철', '이유진', '정어진', '장원준', '김대진', 
                '손현우', '이주아', '장은진'
            ];
            
            const opponentSelect = document.getElementById('opponentSelect');
            opponentSelect.innerHTML = '<option value="">상대를 선택하세요</option>';
            
            participants.forEach(participant => {
                if (participant !== currentUser.name) {
                    const option = document.createElement('option');
                    option.value = participant;
                    option.textContent = participant;
                    opponentSelect.appendChild(option);
                }
            });
            
            opponentSelect.addEventListener('change', function() {
                if (this.value) {
                    startGame(this.value);
                }
            });
        }

        function startGame(opponentName) {
            gameState.opponent = opponentName;
            gameState.gameStarted = true;
            
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('myName').textContent = currentUser.name;
            document.getElementById('opponentName').textContent = opponentName;
            document.getElementById('gameResult').style.display = 'none';
            
            resetChoices();
        }

        function makeChoice(choice) {
            if (!gameState.gameStarted) return;
            
            gameState.myChoice = choice;
            gameState.opponentChoice = getRandomChoice();
            
            // 선택 표시
            const choices = {
                'rock': '✊',
                'paper': '✋', 
                'scissors': '✌️'
            };
            
            document.getElementById('myChoice').textContent = choices[gameState.myChoice];
            
            // 상대방 선택 애니메이션
            animateOpponentChoice(choices[gameState.opponentChoice]);
        }

        function animateOpponentChoice(finalChoice) {
            const opponentChoiceElement = document.getElementById('opponentChoice');
            const choices = ['✊', '✋', '✌️'];
            let animationCount = 0;
            
            const animation = setInterval(() => {
                opponentChoiceElement.textContent = choices[Math.floor(Math.random() * 3)];
                animationCount++;
                
                if (animationCount >= 6) {
                    clearInterval(animation);
                    opponentChoiceElement.textContent = finalChoice;
                    showResult();
                }
            }, 200);
        }

        function getRandomChoice() {
            const choices = ['rock', 'paper', 'scissors'];
            return choices[Math.floor(Math.random() * 3)];
        }

        function showResult() {
            const result = determineWinner(gameState.myChoice, gameState.opponentChoice);
            const resultElement = document.getElementById('gameResult');
            const resultTextElement = document.getElementById('resultText');
            const resultDetailElement = document.getElementById('resultDetail');
            
            resultElement.style.display = 'block';
            
            if (result === 'win') {
                resultTextElement.textContent = '🎉 승리!';
                resultTextElement.style.color = '#28a745';
                resultDetailElement.textContent = `${currentUser.name}님이 이겼습니다!`;
            } else if (result === 'lose') {
                resultTextElement.textContent = '😅 패배!';
                resultTextElement.style.color = '#dc3545';
                resultDetailElement.textContent = `${gameState.opponent}님이 이겼습니다!`;
            } else {
                resultTextElement.textContent = '🤝 무승부!';
                resultTextElement.style.color = '#6c757d';
                resultDetailElement.textContent = '다시 도전해보세요!';
            }
        }

        function determineWinner(myChoice, opponentChoice) {
            if (myChoice === opponentChoice) return 'draw';
            
            const winConditions = {
                'rock': 'scissors',
                'paper': 'rock',
                'scissors': 'paper'
            };
            
            return winConditions[myChoice] === opponentChoice ? 'win' : 'lose';
        }

        function resetGame() {
            resetChoices();
            document.getElementById('gameResult').style.display = 'none';
            document.getElementById('opponentSelect').value = '';
            document.getElementById('gameArea').style.display = 'none';
            gameState = {
                opponent: null,
                myChoice: null,
                opponentChoice: null,
                gameStarted: false
            };
        }

        function resetChoices() {
            document.getElementById('myChoice').textContent = '❓';
            document.getElementById('opponentChoice').textContent = '❓';
        }

        // 앱 번역
        function translateApp() {
            const selectedLanguage = document.getElementById('languageSelect').value;
            
            const translations = {
                'ko': {
                    appTitle: '투어패스사업부 2025 워크샵',
                    appSubtitle: 'TRAVEL SHIFT',
                    connectionOnline: '온라인',
                    connectionOffline: '오프라인',
                    connectionChecking: '연결 확인 중...',
                    syncText: '동기화: ',
                    loginBtnText: 'Google 계정으로 로그인',
                    loginDescription: '워크샵 참여를 위해 구글 계정 연동이 필요합니다',
                    menuItems: {
                        participants: '참가자 현황',
                        participantsDesc: '실시간 참가자 정보 확인',
                        schedule: '워크샵 일정',
                        scheduleDesc: '상세 일정 및 프로그램',
                        mbti: 'MBTI 검사',
                        mbtiDesc: '성격 유형 검사 실시',
                        ticket: '사용 중인 투어패스 열기',
                        ticketDesc: '지정된 투어패스 링크 연결',
                        survey: '설문조사',
                        surveyDesc: '워크샵 만족도 조사',
                        tourpassBox: '투어패스 보관함',
                        tourpassBoxDesc: '개인 링크 저장소'
                    },
                    translateTitle: '앱 번역하기',
                    translateDesc: '언어를 선택하면 앱 전체가 번역됩니다'
                },
                'en': {
                    appTitle: 'TourPass Business Unit 2025 Workshop',
                    appSubtitle: 'TRAVEL SHIFT',
                    connectionOnline: 'Online',
                    connectionOffline: 'Offline',
                    connectionChecking: 'Checking connection...',
                    syncText: 'Sync: ',
                    loginBtnText: 'Sign in with Google',
                    loginDescription: 'Google account integration required for workshop participation',
                    menuItems: {
                        participants: 'Participants',
                        participantsDesc: 'Real-time participant information',
                        schedule: 'Workshop Schedule',
                        scheduleDesc: 'Detailed schedule and programs',
                        mbti: 'MBTI Test',
                        mbtiDesc: 'Personality type assessment',
                        ticket: 'Open TourPass in Use',
                        ticketDesc: 'Connect to designated TourPass link',
                        survey: 'Survey',
                        surveyDesc: 'Workshop satisfaction survey',
                        tourpassBox: 'TourPass Storage',
                        tourpassBoxDesc: 'Personal link storage'
                    },
                    translateTitle: 'App Translation',
                    translateDesc: 'Select a language to translate the entire app'
                },
                'ja': {
                    appTitle: 'ツアーパス事業部 2025 ワークショップ',
                    appSubtitle: 'TRAVEL SHIFT',
                    connectionOnline: 'オンライン',
                    connectionOffline: 'オフライン',
                    connectionChecking: '接続確認中...',
                    syncText: '同期: ',
                    loginBtnText: 'Googleアカウントでログイン',
                    loginDescription: 'ワークショップ参加にはGoogleアカウント連携が必要です',
                    menuItems: {
                        participants: '参加者現況',
                        participantsDesc: 'リアルタイム参加者情報確認',
                        schedule: 'ワークショップ日程',
                        scheduleDesc: '詳細日程とプログラム',
                        mbti: 'MBTI検査',
                        mbtiDesc: '性格タイプ検査実施',
                        ticket: '使用中のツアーパスを開く',
                        ticketDesc: '指定されたツアーパスリンク接続',
                        survey: 'アンケート調査',
                        surveyDesc: 'ワークショップ満足度調査',
                        tourpassBox: 'ツアーパス保管箱',
                        tourpassBoxDesc: '個人リンク保存所'
                    },
                    translateTitle: 'アプリ翻訳',
                    translateDesc: '言語を選択するとアプリ全体が翻訳されます'
                },
                'zh': {
                    appTitle: '旅游通行证事业部 2025 研习班',
                    appSubtitle: 'TRAVEL SHIFT',
                    connectionOnline: '在线',
                    connectionOffline: '离线',
                    connectionChecking: '检查连接中...',
                    syncText: '同步: ',
                    loginBtnText: '使用Google账户登录',
                    loginDescription: '参加研习班需要Google账户集成',
                    menuItems: {
                        participants: '参加者现状',
                        participantsDesc: '实时参加者信息确认',
                        schedule: '研习班日程',
                        scheduleDesc: '详细日程和项目',
                        mbti: 'MBTI测试',
                        mbtiDesc: '性格类型测试实施',
                        ticket: '打开使用中的旅游通行证',
                        ticketDesc: '连接指定的旅游通行证链接',
                        survey: '问卷调查',
                        surveyDesc: '研习班满意度调查',
                        tourpassBox: '旅游通行证保管箱',
                        tourpassBoxDesc: '个人链接存储'
                    },
                    translateTitle: '应用翻译',
                    translateDesc: '选择语言即可翻译整个应用'
                }
            };
            
            const t = translations[selectedLanguage];
            
            if (t) {
                // 헤더 번역
                document.querySelector('.app-title').textContent = t.appTitle;
                document.querySelector('.app-subtitle').textContent = t.appSubtitle;
                
                // 연결 상태 번역
                const connectionText = document.getElementById('connectionText');
                if (connectionText.textContent === '온라인' || connectionText.textContent === 'Online' || connectionText.textContent === 'オンライン' || connectionText.textContent === '在线') {
                    connectionText.textContent = t.connectionOnline;
                } else if (connectionText.textContent === '오프라인' || connectionText.textContent === 'Offline' || connectionText.textContent === 'オフライン' || connectionText.textContent === '离线') {
                    connectionText.textContent = t.connectionOffline;
                } else {
                    connectionText.textContent = t.connectionChecking;
                }
                
                // 로그인 버튼 번역
                const loginBtn = document.getElementById('googleLoginBtn');
                if (loginBtn && loginBtn.innerHTML.indexOf('spinner') === -1) {
                    loginBtn.innerHTML = '<i class="fab fa-google"></i> ' + t.loginBtnText;
                }
                
                // 로그인 설명 번역
                const loginDesc = document.querySelector('.google-login p');
                if (loginDesc) {
                    loginDesc.textContent = t.loginDescription;
                }
                
                // 메뉴 항목 번역
                const menuItems = document.querySelectorAll('.menu-item');
                const menuKeys = ['participants', 'schedule', 'mbti', 'ticket', 'survey', 'tourpassBox'];
                
                menuItems.forEach(function(item, index) {
                    if (menuKeys[index] && t.menuItems[menuKeys[index]]) {
                        const titleElement = item.querySelector('.menu-title');
                        const descElement = item.querySelector('.menu-desc');
                        
                        if (titleElement) {
                            titleElement.textContent = t.menuItems[menuKeys[index]];
                        }
                        if (descElement) {
                            descElement.textContent = t.menuItems[menuKeys[index] + 'Desc'];
                        }
                    }
                });
                
                // 번역 섹션 제목 번역
                const translateTitle = document.querySelector('.app-translate h4');
                if (translateTitle) {
                    translateTitle.innerHTML = '🌐 ' + t.translateTitle;
                }
                
                const translateDesc = document.querySelector('.app-translate > div:last-child');
                if (translateDesc) {
                    translateDesc.textContent = t.translateDesc;
                }
                
                // 동기화 텍스트 업데이트
                const lastSyncElement = document.getElementById('lastSync');
                if (lastSyncElement) {
                    const currentTime = lastSyncElement.textContent.split(': ')[1] || '-';
                    lastSyncElement.textContent = t.syncText + currentTime;
                }
                
                // 언어별 성공 메시지
                const messages = {
                    'ko': '한국어로 번역되었습니다',
                    'en': 'Translated to English',
                    'ja': '日本語に翻訳されました',
                    'zh': '已翻译为中文'
                };
                
                alert(messages[selectedLanguage]);
            }
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            document.getElementById('googleLoginBtn').addEventListener('click', googleLogin);
        });
    </script>
</body>
</html>
