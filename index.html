<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìˆ</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">

<style>
  :root{
    --brand-1:#1e3a8a; --brand-2:#2563eb; --brand-3:#3b82f6;
    --text:#0f172a; --muted:#64748b; --line:#e2e8f0;
  }
  body{font-family:'Pretendard',sans-serif;background:linear-gradient(180deg,#f0f4ff 0%,#ffffff 100%);min-height:100vh;color:var(--text);display:flex;flex-direction:column;align-items:center;justify-content:start;padding:2rem 1rem 4rem}
  .header{text-align:center;margin-bottom:1.25rem}
  .header h1{font-weight:800;font-size:1.8rem;color:var(--brand-1)}
  .header p{color:#94a3b8}
  .card{background:#fff;border-radius:1.25rem;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:1.5rem;width:100%;max-width:420px;margin-bottom:1.1rem;transition:.25s}
  .card:hover{transform:translateY(-2px)}
  label{display:block;font-weight:600;font-size:.9rem;color:#334155;margin-bottom:.35rem}
  select,input{width:100%;border:1px solid var(--line);border-radius:.9rem;padding:.85rem 1rem;background:#f9fafb;transition:.2s}
  select:focus,input:focus{background:#fff;border-color:var(--brand-3);box-shadow:0 0 0 3px rgba(59,130,246,.18);outline:0}
  .btn{display:inline-block;width:100%;border-radius:.9rem;font-weight:800;padding:.9rem;text-align:center;transition:.25s}
  .btn-primary{background:linear-gradient(90deg,var(--brand-2),var(--brand-3));color:#fff;box-shadow:0 4px 14px rgba(37,99,235,.25)}
  .btn-primary:hover{background:linear-gradient(90deg,#1d4ed8,var(--brand-2));transform:translateY(-1px)}
  .btn-outline{background:#fff;border:1px solid var(--line);color:var(--brand-1)}
  .btn-outline:hover{background:#f8fafc}
  .menu-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.9rem}
  .menu-item{border:1px solid var(--line);border-radius:1rem;background:#f9fafb;padding:1.1rem;text-align:center;color:var(--brand-1);font-weight:700;box-shadow:0 3px 10px rgba(0,0,0,.04);cursor:pointer;transition:.25s}
  .menu-item:hover{background:#eef2ff;border-color:var(--brand-3);transform:translateY(-2px)}
  .timer-box{background:linear-gradient(90deg,var(--brand-2),var(--brand-3));color:#fff;border-radius:1rem;padding:1.2rem;text-align:center;box-shadow:0 6px 16px rgba(37,99,235,.25)}
  .timer-display{font-size:2rem;font-weight:900}
  .logout{max-width:420px;margin-top:1.1rem}
  /* ê²Œì´íŠ¸ */
  #mainScreen.gated .menu-grid{filter:blur(3px);pointer-events:none}
  #gatedNote{display:none;text-align:center;color:var(--muted);margin:.5rem 0 -.3rem}
  #gatedNote.on{display:block}
  /* ëª¨ë‹¬ ê³µí†µ */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:50;align-items:center;justify-content:center;padding:1rem}
  .modal-content{background:#fff;border-radius:1rem;max-width:600px;width:100%;max-height:85vh;overflow:auto;padding:1rem 1.1rem}
  .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.6rem}
  .close{border:0;background:transparent;font-size:1.6rem;color:#94a3b8;cursor:pointer}
  /* ì•Œë¦¼ */
  #alertMessage{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:var(--brand-2);color:#fff;padding:.7rem 1rem;border-radius:.7rem;box-shadow:0 3px 10px rgba(0,0,0,.15);opacity:0;transition:.25s;z-index:60}
  #alertMessage.show{opacity:1}
</style>
</head>

<body>
  <div class="header">
    <h1>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€</h1>
    <p>2025 ì›Œí¬ìˆ</p>
  </div>

  <!-- ë¡œê·¸ì¸ -->
  <div id="loginScreen" class="card">
    <div class="mb-4">
      <label>ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</label>
      <select id="userName">
        <option value="">ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option>ë‚¨ë„í˜„</option><option>ê¹€í˜„ì² </option><option>ê¹€ìˆ˜ì¸</option><option>ê¹€ëŒ€ì§„</option>
        <option>ì´ì£¼ì•„</option><option>ì¥ì€ì§„</option><option>ì´ìœ ì§„</option><option>ì •ì–´ì§„</option>
        <option>íŒí‹°ë‹ˆì•ˆ</option><option>ì¥ì›ì¤€</option><option>ê³ ë‹¤í˜„</option><option>ì‹¬ì¬í¬</option>
      </select>
    </div>
    <div class="mb-4">
      <label>MBTIë¥¼ ì„ íƒí•˜ì„¸ìš”</label>
      <select id="userMBTI">
        <option value="">MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option>ENTJ</option><option>ENFJ</option><option>ENFP</option><option>ENTP</option>
        <option>ESTJ</option><option>ESFJ</option><option>ESFP</option><option>ESTP</option>
        <option>INTJ</option><option>INFJ</option><option>INFP</option><option>INTP</option>
        <option>ISTJ</option><option>ISFJ</option><option>ISFP</option><option>ISTP</option>
      </select>
    </div>
    <div class="mb-2">
      <label>ì°¸ì—¬ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
      <input id="userCode" type="password" placeholder="ì˜ˆ: 20200211"/>
    </div>
    <button id="loginBtn" class="btn btn-primary mt-3">ë¡œê·¸ì¸</button>
  </div>

  <!-- ë©”ì¸ -->
  <div id="mainScreen" class="hidden">
    <div class="card text-center">
      <div style="font-size:1.3rem;font-weight:800;color:var(--brand-1)" id="userNameDisplay">-</div>
      <div style="color:var(--muted)" id="userTeamDisplay">íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€</div>
      <div class="flex gap-2 mt-3">
        <button id="logoutBtn" class="btn btn-outline">ë¡œê·¸ì•„ì›ƒ</button>
        <button id="startBtn" class="btn btn-primary">ì›Œí¬ìˆ ì°¸ì—¬í•˜ê¸°</button>
      </div>
      <div id="gatedNote" class="">ğŸ”’ ì•„ë˜ ë©”ë‰´ëŠ” <b>â€œì›Œí¬ìˆ ì°¸ì—¬í•˜ê¸°â€</b> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—´ë¦½ë‹ˆë‹¤.</div>
    </div>

    <div class="card">
      <div class="menu-grid">
        <div class="menu-item" id="menuMbti">ğŸ”— MBTI ê´€ê³„ë„</div>
        <div class="menu-item" id="menuVault">ğŸ“ íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</div>
        <div class="menu-item" id="menuFortune">ğŸ”® ë°ì¼ë¦¬ í¬ì¶˜</div>
        <div class="menu-item" id="menuDraft">ğŸ§© íˆ¬ì–´íŒ¨ìŠ¤ ì´ˆì•ˆ</div>
        <div class="menu-item" id="menuAI">ğŸ¤– AI ì±—ë´‡</div>
        <div class="menu-item" id="menuPsy">ğŸ§  ì‹¬ë¦¬í…ŒìŠ¤íŠ¸</div>
        <div class="menu-item" id="menuSchedule">ğŸ—“ï¸ ì›Œí¬ìˆ ì¼ì •</div>
        <div class="menu-item" id="menuLibrary">ğŸ“š ìë£Œì‹¤</div>
      </div>
    </div>

    <div class="timer-box">
      <div style="font-size:.95rem;opacity:.9">ì›Œí¬ìˆ ë‚¨ì€ ì‹œê°„</div>
      <div id="timerDisplay" class="timer-display">48:00:00</div>
    </div>

    <button class="btn btn-outline logout">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <!-- ëª¨ë‹¬ë“¤ -->
  <div id="vaultModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h3>íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</h3><button class="close" data-close="vaultModal">Ã—</button></div>
      <div id="presetWrap"></div>
      <div class="flex gap-2 mt-3">
        <button class="btn btn-outline" id="presetSave">ì„ íƒ ì €ì¥</button>
        <button class="btn btn-primary" id="presetGo">ì €ì¥ ì—†ì´ ì´ë™</button>
      </div>
      <p class="text-sm text-gray-500 mt-2" id="presetTip"></p>
    </div>
  </div>

  <div id="fortuneModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h3>ë°ì¼ë¦¬ í¬ì¶˜</h3><button class="close" data-close="fortuneModal">Ã—</button></div>
      <div id="fortuneBody"></div>
    </div>
  </div>

  <div id="psyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h3>O/X ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ (5ë¬¸í•­)</h3><button class="close" data-close="psyModal">Ã—</button></div>
      <div id="psyStep" class="">
        <div class="text-sm text-gray-500" id="psyTitle">1/5</div>
        <div id="psyQuestion" class="mt-1 mb-3"></div>
        <div class="grid grid-cols-2 gap-2">
          <button class="btn btn-primary" id="btnO">O (ê·¸ë ‡ë‹¤)</button>
          <button class="btn btn-outline" id="btnX">X (ì•„ë‹ˆë‹¤)</button>
        </div>
      </div>
      <div id="psyResult" class="hidden">
        <div style="font-size:2rem" id="resEmoji">ğŸ¶</div>
        <div style="font-weight:800" id="resTitle">í™œë°œí•œ ê°•ì•„ì§€</div>
        <div class="text-gray-600 mt-1" id="resDesc">ì‚¬ëŒì´ ì¢‹ê³  ìƒˆë¡œìš´ ìê·¹ì— ì„¤ë Œë‹¤!</div>
        <div id="resTags" class="flex flex-wrap gap-1 mt-2"></div>
        <div class="mt-3"><button class="btn btn-outline" id="psyRetry">ë‹¤ì‹œ í•˜ê¸°</button></div>
      </div>
    </div>
  </div>

  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h3>ì›Œí¬ìˆ ì¼ì •</h3><button class="close" data-close="scheduleModal">Ã—</button></div>
      <div id="scheduleBody"></div>
    </div>
  </div>

  <div id="libraryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h3>ìë£Œì‹¤</h3><button class="close" data-close="libraryModal">Ã—</button></div>
      <div id="libList" class="grid gap-2"></div>
      <p class="text-gray-500 text-sm mt-2">â€» ìë£Œì‹¤ì€ ì½”ë“œì— ê³ ì •ëœ ë§í¬ ëª©ë¡ì…ë‹ˆë‹¤.</p>
    </div>
  </div>

  <div id="alertMessage"></div>

<script>
/* ====== CONFIG ====== */
// ë°±ì—”ë“œ(GAS) WebApp URL â€” MBTI ì €ì¥/ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹ ìš© (ì—†ì–´ë„ UI ë™ì‘)
const API_URL = "https://script.google.com/macros/s/AKfycbxM8pNBBnAxRyoIYHO8be82IzlTCPYOcRRjq_aoiTvcyoprVNhfXQx_KsZlVSVGJlhn/exec";

// ì™¸ë¶€ ë§í¬(ì›í•˜ëŠ” ê°’ìœ¼ë¡œ êµì²´)
const RELATION_URL = "https://kim950106.github.io/tour/";       // MBTI ê´€ê³„ë„
const AI_CHATBOT_URL = "https://kim950106.github.io/tourpass.ai/";
const TPV3_URL = "https://claude.ai/public/artifacts/65f1dc58-6271-47af-8ee7-f159eb01d4e6";

// ë³´ê´€í•¨ ì‚¬ì „ ë“±ë¡ í‹°ì¼“(ì½”ë“œ/ì´ë¦„/URL)
const PRESET_TICKETS = [
  { code:"9403", name:"1ì¡° ì¶©ë‚¨íˆ¬ì–´íŒ¨ìŠ¤", url:"www.naver.com" },
  { code:"8027", name:"2ì¡° ì¶©ë‚¨íˆ¬ì–´íŒ¨ìŠ¤", url:"www.daum.net" },
  { code:"1402", name:"3ì¡° ì¶©ë‚¨íˆ¬ì–´íŒ¨ìŠ¤", url:"www.tourpass.ai" }
];

// ğŸ“š ìë£Œì‹¤: ì €ì¥ì´ ì•„ë‹Œ â€œì½”ë“œ ê³ ì •í˜•â€
const LIBRARY_LINKS = [
  { title:"ì›Œí¬ìˆ ë¦¬í”Œë ›", url:"https://example.com/leaflet.pdf", desc:"PDF ë‹¤ìš´ë¡œë“œ" },
  { title:"ì„±ê³¼ ë° ì¶”ì§„ë³´ê³ ", url:"https://example.com/report", desc:"Google Docs" },
  { title:"ì°¸ê°€ì ì•ˆë‚´", url:"https://example.com/guide", desc:"ì›¹ ì•ˆë‚´ë¬¸" },
  { title:"ë¶€ì—¬ ê´€ê´‘ì§€ë„", url:"https://example.com/map", desc:"ì´ë¯¸ì§€ ì§€ë„" },
];

// ì°¸ì—¬ì½”ë“œ ë§¤í•‘
const PARTICIPATION_CODES = {
  "ë‚¨ë„í˜„":"20191001","ê¹€í˜„ì² ":"20200211","ê¹€ìˆ˜ì¸":"202201171","ê¹€ëŒ€ì§„":"202201172",
  "ì´ì£¼ì•„":"20220118","ì¥ì€ì§„":"20221101","ì´ìœ ì§„":"20230614","ì •ì–´ì§„":"20240419",
  "íŒí‹°ë‹ˆì•ˆ":"20250507","ì¥ì›ì¤€":"20250526","ê³ ë‹¤í˜„":"20250804","ì‹¬ì¬í¬":"20250901"
};
function validateParticipation(name, code){
  return (PARTICIPATION_CODES[name]||"") === String(code||"").trim();
}

/* ====== STATE ====== */
let currentUser="", sessionId="", workshopEndAt=null, timerInterval=null;

/* ====== UTILS ====== */
async function apiRequest(action, payload={}){
  try{
    const r = await fetch(API_URL,{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({action,...payload})});
    return await r.json();
  }catch(e){return {success:false,error:String(e)}}
}
function toast(msg,type="info",ms=2000){
  const el=document.getElementById('alertMessage');
  el.textContent=msg; el.style.background = type==="error"?"#ef4444":type==="success"?"#10b981": "var(--brand-2)";
  el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),ms);
}
function normalizeUrl(u){ if(!/^https?:\/\//i.test(u)) return 'https://'+u; return u; }
function fmt(ms){const t=Math.max(0,Math.floor(ms/1000));const h=String(Math.floor(t/3600)).padStart(2,'0');const m=String(Math.floor((t%3600)/60)).padStart(2,'0');const s=String(t%60).padStart(2,'0');return `${h}:${m}:${s}`;}
async function track(event,meta={}){ try{ await apiRequest('trackEvent',{sessionId,userName:currentUser,event,meta}); }catch(_){} }

/* ====== GATE & TIMER ====== */
function applyGate(){ document.getElementById('mainScreen').classList.add('gated'); document.getElementById('gatedNote').classList.add('on'); }
function clearGate(){ document.getElementById('mainScreen').classList.remove('gated'); document.getElementById('gatedNote').classList.remove('on'); }
function beginTimer(){
  const stored = localStorage.getItem('workshopEndAt');
  if(stored){ workshopEndAt=new Date(Number(stored)); runTick(); clearGate(); toast('ì´ë¯¸ ì¹´ìš´íŠ¸ë‹¤ìš´ ì¤‘'); return; }
  const end=Date.now()+48*60*60*1000;
  localStorage.setItem('workshopEndAt',String(end));
  workshopEndAt=new Date(end); runTick(); clearGate(); toast('ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘!','success');
}
function runTick(){
  if(timerInterval) clearInterval(timerInterval);
  const disp=document.getElementById('timerDisplay');
  const tick=()=>{ const remain=workshopEndAt-Date.now(); disp.textContent=fmt(remain); if(remain<=0){clearInterval(timerInterval); disp.textContent="00:00:00";} };
  tick(); timerInterval=setInterval(tick,1000);
}

/* ====== LOGIN ====== */
async function doLogin(){
  const name=document.getElementById('userName').value.trim();
  const mbti=document.getElementById('userMBTI').value.trim();
  const code=(document.getElementById('userCode').value||"").trim();
  if(!name || !mbti) return toast('ì´ë¦„ê³¼ MBTIë¥¼ ì„ íƒí•˜ì„¸ìš”','error');
  if(!code) return toast('ì°¸ì—¬ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”','error');
  if(!validateParticipation(name,code)) return toast('ì°¸ì—¬ì½”ë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤','error');

  currentUser=name; sessionId='session_'+Date.now();
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('mainScreen').classList.remove('hidden');
  document.getElementById('userNameDisplay').textContent=currentUser;
  document.getElementById('userTeamDisplay').textContent='íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€';

  // ìºì‹œ ì €ì¥ (ë¡œê·¸ì•„ì›ƒ ì „ê¹Œì§€ ìœ ì§€)
  localStorage.setItem('loginCache',JSON.stringify({name,mbti,code}));
  localStorage.setItem('sessionId',sessionId);

  // ë°±ì—”ë“œì— MBTI í¬í•¨ ì €ì¥ (ìˆìœ¼ë©´)
  apiRequest('login',{sessionId,userName:name,mbti,team:'íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€',position:''});
  track('login',{mbti});

  // íƒ€ì´ë¨¸ ìƒíƒœ ë°˜ì˜
  const stored=localStorage.getItem('workshopEndAt');
  if(stored){ workshopEndAt=new Date(Number(stored)); runTick(); clearGate(); } else { applyGate(); }

  toast(`í™˜ì˜í•©ë‹ˆë‹¤, ${name}ë‹˜!`,'success');
}

async function doLogout(){
  await apiRequest('updateUserStatus',{sessionId,userName:currentUser,status:'offline'});
  localStorage.removeItem('loginCache'); localStorage.removeItem('sessionId'); // íƒ€ì´ë¨¸ëŠ” ìœ ì§€ ì›í•˜ì‹œë©´ ì£¼ì„
  // localStorage.removeItem('workshopEndAt');
  location.reload();
}
function restore(){
  const cache=localStorage.getItem('loginCache'); if(!cache) return;
  try{
    const {name,mbti,code}=JSON.parse(cache);
    if(!validateParticipation(name,code)) return; // ì½”ë“œê°€ ë°”ë€Œë©´ ë¡œê·¸ì¸ ë¬´íš¨
    currentUser=name; sessionId=localStorage.getItem('sessionId')||('session_'+Date.now());
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainScreen').classList.remove('hidden');
    document.getElementById('userNameDisplay').textContent=currentUser;
    document.getElementById('userTeamDisplay').textContent='íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€';
    const stored=localStorage.getItem('workshopEndAt');
    if(stored){ workshopEndAt=new Date(Number(stored)); runTick(); clearGate(); } else { applyGate(); }
    toast(`ìë™ë¡œê·¸ì¸: ${name}`,'success');
  }catch(_){}
}

/* ====== MENU: ë³´ê´€í•¨ ====== */
function renderVault(){
  const wrap=document.getElementById('presetWrap');
  const selected=localStorage.getItem('selectedTicketCode')||'';
  wrap.innerHTML=PRESET_TICKETS.map(t=>
    `<label class="block border border-gray-200 rounded-lg p-3 mb-2">
      <div class="flex items-center gap-2">
        <input type="radio" name="preset" value="${t.code}" ${t.code===selected?'checked':''}/>
        <div>
          <div class="font-bold">ì½”ë“œ ${t.code} Â· ${t.name}</div>
          <div class="text-gray-500 text-sm">${t.url}</div>
        </div>
      </div>
    </label>`).join('');
  document.getElementById('presetTip').textContent= selected?`í˜„ì¬ ì„ íƒ: ${selected}`:'ì•„ì§ ì„ íƒëœ í‹°ì¼“ì´ ì—†ìŠµë‹ˆë‹¤.';
}
function openVault(){ renderVault(); showModal('vaultModal'); track('click:menu_vault'); }
function saveVault(){
  const ch=document.querySelector('input[name="preset"]:checked');
  if(!ch) return toast('í‹°ì¼“ì„ ì„ íƒí•˜ì„¸ìš”','error');
  localStorage.setItem('selectedTicketCode',ch.value); toast('ì„ íƒì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤','success'); hideModal('vaultModal');
  const t=PRESET_TICKETS.find(x=>x.code===ch.value); if(t) window.open(normalizeUrl(t.url),'_blank');
}
function goVault(){
  const ch=document.querySelector('input[name="preset"]:checked');
  if(!ch) return toast('í‹°ì¼“ì„ ì„ íƒí•˜ì„¸ìš”','error');
  const t=PRESET_TICKETS.find(x=>x.code===ch.value); if(t) window.open(normalizeUrl(t.url),'_blank');
}

/* ====== MENU: ë°ì¼ë¦¬ í¬ì¶˜ ====== */
function seeded(name){let t=0;for(let i=0;i<name.length;i++)t=(t*31+name.charCodeAt(i))>>>0;return ()=>{t=(t+0x6D2B79F5)>>>0;let r=Math.imul(t^(t>>>15),1|t);r^=r+Math.imul(r^(r>>>7),61|r);return((r^(r>>>14))>>>0)/4294967296;};}
function openFortune(){
  const rng=seeded(currentUser + new Date().toISOString().slice(0,10));
  const grade=['â˜…â˜…â˜…â˜…â˜…','â˜…â˜…â˜…â˜…â˜†','â˜…â˜…â˜…â˜†â˜†','â˜…â˜…â˜†â˜†â˜†','â˜…â˜†â˜†â˜†â˜†'];
  const pick=a=>a[Math.floor(rng()*a.length)];
  const lucky=Math.floor(rng()*99)+1;
  const sec=(tit)=>`<div class="border border-gray-200 rounded-lg p-3 mb-2"><div class="font-bold">${tit}<span class="float-right">${pick(grade)}</span></div><div class="text-gray-600 mt-1">`+
    `${pick(['ì‘ê²Œ ì‹œì‘í•˜ë©´ í¬ê²Œ ëŒì•„ì˜µë‹ˆë‹¤.','ê³¼ê°íˆ ëœì–´ë‚´ë©´ ì†ë„ê°€ ë‚©ë‹ˆë‹¤.','íƒ€ì´ë°ì€ ì§€ê¸ˆ! ë¯¸ë£¨ì§€ ë§ê¸°.','ì‚¬ëŒì„ ë¨¼ì € ì±™ê¸°ë©´ ì¼ì´ í’€ë¦½ë‹ˆë‹¤.','ë°ì´í„°ë¡œ í™•ì¸í•˜ì„¸ìš”.'])}</div></div>`;
  document.getElementById('fortuneBody').innerHTML=
    `<div class="text-center mb-2"><div class="text-sm text-gray-500">ì˜¤ëŠ˜</div><div class="font-bold text-lg">${currentUser}ë‹˜ì˜ ë°ì¼ë¦¬ í¬ì¶˜</div></div>`+
    sec('ì „ì²´ìš´')+sec('ì—°ì• ìš´')+sec('ê¸ˆì „ìš´')+sec('ê±´ê°•ìš´')+sec('ì—…ë¬´/í•™ì—…')+
    `<div class="grid grid-cols-2 gap-2 mt-2">
       <div class="border border-gray-200 rounded-lg p-3"><div class="font-bold">ëŸ­í‚¤ ë„˜ë²„</div><div>${lucky}</div></div>
       <div class="border border-gray-200 rounded-lg p-3"><div class="font-bold">ëŸ­í‚¤ ì»¬ëŸ¬</div><div>${pick(['ë„¤ì´ë¹„','ì½”ë°œíŠ¸','ë¯¼íŠ¸','ì˜ë¡œ','ì½”ë„','ë¼ì¼ë½'])}</div></div>
     </div>`;
  showModal('fortuneModal'); track('click:menu_fortune');
}

/* ====== MENU: ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ====== */
const PSY_QUESTIONS=[
  {text:'ì‚¬ëŒ ë§ì€ í™œë™ì—ì„œ ì—ë„ˆì§€ê°€ ìƒê¸´ë‹¤.',pos:'E'},{text:'ê³„íšëŒ€ë¡œ ì›€ì§ì¼ ë•Œ ì•ˆì •ê°ì„ ëŠë‚€ë‹¤.',pos:'J'},
  {text:'ê²°ì •ë³´ë‹¤ ê´€ê³„ì˜ ì¡°í™”ê°€ ë” ì¤‘ìš”í•˜ë‹¤.',pos:'F'},{text:'ì˜ˆìƒì¹˜ ëª»í•œ ì œì•ˆë„ ì¦‰í¥ì ìœ¼ë¡œ ìˆ˜ë½í•œë‹¤.',pos:'P'},
  {text:'í˜¼ìë§Œì˜ ì‹œê°„ì—ì„œ ì§‘ì¤‘ë ¥ì´ ì˜¤ë¥¸ë‹¤.',pos:'I'}
];
let psyIdx=0, score={E:0,I:0,J:0,P:0,F:0,T:0};
function renderPsy(){ document.getElementById('psyTitle').textContent=`${psyIdx+1}/${PSY_QUESTIONS.length}`; document.getElementById('psyQuestion').textContent=PSY_QUESTIONS[psyIdx].text; }
function answerPsy(isO){
  const q=PSY_QUESTIONS[psyIdx]; if(isO) score[q.pos]=(score[q.pos]||0)+1; else score[{E:'I',I:'E',J:'P',P:'J',F:'T',T:'F'}[q.pos]]++;
  psyIdx++; if(psyIdx<PSY_QUESTIONS.length) renderPsy(); else showPsyResult();
}
function showPsyResult(){
  const EI=(score.E||0)>=(score.I||0)?'E':'I', JP=(score.J||0)>=(score.P||0)?'J':'P', FT=(score.F||0)>=(score.T||0)?'F':'T';
  let animal={emoji:'ğŸ¶',title:'í™œë°œí•œ ê°•ì•„ì§€',desc:'ì‚¬êµì„±Â·ì¦‰í¥ë ¥ì´ ê°•ì !'};
  if(EI==='E'&&JP==='J') animal={emoji:'ğŸ¦Š',title:'ë˜‘ë˜‘í•œ ì—¬ìš°',desc:'ê³„íšì  ì†Œí†µí˜• ë¦¬ë”'};
  if(EI==='I'&&JP==='P') animal={emoji:'ğŸ±',title:'ê³ ì–‘ì´ íƒí—˜ê°€',desc:'í˜¼ì ì¶©ì „Â·ë²ˆëœ©ì„'};
  if(EI==='I'&&JP==='J') animal={emoji:'ğŸ¦‰',title:'í˜„ì ì˜¬ë¹¼ë¯¸',desc:'ë¶„ì„Â·ì²´ê³„ ì „ëµê°€'};
  if(FT==='F'&&EI==='E') animal={emoji:'ğŸ¦¦',title:'ì‚¬êµì ì¸ ìˆ˜ë‹¬',desc:'íŒ€ ë¶„ìœ„ê¸° ë©”ì´ì»¤'};
  document.getElementById('psyStep').classList.add('hidden');
  document.getElementById('psyResult').classList.remove('hidden');
  document.getElementById('resEmoji').textContent=animal.emoji;
  document.getElementById('resTitle').textContent=animal.title;
  document.getElementById('resDesc').textContent=animal.desc;
  document.getElementById('resTags').innerHTML=['E/I','J/P','F/T'].map(t=>`<span class="px-2 py-1 bg-gray-100 rounded text-sm">#${t}</span>`).join(' ');
}
function resetPsy(){ psyIdx=0; score={E:0,I:0,J:0,P:0,F:0,T:0}; document.getElementById('psyStep').classList.remove('hidden'); document.getElementById('psyResult').classList.add('hidden'); renderPsy(); }
function openPsy(){ resetPsy(); showModal('psyModal'); track('click:menu_psy'); }

/* ====== MENU: ì¼ì • ====== */
const SCHEDULE=[
  { dayTitle:'ì²«ì§¸ ë‚  (10ì›” 16ì¼)', rows:[
    {time:'14:50',act:'ë¡œë¹„ ì§‘í•©',place:'ë¡¯ë°ë¦¬ì¡°íŠ¸ ë¶€ì—¬ì '},
    {time:'15:30',act:'ì²´í¬ì¸ ë° ë°©ë°°ì •',place:'ë¡¯ë°ë¦¬ì¡°íŠ¸ ë¶€ì—¬ì '},
    {time:'15:30',act:'ì•„ë¡œë§ˆ ë²„ë¬¼ë¦¬ ë§Œë“¤ê¸°',place:'ìˆ˜ë³µë¡œ1945'},
    {time:'16:00',act:'ì›ì¤€ë‹˜ ë„ìŠ¨íŠ¸ íˆ¬ì–´',place:'ë°±ì œë¬¸í™”ë‹¨ì§€'},
    {time:'17:30',act:'ììœ ì‹œê°„',place:'-'},
    {time:'18:30',act:'ì €ë…ì‹ì‚¬',place:'ì„œë™í•œìš° ê·œì•”ì '},
    {time:'21:00',act:'íšŒì‹ (ëœë¤ ìƒí’ˆ ë½‘ê¸° ì´ë²¤íŠ¸ / ì°¸ê°€ì í•œì •)\n*ë¶€ì—¬í†µë‹­ / ë³´ë ¹ë§¥ì£¼',place:'ë¶€ì—¬ë£¸íœì…˜ë¡œì¦ˆ'},
    {time:'22:00',act:'ììœ¨íœ´ì‹',place:'-'},
  ]},
  { dayTitle:'ë‘˜ì§¸ ë‚  (10ì›” 17ì¼)', rows:[
    {time:'11:00',act:'ì•„ì¹¨ ê²¸ ì ì‹¬ì‹ì‚¬',place:'ì¥ì› ë§‰êµ­ìˆ˜'},
    {time:'12:30',act:'ì›Œí¬ìˆ ì¥ì†Œ ì§‘í•©',place:'-'},
    {time:'12:30',act:'2026 íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì‚¬ì—… ì¶”ì§„ê³„íš / ë‚¨ë„í˜„ ì´ì‚¬',place:'ì‚¬ë¹„123ì°½ì‘ì„¼í„°'},
    {time:'13:10',act:'3íŒ€ ì„±ê³¼ ë° ì¶”ì§„ê³„íš / ê¹€ëŒ€ì§„ íŒ€ì¥',place:'ì‚¬ë¹„123ì°½ì‘ì„¼í„°'},
    {time:'13:30',act:'2íŒ€ ì„±ê³¼ ë° ì¶”ì§„ê³„íš / ê¹€í˜„ì²  íŒ€ì¥',place:'ì‚¬ë¹„123ì°½ì‘ì„¼í„°'},
    {time:'13:50',act:'1íŒ€ ì„±ê³¼ ë° ì¶”ì§„ê³„íš / ê¹€ìˆ˜ì¸ íŒ€ì¥',place:'ì‚¬ë¹„123ì°½ì‘ì„¼í„°'},
    {time:'14:10',act:'ê·€ê°€',place:'-'},
  ]},
];
function renderSchedule(){
  const body=document.getElementById('scheduleBody');
  body.innerHTML=SCHEDULE.map(day=>{
    const rows=day.rows.map(r=>`<tr>
      <td class="py-2 px-2 font-bold text-blue-600">${r.time}</td>
      <td class="py-2 px-2">${r.act.replaceAll('\\n','<br>')}</td>
      <td class="py-2 px-2 text-gray-600">${r.place}</td></tr>`).join('');
    return `<div class="bg-blue-50 rounded-lg px-3 py-2 font-extrabold text-blue-700 mt-1 mb-2">${day.dayTitle}</div>
      <table class="w-full border-collapse">
        <thead><tr class="text-left"><th class="py-2 px-2 w-20">ì‹œê°„</th><th class="py-2 px-2">í™œë™</th><th class="py-2 px-2 w-32">ì¥ì†Œ</th></tr></thead>
        <tbody class="border-t border-gray-200">${rows}</tbody>
      </table>`;
  }).join('');
}
function openSchedule(){ renderSchedule(); showModal('scheduleModal'); track('click:menu_schedule'); }

/* ====== MENU: ìë£Œì‹¤(ê³ ì •í˜•) ====== */
function openLibrary(){
  const list=document.getElementById('libList');
  list.innerHTML = LIBRARY_LINKS.map(x=>`<a class="menu-item" href="${normalizeUrl(x.url)}" target="_blank">
      <div class="font-bold">ğŸ”— ${x.title}</div>
      <div class="text-gray-500 text-sm">${x.desc||x.url}</div>
    </a>`).join('');
  showModal('libraryModal'); track('click:menu_library');
}

/* ====== MODAL HELPERS ====== */
function showModal(id){document.getElementById(id).style.display='flex';}
function hideModal(id){document.getElementById(id).style.display='none';}
document.querySelectorAll('.close').forEach(btn=>btn.addEventListener('click',()=>hideModal(btn.dataset.close)));
window.addEventListener('click',e=>{document.querySelectorAll('.modal').forEach(m=>{if(e.target===m) m.style.display='none';});});

/* ====== EVENTS ====== */
document.getElementById('loginBtn').addEventListener('click',doLogin);
document.getElementById('logoutBtn').addEventListener('click',doLogout);
document.querySelector('.logout').addEventListener('click',doLogout);
document.getElementById('startBtn').addEventListener('click',()=>{beginTimer(); track('click:start');});

document.getElementById('menuMbti').addEventListener('click',()=>{ window.open(RELATION_URL,'_blank'); track('click:mbti'); });
document.getElementById('menuVault').addEventListener('click',openVault);
document.getElementById('presetSave').addEventListener('click',saveVault);
document.getElementById('presetGo').addEventListener('click',goVault);

document.getElementById('menuFortune').addEventListener('click',openFortune);
document.getElementById('menuDraft').addEventListener('click',()=>{ window.open(TPV3_URL,'_blank'); track('click:tpv3'); });
document.getElementById('menuAI').addEventListener('click',()=>{ window.open(AI_CHATBOT_URL,'_blank'); track('click:ai'); });
document.getElementById('menuPsy').addEventListener('click',openPsy);
document.getElementById('btnO').addEventListener('click',()=>answerPsy(true));
document.getElementById('btnX').addEventListener('click',()=>answerPsy(false));
document.getElementById('psyRetry').addEventListener('click',resetPsy);
document.getElementById('menuSchedule').addEventListener('click',openSchedule);
document.getElementById('menuLibrary').addEventListener('click',openLibrary);

/* ====== INIT ====== */
(function init(){
  restore();
  const end=localStorage.getItem('workshopEndAt');
  if(end){ workshopEndAt=new Date(Number(end)); runTick(); clearGate(); }
})();
</script>
</body>
</html>
