<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìˆ</title>

  <!-- Part 2: ìŠ¤íƒ€ì¼(CSS) ì—¬ê¸° ì‚½ì… ì˜ˆì • -->
  <!-- ===== PART 2 PLACEHOLDER (CSS) ===== -->
</head>
<body>
  <div id="blurTarget" class="container">
    <div class="header">
      <h1>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€</h1>
      <p>2025 ì›Œí¬ìˆ</p>
    </div>

    <!-- ë¡œê·¸ì¸ -->
    <div id="loginScreen" class="card">
      <div class="form-group">
        <label for="userName">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</label>
        <select id="userName" required>
          <option value="">ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          <option value="ë‚¨ë„í˜„">ë‚¨ë„í˜„</option>
          <option value="ê¹€ìˆ˜ì¸">ê¹€ìˆ˜ì¸</option>
          <option value="ê³ ë‹¤í˜„">ê³ ë‹¤í˜„</option>
          <option value="ì‹¬ì¬í¬">ì‹¬ì¬í¬</option>
          <option value="íŒí‹°ë‹ˆì•ˆ">íŒí‹°ë‹ˆì•ˆ</option>
          <option value="ê¹€í˜„ì² ">ê¹€í˜„ì² </option>
          <option value="ì´ìœ ì§„">ì´ìœ ì§„</option>
          <option value="ì •ì–´ì§„">ì •ì–´ì§„</option>
          <option value="ì¥ì›ì¤€">ì¥ì›ì¤€</option>
          <option value="ê¹€ëŒ€ì§„">ê¹€ëŒ€ì§„</option>
          <option value="ì†í˜„ìš°">ì†í˜„ìš°</option>
          <option value="ì´ì£¼ì•„">ì´ì£¼ì•„</option>
          <option value="ì¥ì€ì§„">ì¥ì€ì§„</option>
        </select>
      </div>

      <div class="form-group">
        <label for="userMBTI">MBTIë¥¼ ì„ íƒí•˜ì„¸ìš”</label>
        <select id="userMBTI" required>
          <option value="">MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          <option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
          <option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
          <option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
          <option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
        </select>
      </div>

      <!-- âœ… ì°¸ì—¬ì½”ë“œ ì…ë ¥ (ì‹ ê·œ) -->
      <div class="form-group">
        <label for="userCode">ì°¸ì—¬ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
        <input id="userCode" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="ì˜ˆ: 20191001" />
      </div>

      <button class="btn btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>
    </div>

    <!-- ë©”ì¸ -->
    <div id="mainScreen" class="hidden">
      <div class="user-info">
        <h3 id="userNameDisplay"></h3>
        <p id="userTeamDisplay"></p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-top:.6rem;">
          <button class="btn btn-link" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
          <button class="btn btn-primary" id="startBtn">ì›Œí¬ìˆ ì°¸ì—¬í•˜ê¸°</button>
        </div>
      </div>

      <!-- âœ… ì°¸ì—¬ ì „ ì•ˆë‚´ ë¼ë²¨ (ì‹ ê·œ) -->
      <div id="gatedNote" class=""></div>

      <div class="card timer-card">
        <div style="font-size:1.05rem;margin-bottom:.6rem;opacity:.9;">ì›Œí¬ìˆ ë‚¨ì€ ì‹œê°„</div>
        <div id="timerDisplay" class="timer-display">48:00:00</div>
      </div>

      <div class="menu-grid">
        <a class="menu-item" id="relationMenu" href="#" target="_blank" rel="noopener">
          <div class="menu-title">ğŸ”— MBTI ê´€ê³„ë„</div>
          <div class="menu-desc">ìƒí˜¸ ê¶í•© ë³´ê¸°</div>
        </a>

        <div class="menu-item" id="scheduleMenu">
          <div class="menu-title">ğŸ—“ï¸ ì›Œí¬ìˆ ì¼ì •</div>
          <div class="menu-desc">í”„ë¡œê·¸ë¨</div>
        </div>

        <!-- íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨ -->
        <div class="menu-item" id="vaultMenu" tabindex="0">
          <div class="menu-title">ğŸ“ íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</div>
          <div class="menu-desc" id="vaultDesc">í‹°ì¼“ ì„ íƒ í›„ ë°”ë¡œ ì´ë™</div>
        </div>

        <!-- ë§Œì¡±ë„ ì„¤ë¬¸ -->
        <div class="menu-item" id="surveyMenu">
          <div class="menu-title">ğŸ“ ë§Œì¡±ë„ ì„¤ë¬¸</div>
          <div class="menu-desc">ë°”ë¡œ ì°¸ì—¬</div>
        </div>

        <!-- ë°ì¼ë¦¬ í¬ì¶˜ -->
        <div class="menu-item" id="fortuneMenu">
          <div class="menu-title">ğŸ”® ë°ì¼ë¦¬ í¬ì¶˜</div>
          <div class="menu-desc">ì˜¤ëŠ˜ì˜ ìš´ì„¸</div>
        </div>

        <!-- íˆ¬ì–´íŒ¨ìŠ¤ v3 ì´ˆì•ˆ -->
        <div class="menu-item" id="tpv3Menu">
          <div class="menu-title">ğŸ§© íˆ¬ì–´íŒ¨ìŠ¤ v3 ì´ˆì•ˆ</div>
          <div class="menu-desc">í”„ë¡œí† íƒ€ì…</div>
        </div>

        <!-- AI ì±—ë´‡ -->
        <a class="menu-item" id="aiMenu" href="#" target="_blank" rel="noopener">
          <div class="menu-title">ğŸ¤– AI ì±—ë´‡</div>
          <div class="menu-desc">ì›Œí¬ìˆ ì „ìš© í—¬í¼</div>
        </a>

        <!-- ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ -->
        <div class="menu-item" id="psyMenu">
          <div class="menu-title">ğŸ§  ì‹¬ë¦¬í…ŒìŠ¤íŠ¸</div>
          <div class="menu-desc">O/X 5ë¬¸í•­ Â· ë™ë¬¼ ê²°ê³¼</div>
        </div>

        <!-- âœ… ìë£Œì‹¤ (ì‹ ê·œ ë²„íŠ¼) -->
        <div class="menu-item" id="libraryMenu">
          <div class="menu-title">ğŸ“š ìë£Œì‹¤</div>
          <div class="menu-desc">ë§í¬ 4ì¢…</div>
        </div>
      </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div id="alertMessage" class="hidden"></div>
  </div>

  <!-- íƒ€ì´ë¨¸ ì¢…ë£Œ ì˜¤ë²„ë ˆì´ -->
  <div id="overlay" class="overlay">
    <div class="overlay-card">
      <h2>ì›Œí¬ìˆì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
      <p>ì„¤ë¬¸ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.</p>
      <button class="btn btn-primary" id="openSurveyFromOverlay">ì„¤ë¬¸ ì‹œì‘í•˜ê¸°</button>
    </div>
  </div>

  <!-- MBTI ëª¨ë‹¬ -->
  <div id="mbtiModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ì°¸ê°€ì í˜„í™©</h2>
        <button class="close-btn" data-close="mbtiModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="stats-grid">
          <div class="card"><div class="q-title">ì´ ì°¸ê°€ì</div><div id="totalParticipants" style="font-size:1.6rem;font-weight:900;color:var(--primary-brand)">0</div></div>
          <div class="card"><div class="q-title">í˜„ì¬ ì ‘ì†</div><div id="onlineCount" style="font-size:1.6rem;font-weight:900;color:var(--primary-brand)">0</div></div>
        </div>
        <h3>MBTI ë¶„í¬</h3>
        <div class="mbti-grid" id="mbtiDistribution"></div>
        <div style="margin-top:1rem;display:flex;gap:.6rem;">
          <a id="relationBtn" href="#" class="btn btn-link" target="_blank" rel="noopener">MBTI ê´€ê³„ë„ ë³´ê¸°</a>
        </div>
      </div>
    </div>
  </div>

  <!-- íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨ -->
  <div id="vaultModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</h2>
        <button class="close-btn" data-close="vaultModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="card">
          <div class="q-title" style="display:flex;justify-content:space-between;align-items:center;">
            <span>ì‚¬ì „ ë“±ë¡ í‹°ì¼“ ì„ íƒ</span>
            <button class="btn btn-link" id="vaultClearBtn" style="width:auto;padding:.5rem .8rem">ì„ íƒ í•´ì œ</button>
          </div>
          <div id="presetList"></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-top:.8rem;">
            <button class="btn btn-primary" id="savePresetBtn">ì„ íƒ ì €ì¥</button>
            <button class="btn btn-secondary" id="goPresetBtn">ì €ì¥ ì—†ì´ ì´ë™</button>
          </div>
          <div class="k-tip" id="currentChoiceTip" style="margin-top:.5rem;text-align:center;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë°ì¼ë¦¬ í¬ì¶˜ ëª¨ë‹¬ -->
  <div id="fortuneModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ë°ì¼ë¦¬ í¬ì¶˜</h2>
        <button class="close-btn" data-close="fortuneModal">&times;</button>
      </div>
      <div class="modal-body" id="fortuneBody"></div>
    </div>
  </div>

  <!-- TP v3 ëª¨ë‹¬ (URL ë¯¸ì„¤ì • ì‹œ) -->
  <div id="tpv3Modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>íˆ¬ì–´íŒ¨ìŠ¤ v3 ì´ˆì•ˆ</h2>
        <button class="close-btn" data-close="tpv3Modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="card">
          <div class="q-title">í”„ë¡œí† íƒ€ì… ì¤€ë¹„ ì¤‘</div>
          <p style="color:var(--text-secondary)">ì™¸ë¶€ URLì´ ì„¤ì •ë˜ë©´ ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤. í˜„ì¬ëŠ” ê°„ë‹¨ ìš”ì•½ë§Œ ë³´ì—¬ë“œë ¤ìš”.</p>
        </div>
        <div class="card">
          <div class="q-title">í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
          <ul style="padding-left:1rem; color:var(--text-secondary); line-height:1.9">
            <li>QR ì¸ì¦ UX: ìŠ¤ìº” â†’ ê²°ê³¼ í”¼ë“œë°± 1ì´ˆ ë‚´</li>
            <li>ê°€ë§¹ì  ì•ˆë‚´: ëŒ€ê¸°/í˜¼ì¡ë„, ì¶”ì²œ ì½”ìŠ¤, ìš´ì˜ì‹œê°„</li>
            <li>ì™¸êµ­ì–´ ëŒ€ì‘: ë‹¤êµ­ì–´ ìë™ê°ì§€ + ê°„í¸ ì „í™˜</li>
            <li>ì¿ í°/í˜œíƒ: ë‚¨ì€ì‹œê°„Â·ì”ì—¬í˜œíƒ ì‹¤ì‹œê°„ í‘œì‹œ</li>
            <li>ì ‘ê·¼ì„±: í°íŠ¸/ëŒ€ë¹„/í„°ì¹˜ ì˜ì—­ ìµœì í™”</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… ì¼ì • ëª¨ë‹¬ -->
  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ì›Œí¬ìˆ ì¼ì •</h2>
        <button class="close-btn" data-close="scheduleModal">&times;</button>
      </div>
      <div class="modal-body" id="scheduleBody">
        <!-- JSì—ì„œ í‘œë¡œ ë Œë”ë§ -->
      </div>
    </div>
  </div>

  <!-- âœ… ì„¤ë¬¸ì¡°ì‚¬ ëª¨ë‹¬ -->
  <div id="surveyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ì›Œí¬ìˆ ë§Œì¡±ë„ ì„¤ë¬¸</h2>
        <button class="close-btn" data-close="surveyModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="surveyForm">
          <div class="q-card">
            <div class="q-title">1) ì „ì²´ ë§Œì¡±ë„ (5ì  ë§Œì )</div>
            <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:.5rem">
              <label class="btn btn-link" style="padding:.7rem 0;text-align:center">
                <input type="radio" name="satisfaction" value="1" required> 1
              </label>
              <label class="btn btn-link" style="padding:.7rem 0;text-align:center">
                <input type="radio" name="satisfaction" value="2"> 2
              </label>
              <label class="btn btn-link" style="padding:.7rem 0;text-align:center">
                <input type="radio" name="satisfaction" value="3"> 3
              </label>
              <label class="btn btn-link" style="padding:.7rem 0;text-align:center">
                <input type="radio" name="satisfaction" value="4"> 4
              </label>
              <label class="btn btn-link" style="padding:.7rem 0;text-align:center">
                <input type="radio" name="satisfaction" value="5"> 5
              </label>
            </div>
          </div>

          <div class="q-card">
            <div class="q-title">2) ê°€ì¥ ë§Œì¡±í–ˆë˜ ë¶€ë¶„</div>
            <div style="display:grid;gap:.5rem">
              <label><input type="radio" name="best" value="ìˆ™ì†Œ" required> ìˆ™ì†Œ</label>
              <label><input type="radio" name="best" value="ìŒì‹"> ìŒì‹</label>
              <label><input type="radio" name="best" value="ì„±ê³¼ ë° ì¶”ì§„ë³´ê³ "> ì„±ê³¼ ë° ì¶”ì§„ë³´ê³ </label>
              <label style="display:grid;gap:.4rem">
                <span><input type="radio" name="best" value="ê¸°íƒ€"> ê¸°íƒ€</span>
                <input id="bestOther" type="text" placeholder="ê¸°íƒ€ë¥¼ ì„ íƒí–ˆë‹¤ë©´ ì…ë ¥í•´ì£¼ì„¸ìš” (ì„ íƒ)" />
              </label>
            </div>
          </div>

          <div class="q-card">
            <div class="q-title">3) ê°œì„ ì‚¬í•­ (ììœ  ì„œìˆ )</div>
            <textarea name="improve" rows="4" placeholder="ì˜ˆ) ì¼ì • ê°„ê²© ì¡°ì •, ì´ë™ ë™ì„  ë‹¨ì¶•, í”„ë¡œê·¸ë¨ ì¶”ê°€ ì•„ì´ë””ì–´ ë“±"></textarea>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem">
            <button type="button" class="btn btn-secondary" id="surveyCancel">ë‹«ê¸°</button>
            <button type="submit" class="btn btn-primary">ì œì¶œí•˜ê¸°</button>
          </div>
          <p class="k-tip" style="margin-top:.5rem">â€» ë³¸ ì„¤ë¬¸ì€ ì„œë²„ì— ì €ì¥ë˜ë©°, ì œì¶œ í›„ ìš”ì•½ë„ í™”ë©´ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        </form>

        <div id="surveyResult" class="kawaii-card hidden" style="margin-top:1rem">
          <span class="k-badge">ì œì¶œ ì™„ë£Œ</span>
          <div class="k-head">
            <div class="k-emoji">ğŸ‰</div>
            <div class="k-title">ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!</div>
          </div>
          <div id="surveySummary" class="k-desc" style="margin-top:.25rem"></div>
          <div class="k-actions">
            <button class="btn btn-secondary" id="surveyReset">ë‹¤ì‹œ ì‘ì„±</button>
            <button class="btn btn-primary" id="surveyClose">ë‹«ê¸°</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ëª¨ë‹¬ -->
  <div id="psyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>O/X ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ (5ë¬¸í•­)</h2>
        <button class="close-btn" data-close="psyModal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- ì§„í–‰ -->
        <div id="psyStep" class="card">
          <div class="q-title" id="psyTitle">1/5</div>
          <div class="progress-wrap" id="psyProgress"></div>
          <div id="psyQuestion" style="font-size:1.05rem;margin:.25rem 0 1rem;"></div>
          <div class="ox-wrap">
            <button class="ox-btn" id="btnO">O (ê·¸ë ‡ë‹¤)</button>
            <button class="ox-btn" id="btnX">X (ì•„ë‹ˆë‹¤)</button>
          </div>
        </div>
        <!-- ê²°ê³¼ -->
        <div id="psyResult" class="kawaii-card hidden">
          <span class="k-badge">í…ŒìŠ¤íŠ¸ ê²°ê³¼</span>
          <div class="k-head">
            <div class="k-emoji" id="resEmoji">ğŸ¶</div>
            <div class="k-title" id="resTitle">í™œë°œí•œ ê°•ì•„ì§€</div>
          </div>
          <p class="k-desc" id="resDesc">ì‚¬ëŒì´ ì¢‹ê³  ìƒˆë¡œìš´ ìê·¹ì— ì„¤ë Œë‹¤!</p>
          <div class="k-stickers" id="resStickers">âœ¨ ğŸ¾ ğŸˆ</div>
          <div class="k-tags" id="resTags"></div>
          <div class="k-bars" id="resBars"></div>
          <div class="k-actions">
            <button class="btn btn-secondary" id="psyRetry">ë‹¤ì‹œ í•˜ê¸°</button>
            <button class="btn btn-primary" id="psyClose">ë‹«ê¸°</button>
          </div>
          <div class="k-tip">í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… ìë£Œì‹¤ ëª¨ë‹¬ (ì‹ ê·œ) -->
  <div id="libraryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ìë£Œì‹¤ (ìµœëŒ€ 4ê°œ ë§í¬)</h2>
        <button class="close-btn" data-close="libraryModal">&times;</button>
      </div>
      <div class="modal-body" id="libraryBody">
        <div class="card">
          <div class="q-title">ë§í¬ ì…ë ¥</div>
          <div id="libForm" style="display:grid;gap:.8rem"><!-- JSë¡œ 4ê°œ ìŠ¬ë¡¯ ë Œë” --></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-top:.6rem">
            <button class="btn btn-secondary" id="libLoadBtn">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn btn-primary" id="libSaveBtn">ì €ì¥í•˜ê¸°</button>
          </div>
          <p class="k-tip" style="margin-top:.5rem">â€» ì €ì¥ ì‹œ ë°±ì—”ë“œ(GAS) <code>links</code> ì‹œíŠ¸ì— ê¸°ë¡ë©ë‹ˆë‹¤.</p>
        </div>

        <div class="card">
          <div class="q-title">ì €ì¥ëœ ë§í¬</div>
          <div id="libList" style="display:grid;gap:.5rem"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Part 3~5: ìŠ¤í¬ë¦½íŠ¸(JS) ì—¬ê¸° ì‚½ì… ì˜ˆì • -->
  <!-- ===== PART 3 PLACEHOLDER (CONFIG & UTILS JS) ===== -->
  <!-- ===== PART 4 PLACEHOLDER (CORE FEATURES JS) ===== -->
  <!-- ===== PART 5 PLACEHOLDER (TRACKING & INIT JS) ===== -->
</body>
</html>
<style>
@import url('https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css');
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

:root {
  --primary-brand: #1e40af;
  --secondary-brand: #3b82f6;
  --accent-warm: #f59e0b;
  --accent-cool: #06b6d4;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --bg-light: #ffffff;
  --bg-panel: #f8fafc;
  --line: #e2e8f0;
  --danger: #ef4444;
  --success: #10b981;
}

body {
  font-family: 'Pretendard', sans-serif;
  background: var(--bg-panel);
  color: var(--text-primary);
  margin: 0;
  padding: 0;
}

.container {
  max-width: 640px;
  margin: 0 auto;
  padding: 1rem;
}

.header {
  text-align: center;
  margin-bottom: 1.5rem;
}

.card {
  background: var(--bg-light);
  border: 1px solid var(--line);
  border-radius: 1rem;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.form-group { margin-bottom: 1rem; }
.form-group label { font-weight: 600; display: block; margin-bottom: .4rem; }

input, select, textarea {
  width: 100%;
  border: 1px solid var(--line);
  border-radius: .5rem;
  padding: .5rem .6rem;
  font-size: .95rem;
  transition: border .2s;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--secondary-brand);
  box-shadow: 0 0 0 1px var(--secondary-brand);
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn {
  display: inline-block;
  border: none;
  border-radius: .6rem;
  font-weight: 600;
  text-align: center;
  cursor: pointer;
  padding: .7rem 1rem;
  transition: all .2s;
}

.btn-primary {
  background: var(--primary-brand);
  color: #fff;
}
.btn-primary:hover { background: #1d4ed8; }

.btn-secondary {
  background: var(--accent-cool);
  color: #fff;
}
.btn-secondary:hover { background: #0891b2; }

.btn-link {
  background: var(--bg-light);
  border: 1px solid var(--line);
  color: var(--text-primary);
}
.btn-link:hover { background: var(--bg-panel); }

.hidden { display: none !important; }

/* ë©”ë‰´ ê·¸ë¦¬ë“œ */
.menu-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: .8rem;
  margin-top: 1rem;
}

.menu-item {
  background: var(--bg-light);
  border-radius: .8rem;
  border: 1px solid var(--line);
  padding: .8rem;
  cursor: pointer;
  transition: background .2s;
}
.menu-item:hover { background: var(--bg-panel); }
.menu-title { font-weight: 600; font-size: 1rem; margin-bottom: .25rem; }
.menu-desc { font-size: .85rem; color: var(--text-secondary); }

/* íƒ€ì´ë¨¸ */
.timer-card { text-align: center; }
.timer-display { font-size: 2rem; font-weight: 800; color: var(--primary-brand); }

/* ëª¨ë‹¬ */
.modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.modal-content {
  background: #fff;
  border-radius: 1rem;
  padding: 1rem 1.25rem;
  max-height: 85vh;
  overflow-y: auto;
  width: 90%;
  max-width: 600px;
  position: relative;
}
.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: .75rem;
}
.close-btn {
  border: none;
  background: none;
  font-size: 1.6rem;
  cursor: pointer;
}

/* ì˜¤ë²„ë ˆì´ (íƒ€ì´ë¨¸ ì¢…ë£Œ) */
.overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,.7);
  align-items: center;
  justify-content: center;
  z-index: 9998;
}
.overlay-card {
  background: #fff;
  padding: 2rem;
  border-radius: 1rem;
  text-align: center;
}

/* ì•Œë¦¼ */
#alertMessage {
  position: fixed;
  bottom: 1.2rem;
  left: 50%;
  transform: translateX(-50%);
  background: var(--primary-brand);
  color: #fff;
  padding: .75rem 1.5rem;
  border-radius: .6rem;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  z-index: 99999;
  opacity: 0;
  transition: opacity .3s;
}
#alertMessage.show { opacity: 1; }

/* ê²Œì´íŠ¸ (ì°¸ì—¬ ì „ ë¸”ë¼ì¸ë“œ) */
#gatedNote {
  display: none;
  text-align: center;
  margin: .8rem 0;
  color: var(--text-secondary);
}
#gatedNote.on { display: block; }
#gatedNote b { color: var(--primary-brand); }
#mainScreen.gated .menu-grid {
  filter: blur(3px);
  pointer-events: none;
}

/* kawaii ì¹´ë“œ */
.kawaii-card {
  background: #fff;
  border: 1px solid var(--line);
  border-radius: 1rem;
  text-align: center;
  padding: 1rem;
}
.k-badge {
  background: var(--accent-cool);
  color: #fff;
  border-radius: .5rem;
  padding: .2rem .6rem;
  font-size: .8rem;
}
.k-head { margin-top: .6rem; }
.k-emoji { font-size: 2rem; }
.k-title { font-weight: 700; margin-top: .3rem; }
.k-desc { color: var(--text-secondary); font-size: .9rem; margin-top: .4rem; }
.k-actions { margin-top: 1rem; display: flex; gap: .5rem; justify-content: center; }

/* progress/ox */
.progress-wrap {
  height: 8px;
  background: var(--line);
  border-radius: 4px;
  margin-bottom: 1rem;
  overflow: hidden;
}
.progress-wrap::after {
  content: "";
  display: block;
  height: 8px;
  background: var(--primary-brand);
  width: 0%;
  transition: width .3s;
}
.ox-wrap {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}
.ox-btn {
  font-size: 1rem;
  font-weight: 700;
  padding: 1rem 0;
  border-radius: .8rem;
  background: var(--secondary-brand);
  color: #fff;
  border: none;
  cursor: pointer;
}
.ox-btn:hover { background: #2563eb; }

/* small helper classes */
.text-center { text-align: center; }
.k-tip { font-size: .8rem; color: var(--text-secondary); }

</style>
<script>
/* ===========================
   ğŸ§­ CONFIG
=========================== */

// âœ… ë°±ì—”ë“œ Web App URL (Deploy as Web App)
const API_URL = "https://script.google.com/macros/s/AKfycbxM8pNBBnAxRyoIYHO8be82IzlTCPYOcRRjq_aoiTvcyoprVNhfXQx_KsZlVSVGJlhn/exec";

// ì°¸ì—¬ì½”ë“œ ë§¤í•‘
const PARTICIPATION_CODES = {
  "ë‚¨ë„í˜„": "20191001",
  "ê¹€í˜„ì² ": "20200211",
  "ê¹€ìˆ˜ì¸": "202201171",
  "ê¹€ëŒ€ì§„": "202201172",
  "ì´ì£¼ì•„": "20220118",
  "ì¥ì€ì§„": "20221101",
  "ì´ìœ ì§„": "20230614",
  "ì •ì–´ì§„": "20240419",
  "íŒí‹°ë‹ˆì•ˆ": "20250507",
  "ì¥ì›ì¤€": "20250526",
  "ê³ ë‹¤í˜„": "20250804",
  "ì‹¬ì¬í¬": "20250901",
  "ì†í˜„ìš°": "20251014"
};
function validateParticipation(name, code){
  const need = PARTICIPATION_CODES[name] || '';
  return need && code && String(need).trim() === String(code).trim();
}

/* ===========================
   ğŸŒ API UTILS
=========================== */

async function apiRequest(action, payload = {}) {
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action, ...payload }),
    });
    return await res.json();
  } catch (e) {
    console.error("API Request Error", e);
    return { success: false, error: String(e) };
  }
}

/* ===========================
   ğŸ§© GLOBAL STATE
=========================== */

let currentUser = "";
let sessionId = "";
let workshopEndAt = null;
let timerInterval = null;
let timerRunning = false;

/* ===========================
   ğŸ’¬ ALERT / TOAST
=========================== */

function showAlert(msg, type = "info", dur = 2200) {
  const el = document.getElementById("alertMessage");
  if (!el) return;
  el.innerText = msg;
  el.style.background = type === "error" ? "var(--danger)" : type === "success" ? "var(--success)" : "var(--primary-brand)";
  el.classList.add("show");
  el.classList.remove("hidden");
  setTimeout(() => el.classList.remove("show"), dur);
}

/* ===========================
   ğŸ•’ TIMER & GATE
=========================== */

function applyGateOn(){
  const ms = document.getElementById('mainScreen');
  ms.classList.add('gated');
  const note = document.getElementById('gatedNote');
  note.classList.add('on');
  note.innerHTML = 'ğŸ”’ ì•„ë˜ ë©”ë‰´ëŠ” <b>â€œì›Œí¬ìˆ ì°¸ì—¬í•˜ê¸°â€</b> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—´ë¦½ë‹ˆë‹¤.';
}
function removeGate(){
  const ms = document.getElementById('mainScreen');
  ms.classList.remove('gated');
  document.getElementById('gatedNote').classList.remove('on');
}

/* ===========================
   ğŸ§­ HELPERS
=========================== */

function escapeHtml(str=""){
  return str.replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function normalizeUrl(url=""){
  if(!url) return "#";
  if(!/^https?:\/\//.test(url)) return "https://" + url;
  return url;
}
function formatTime(ms){
  const t = Math.max(0, Math.floor(ms/1000));
  const h = String(Math.floor(t/3600)).padStart(2,"0");
  const m = String(Math.floor(t%3600/60)).padStart(2,"0");
  const s = String(t%60).padStart(2,"0");
  return `${h}:${m}:${s}`;
}

/* ===========================
   â± TIMER LOGIC
=========================== */
function beginTimerInterval(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    const now = new Date();
    const remain = workshopEndAt - now;
    if(remain <= 0){
      clearInterval(timerInterval);
      timerInterval = null;
      timerRunning = false;
      document.getElementById("timerDisplay").textContent = "00:00:00";
      document.getElementById("overlay").style.display = "flex";
      return;
    }
    document.getElementById("timerDisplay").textContent = formatTime(remain);
  },1000);
}

function startTimer(){
  const stored = localStorage.getItem("workshopEndAt");
  if(stored){ showAlert("ì´ë¯¸ ì¹´ìš´íŠ¸ë‹¤ìš´ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤."); beginTimerInterval(); removeGate(); return; }
  const endTs = Date.now() + 48*60*60*1000;
  localStorage.setItem("workshopEndAt",String(endTs));
  workshopEndAt = new Date(endTs);
  beginTimerInterval();
  removeGate();
  showAlert("ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘!");
}

/* ===========================
   ğŸ§­ EVENT TRACKING UTILITY
=========================== */
async function trackEvent(eventName, meta = {}){
  try {
    await apiRequest("trackEvent", {
      sessionId,
      userName: currentUser || "",
      event: eventName,
      meta
    });
  } catch(e){ console.warn("Track fail", e); }
}
</script>
<script>
/* ===========================
   ğŸ‘¤ LOGIN LOGIC
=========================== */
async function handleLogin() {
  const userName = document.getElementById("userName").value.trim();
  const userMBTI = document.getElementById("userMBTI").value.trim();
  const userCode = (document.getElementById("userCode").value || "").trim();

  if (!userName || !userMBTI) return showAlert("ì´ë¦„ê³¼ MBTIë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
  if (!userCode) return showAlert("ì°¸ì—¬ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");

  if (!validateParticipation(userName, userCode)) {
    trackEvent("login_denied", { userName, reason: "code_mismatch" });
    return showAlert("ì°¸ì—¬ì½”ë“œê°€ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
  }

  currentUser = userName;
  sessionId = "session_" + Date.now();

  // ì„œë²„ ë¡œê·¸ì¸
  const res = await apiRequest("login", {
    sessionId, userName, mbti: userMBTI, team: "", position: ""
  });
  if (!res.success) {
    showAlert("ì„œë²„ ì—°ê²° ë¶ˆê°€: ë¡œì»¬ ëª¨ë“œë¡œ ì§„ì…í•©ë‹ˆë‹¤.", "error");
  }

  // ìºì‹œ ì €ì¥
  localStorage.setItem("loginCache", JSON.stringify({ userName, userMBTI, userCode, ts: Date.now() }));
  localStorage.setItem("currentUser", userName);
  localStorage.setItem("sessionId", sessionId);

  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainScreen").classList.remove("hidden");
  document.getElementById("userNameDisplay").textContent = userName;
  document.getElementById("userTeamDisplay").textContent = "íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€";

  showAlert(`í™˜ì˜í•©ë‹ˆë‹¤, ${userName}ë‹˜!`, "success");
  trackEvent("login", { mbti: userMBTI });

  const storedEnd = localStorage.getItem("workshopEndAt");
  if (storedEnd) { workshopEndAt = new Date(Number(storedEnd)); beginTimerInterval(); removeGate(); } 
  else applyGateOn();
}

async function handleLogout() {
  if (!confirm("ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  await apiRequest("updateUserStatus", { userName: currentUser, sessionId, status: "offline" });
  localStorage.clear();
  location.reload();
}

/* ===========================
   ğŸšª SESSION RESTORE / AUTO LOGIN
=========================== */
function restoreSession() {
  const cacheStr = localStorage.getItem("loginCache");
  if (!cacheStr) return;
  try {
    const cache = JSON.parse(cacheStr);
    if (validateParticipation(cache.userName, cache.userCode)) {
      currentUser = cache.userName;
      sessionId = localStorage.getItem("sessionId") || "session_" + Date.now();
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("mainScreen").classList.remove("hidden");
      document.getElementById("userNameDisplay").textContent = currentUser;
      document.getElementById("userTeamDisplay").textContent = "íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€";
      const storedEnd = localStorage.getItem("workshopEndAt");
      if (storedEnd) { workshopEndAt = new Date(Number(storedEnd)); beginTimerInterval(); removeGate(); } 
      else applyGateOn();
      showAlert(`ìë™ë¡œê·¸ì¸: ${currentUser}ë‹˜`, "success");
    }
  } catch (_) { console.warn("restoreSession fail"); }
}

/* ===========================
   ğŸ• START WORKSHOP BUTTON
=========================== */
document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("loginBtn").addEventListener("click", handleLogin);
  document.getElementById("logoutBtn").addEventListener("click", handleLogout);
  document.getElementById("startBtn").addEventListener("click", ()=>{ startTimer(); trackEvent("click:start_workshop"); });
});

/* ===========================
   ğŸ“‹ SURVEY LOGIC
=========================== */
async function handleSurveySubmit(e){
  e.preventDefault();
  const fd = new FormData(e.target);
  const satisfaction = fd.get("satisfaction");
  let best = fd.get("best") || "";
  const bestOther = document.getElementById("bestOther").value.trim();
  if (best === "ê¸°íƒ€" && bestOther) best = `ê¸°íƒ€(${bestOther})`;
  const improve = (fd.get("improve") || "").trim();

  let saved = false;
  try {
    const res = await apiRequest("saveSurvey", {
      user: currentUser || "ê²ŒìŠ¤íŠ¸",
      satisfaction,
      useful_program: best || "",
      feedback: improve || ""
    });
    saved = !!(res && res.success);
  } catch(_) {}
  trackEvent("submit:survey", { satisfaction, best, hasImprove: !!improve });

  showAlert(saved ? "ì„¤ë¬¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤." : "ì €ì¥ ì‹¤íŒ¨: í™”ë©´ì—ë§Œ í‘œì‹œë©ë‹ˆë‹¤.", saved ? "success" : "error");

  const summary = `
    <div class="card">
      <div class="q-title">ìš”ì•½</div>
      <div><b>ë§Œì¡±ë„</b>: ${satisfaction} / 5</div>
      <div><b>ê°€ì¥ ë§Œì¡±</b>: ${best || "-"}</div>
      <div><b>ê°œì„ ì‚¬í•­</b>: ${escapeHtml(improve || "-")}</div>
    </div>`;
  document.getElementById("surveySummary").innerHTML = summary;
  document.getElementById("surveyForm").classList.add("hidden");
  document.getElementById("surveyResult").classList.remove("hidden");
}

/* ===========================
   ğŸ—‚ ìë£Œì‹¤ (LIBRARY)
=========================== */
function renderLibSlots(items=[]){
  const wrap=document.getElementById("libForm");
  const fill=i=>items[i]||{title:"",url:"",category:"",description:""};
  wrap.innerHTML=Array.from({length:4}).map((_,i)=>{
    const it=fill(i);
    return `
      <div class="q-card" data-slot="${i}">
        <div class="q-title">ë§í¬ ${i+1}</div>
        <div style="display:grid;gap:.4rem">
          <input type="text" placeholder="ì œëª©" value="${escapeHtml(it.title||"")}"/>
          <input type="text" placeholder="URL (https://â€¦)" value="${escapeHtml(it.url||"")}"/>
          <input type="text" placeholder="ì¹´í…Œê³ ë¦¬" value="${escapeHtml(it.category||"")}"/>
          <input type="text" placeholder="ì„¤ëª…" value="${escapeHtml(it.description||"")}"/>
        </div>
      </div>`;}).join("");
}

async function openLibrary(){
  let items=[];
  try{
    const res=await apiRequest("getLinks",{user:currentUser||""});
    if(res&&res.success&&Array.isArray(res.items)){
      items=res.items.slice(-4).map(x=>({
        title:x.title||"",url:x.url||"",category:x.category||"",description:x.description||""
      }));
    }
  }catch(_){}
  renderLibSlots(items); renderLibList(items);
  document.getElementById("libraryModal").style.display="block";
  trackEvent("click:menu_library");
}

function renderLibList(items=[]){
  const list=document.getElementById("libList");
  if(!items.length){list.innerHTML='<div class="k-tip">ì €ì¥ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';return;}
  list.innerHTML=items.map(it=>`
    <a class="menu-item" href="${normalizeUrl(it.url||"#")}" target="_blank">
      <div class="menu-title">ğŸ”— ${escapeHtml(it.title||"(ì œëª© ì—†ìŒ)")}</div>
      <div class="menu-desc">${escapeHtml(it.url||"")}</div>
    </a>`).join("");
}

async function saveLibrary(){
  const cards=Array.from(document.querySelectorAll("#libForm .q-card"));
  let savedCnt=0;
  for(const c of cards){
    const [titleEl,urlEl,catEl,descEl]=c.querySelectorAll("input");
    const title=titleEl.value.trim();const url=urlEl.value.trim();
    if(!title&&!url) continue;
    try{
      const res=await apiRequest("saveLink",{
        user:currentUser||"",title,url,category:catEl.value.trim(),description:descEl.value.trim()
      });
      if(res&&res.success) savedCnt++;
    }catch(_){}
  }
  showAlert(savedCnt>0?`${savedCnt}ê°œ ë§í¬ ì €ì¥ ì™„ë£Œ`:"ì €ì¥í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤",savedCnt>0?"success":"error");
  trackEvent("click:library_save",{count:savedCnt});
  const res = await apiRequest("getLinks",{user:currentUser||""});
  if(res&&res.success) renderLibList(res.items.slice(-4));
}

/* ===========================
   ğŸ¬ MODAL EVENTS INIT
=========================== */
document.addEventListener("DOMContentLoaded",()=>{
  // ì„¤ë¬¸
  document.getElementById("surveyForm").addEventListener("submit",handleSurveySubmit);
  document.getElementById("surveyClose").addEventListener("click",()=>document.getElementById("surveyModal").style.display="none");
  document.getElementById("surveyMenu").addEventListener("click",()=>{document.getElementById("surveyModal").style.display="block";trackEvent("click:menu_survey");});
  document.getElementById("openSurveyFromOverlay").addEventListener("click",()=>{document.getElementById("overlay").style.display="none";document.getElementById("surveyModal").style.display="block";});
  
  // ìë£Œì‹¤
  document.getElementById("libraryMenu").addEventListener("click",openLibrary);
  document.getElementById("libSaveBtn").addEventListener("click",saveLibrary);
  document.getElementById("libLoadBtn").addEventListener("click",openLibrary);

  // ì„¸ì…˜ ë³µì›
  restoreSession();
});
</script>
<script>
/* ===========================
   ğŸ§­ INITIALIZATION (FINAL)
=========================== */

document.addEventListener("DOMContentLoaded", () => {
  console.log("âœ… TourPass Workshop App Loaded");

  // íƒ€ì´ë¨¸ í‘œì‹œ ì´ˆê¸°í™”
  const storedEnd = localStorage.getItem("workshopEndAt");
  if (storedEnd) {
    workshopEndAt = new Date(Number(storedEnd));
    beginTimerInterval();
    removeGate();
  } else {
    applyGateOn();
  }

  // ì˜¤ë²„ë ˆì´ (íƒ€ì´ë¨¸ ì¢…ë£Œ í›„)
  const overlay = document.getElementById("overlay");
  const surveyBtn = document.getElementById("openSurveyFromOverlay");
  if (overlay && surveyBtn) {
    surveyBtn.addEventListener("click", () => {
      overlay.style.display = "none";
      document.getElementById("surveyModal").style.display = "block";
      trackEvent("click:overlay_survey");
    });
  }

  // ëª¨ë‹¬ ë‹«ê¸° ê³µí†µ
  document.querySelectorAll(".close-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      btn.closest(".modal").style.display = "none";
    });
  });

  // ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
  window.addEventListener("click", (e) => {
    document.querySelectorAll(".modal").forEach(modal => {
      if (e.target === modal) modal.style.display = "none";
    });
  });

  // íƒ€ì´ë¨¸ ìƒíƒœ í™•ì¸ (1ì´ˆë§ˆë‹¤)
  setInterval(() => {
    const stored = localStorage.getItem("workshopEndAt");
    if (stored && !timerRunning) {
      workshopEndAt = new Date(Number(stored));
      beginTimerInterval();
    }
  }, 2000);

  // ë²„íŠ¼ë³„ ìë™ íŠ¸ë˜í‚¹
  document.querySelectorAll("button[data-track], .menu-item[data-track]").forEach(el => {
    el.addEventListener("click", () => {
      trackEvent(`click:${el.dataset.track}`);
    });
  });

  // ë¡œê·¸ì¸ ìºì‹œ ë³µì› ì‹œë„
  restoreSession();
});

/* ===========================
   ğŸ§¾ TRACKING EXTENSION
=========================== */

// ì¶”ê°€ íŠ¸ë˜í‚¹ í¬ì¸íŠ¸
function trackButtonClicks() {
  const map = {
    startBtn: "click:start_workshop",
    logoutBtn: "click:logout",
    surveyMenu: "click:menu_survey",
    libraryMenu: "click:menu_library",
    libSaveBtn: "click:library_save",
    libLoadBtn: "click:library_load",
  };
  Object.entries(map).forEach(([id, evt]) => {
    const el = document.getElementById(id);
    if (el) el.addEventListener("click", () => trackEvent(evt));
  });
}
document.addEventListener("DOMContentLoaded", trackButtonClicks);

/* ===========================
   ğŸ§˜ CLEANUP / RESET
=========================== */

function clearLocal() {
  localStorage.removeItem("workshopEndAt");
  localStorage.removeItem("loginCache");
  localStorage.removeItem("sessionId");
  localStorage.removeItem("currentUser");
  showAlert("ë¡œì»¬ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
}

/* ===========================
   ğŸ§© OPTIONAL DEBUG PANEL (ê´€ë¦¬ììš©)
=========================== */
function showDebugPanel() {
  const dbg = document.createElement("div");
  dbg.style.position = "fixed";
  dbg.style.bottom = "0";
  dbg.style.right = "0";
  dbg.style.background = "#000";
  dbg.style.color = "#0f0";
  dbg.style.fontSize = "10px";
  dbg.style.padding = "3px 5px";
  dbg.textContent = "DEBUG";
  dbg.onclick = () => {
    alert(`USER: ${currentUser}\nSESSION: ${sessionId}\nEndAt: ${localStorage.getItem("workshopEndAt") || "none"}`);
  };
  document.body.appendChild(dbg);
}
if (location.search.includes("debug=1")) showDebugPanel();

/* ===========================
   ğŸ’¾ ONUNLOAD - STATUS SAVE
=========================== */
window.addEventListener("beforeunload", () => {
  if (currentUser) {
    apiRequest("updateUserStatus", { userName: currentUser, sessionId, status: "offline" });
  }
});
</script>
