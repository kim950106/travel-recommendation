<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        select, input {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .menu-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: #333;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .menu-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .menu-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .menu-desc {
            font-size: 12px;
            color: #666;
        }

        .timer-card {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-text {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .timer-display {
            font-size: 36px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .user-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #666;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€</h1>
            <p>2025 ì›Œí¬ìˆ</p>
        </div>

        <!-- ë¡œê·¸ì¸ í™”ë©´ -->
        <div id="loginScreen" class="card">
            <div class="login-form">
                <div class="form-group">
                    <label for="userName">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</label>
                    <select id="userName" required>
                        <option value="">ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="ë‚¨ë„í˜„">ë‚¨ë„í˜„</option>
                        <option value="ê¹€ìˆ˜ì¸">ê¹€ìˆ˜ì¸</option>
                        <option value="ê³ ë‹¤í˜„">ê³ ë‹¤í˜„</option>
                        <option value="ì‹¬ì¬í¬">ì‹¬ì¬í¬</option>
                        <option value="íŒí‹°ë‹ˆì•ˆ">íŒí‹°ë‹ˆì•ˆ</option>
                        <option value="ê¹€í˜„ì² ">ê¹€í˜„ì² </option>
                        <option value="ì´ìœ ì§„">ì´ìœ ì§„</option>
                        <option value="ì •ì–´ì§„">ì •ì–´ì§„</option>
                        <option value="ì¥ì›ì¤€">ì¥ì›ì¤€</option>
                        <option value="ê¹€ëŒ€ì§„">ê¹€ëŒ€ì§„</option>
                        <option value="ì†í˜„ìš°">ì†í˜„ìš°</option>
                        <option value="ì´ì£¼ì•„">ì´ì£¼ì•„</option>
                        <option value="ì¥ì€ì§„">ì¥ì€ì§„</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="userMBTI">MBTIë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
                    <select id="userMBTI" required>
                        <option value="">MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                        <option value="INTJ">INTJ - ê±´ì¶•ê°€</option>
                        <option value="INTP">INTP - ë…¼ë¦¬ìˆ ì‚¬</option>
                        <option value="ENTJ">ENTJ - í†µì†”ì</option>
                        <option value="ENTP">ENTP - í† ë¡ ê°€</option>
                        <option value="INFJ">INFJ - ì˜¹í˜¸ì</option>
                        <option value="INFP">INFP - ì¤‘ì¬ì</option>
                        <option value="ENFJ">ENFJ - ì„ ë„ì</option>
                        <option value="ENFP">ENFP - í™œë™ê°€</option>
                        <option value="ISTJ">ISTJ - í˜„ì‹¤ì£¼ì˜ì</option>
                        <option value="ISFJ">ISFJ - ìˆ˜í˜¸ì</option>
                        <option value="ESTJ">ESTJ - ê²½ì˜ì</option>
                        <option value="ESFJ">ESFJ - ì§‘ì •ê´€</option>
                        <option value="ISTP">ISTP - ë§ŒëŠ¥ì¬ì£¼ê¾¼</option>
                        <option value="ISFP">ISFP - ëª¨í—˜ê°€</option>
                        <option value="ESTP">ESTP - ì‚¬ì—…ê°€</option>
                        <option value="ESFP">ESFP - ì—°ì˜ˆì¸</option>
                    </select>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="handleLogin()">
                    ë¡œê·¸ì¸
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ í™”ë©´ -->
        <div id="mainScreen" class="hidden">
            <!-- ì‚¬ìš©ì ì •ë³´ -->
            <div id="userInfo" class="user-info">
                <h3 id="userNameDisplay"></h3>
                <p id="userTeamDisplay"></p>
            </div>

            <!-- ì›Œí¬ìˆ ì‹œì‘ ì•Œë¦¼ -->
            <div id="workshopAlert" class="card hidden">
                <h3 style="margin-bottom: 15px; color: #667eea;">ğŸ‰ ì›Œí¬ìˆì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                <p style="margin-bottom: 20px; color: #666; line-height: 1.5;">
                    íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìˆì´ ì‹œì‘ë©ë‹ˆë‹¤.<br>
                    ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ 48ì‹œê°„ì˜ íŠ¹ë³„í•œ ì—¬ì •ì„ ì‹œì‘í•´ë³´ì„¸ìš”!
                </p>
                <button class="btn btn-primary" onclick="startWorkshop()">
                    ì›Œí¬ìˆ ì°¸ì—¬í•˜ê¸° ğŸš€
                </button>
            </div>

            <!-- íƒ€ì´ë¨¸ -->
            <div id="timerCard" class="card timer-card hidden">
                <div class="timer-text">ì›Œí¬ìˆ ë‚¨ì€ ì‹œê°„</div>
                <div id="timerDisplay" class="timer-display">48:00:00</div>
            </div>

            <!-- ë©”ë‰´ ê·¸ë¦¬ë“œ -->
            <div class="menu-grid">
                <a href="#" class="menu-item" onclick="openMBTIRelations()">
                    <span class="menu-icon">ğŸ‘¥</span>
                    <div class="menu-title">ì°¸ê°€ì í˜„í™©</div>
                    <div class="menu-desc">MBTI ì…ë ¥/ìˆ˜ì • & íŒ€ ë³´ê¸°</div>
                </a>

                <a href="#" class="menu-item" onclick="openSchedule()">
                    <span class="menu-icon">ğŸ“…</span>
                    <div class="menu-title">ì›Œí¬ìƒµ ì¼ì •</div>
                    <div class="menu-desc">ìƒì„¸ ì¼ì • ë° í”„ë¡œê·¸ë¨</div>
                </a>

                <a href="#" class="menu-item" onclick="openPsychTest()">
                    <span class="menu-icon">ğŸ§ </span>
                    <div class="menu-title">ì—¬í–‰ì‹¬ë¦¬í…ŒìŠ¤íŠ¸</div>
                    <div class="menu-desc">ì—¬í–‰ ì„±í–¥/ë™í–‰ ê¶í•© ë³´ê¸°</div>
                </a>

                <a href="#" class="menu-item" onclick="openLinkStorage()">
                    <span class="menu-icon">ğŸ“¦</span>
                    <div class="menu-title">íˆ¬ì–´íŒ¨ìŠ¤ ë³´ê´€í•¨</div>
                    <div class="menu-desc">ê°œì¸ ë§í¬ ì €ì¥ì†Œ</div>
                </a>

                <a href="#" class="menu-item" onclick="openSurvey()">
                    <span class="menu-icon">ğŸ“</span>
                    <div class="menu-title">ì„¤ë¬¸ì¡°ì‚¬</div>
                    <div class="menu-desc">ì›Œí¬ìƒµ ë§Œì¡±ë„</div>
                </a>

                <a href="https://chatgpt.com/g/g-6899821cd87481919c7a20d26b89f0ce-tueopaeseusaeobbu-weokeusyob-aieosiseuteonteu" target="_blank" class="menu-item">
                    <span class="menu-icon">ğŸ¤–</span>
                    <div class="menu-title">ì›Œí¬ìˆ ì±—ë´‡</div>
                    <div class="menu-desc">ëŒ€í™”í˜• ë„ìš°ë¯¸ ë°”ë¡œê°€ê¸°</div>
                </a>
            </div>
        </div>

        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div id="alertMessage" class="hidden"></div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let sessionId = null;
        let workshopStartTime = null;
        let timerInterval = null;

        // API ì—”ë“œí¬ì¸íŠ¸ (ì‹¤ì œ Google Apps Script ì›¹ì•± URLë¡œ êµì²´ í•„ìš”)
        const API_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL';

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        async function handleLogin() {
            const userName = document.getElementById('userName').value;
            const userMBTI = document.getElementById('userMBTI').value;

            if (!userName || !userMBTI) {
                showAlert('ì´ë¦„ê³¼ MBTIë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                console.log('Sending login request...'); // ë””ë²„ê¹…ìš©

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'login',
                        name: userName,
                        mbti: userMBTI
                    })
                });

                console.log('Response status:', response.status); // ë””ë²„ê¹…ìš©
                
                // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Non-JSON response:', text);
                    showAlert('ì„œë²„ ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.', 'error');
                    return;
                }

                const result = await response.json();
                console.log('Response data:', result); // ë””ë²„ê¹…ìš©

                if (result.success) {
                    currentUser = userName;
                    sessionId = result.data.sessionId;
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì„¸ì…˜ ì •ë³´ ì €ì¥
                    localStorage.setItem('sessionId', sessionId);
                    localStorage.setItem('currentUser', userName);
                    
                    showMainScreen(result.data.userInfo);
                    showWorkshopAlert();
                } else {
                    showAlert(result.message, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showAlert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ë©”ì¸ í™”ë©´ í‘œì‹œ
        function showMainScreen(userInfo) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            
            document.getElementById('userNameDisplay').textContent = currentUser;
            document.getElementById('userTeamDisplay').textContent = 
                `${userInfo.team} | ${userInfo.position}`;
            
            // ê´€ë¦¬ìì¸ ê²½ìš° ê´€ë¦¬ì ë©”ë‰´ ì¶”ê°€
            if (currentUser === 'ê¹€í˜„ì² ') {
                addAdminMenu();
            }
        }

        // ì›Œí¬ìˆ ì•Œë¦¼ í‘œì‹œ
        function showWorkshopAlert() {
            document.getElementById('workshopAlert').classList.remove('hidden');
        }

        // ì›Œí¬ìˆ ì‹œì‘
        async function startWorkshop() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'startWorkshop',
                        name: currentUser,
                        sessionId: sessionId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    workshopStartTime = new Date(result.data.startTime);
                    localStorage.setItem('workshopStartTime', workshopStartTime.toISOString());
                    
                    document.getElementById('workshopAlert').classList.add('hidden');
                    document.getElementById('timerCard').classList.remove('hidden');
                    
                    startTimer();
                    showAlert('ì›Œí¬ìˆì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
                } else {
                    showAlert(result.message, 'error');
                }
            } catch (error) {
                showAlert('ì›Œí¬ìˆ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
        function updateTimer() {
            if (!workshopStartTime) return;

            const now = new Date();
            const elapsed = now - workshopStartTime;
            const remaining = (48 * 60 * 60 * 1000) - elapsed; // 48ì‹œê°„

            if (remaining <= 0) {
                document.getElementById('timerDisplay').textContent = '00:00:00';
                clearInterval(timerInterval);
                showAlert('ì›Œí¬ìˆì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ', 'success');
                return;
            }

            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;
        }

        // ë©”ë‰´ ê¸°ëŠ¥ë“¤ (ê°ê° ë³„ë„ í˜ì´ì§€ë¡œ êµ¬í˜„)
        function openMBTIRelations() {
            window.location.href = 'mbti-relations.html';
        }

        function openSchedule() {
            window.location.href = 'schedule.html';
        }

        function openPsychTest() {
            window.location.href = 'psych-test.html';
        }

        function openLinkStorage() {
            window.location.href = 'link-storage.html';
        }

        function openSurvey() {
            window.location.href = 'survey.html';
        }

        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.classList.remove('hidden');

            setTimeout(() => {
                alertDiv.classList.add('hidden');
            }, 3000);
        }

        // ê´€ë¦¬ì ë©”ë‰´ ì¶”ê°€
        function addAdminMenu() {
            const menuGrid = document.querySelector('.menu-grid');
            
            // ê´€ë¦¬ì ì „ìš© ë©”ë‰´ ì•„ì´í…œ ìƒì„±
            const adminMenuItem = document.createElement('a');
            adminMenuItem.href = 'admin-dashboard.html';
            adminMenuItem.className = 'menu-item';
            adminMenuItem.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            adminMenuItem.style.color = 'white';
            adminMenuItem.innerHTML = `
                <span class="menu-icon">ğŸ›¡ï¸</span>
                <div class="menu-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
                <div class="menu-desc">ì›Œí¬ìˆ ì „ì²´ ê´€ë¦¬</div>
            `;
            
            // ì²« ë²ˆì§¸ ìœ„ì¹˜ì— ì¶”ê°€
            menuGrid.insertBefore(adminMenuItem, menuGrid.firstChild);
            
            // ì‚¬ìš©ì ì •ë³´ì— ê´€ë¦¬ì í‘œì‹œ ì¶”ê°€
            const userInfo = document.getElementById('userInfo');
            const adminBadge = document.createElement('span');
            adminBadge.style.cssText = `
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                margin-left: 10px;
            `;
            adminBadge.textContent = 'ğŸ›¡ï¸ ê´€ë¦¬ì';
            
            const nameDisplay = document.getElementById('userNameDisplay');
            nameDisplay.appendChild(adminBadge);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¸ì…˜ ë³µì›
        window.addEventListener('load', function() {
            const savedSessionId = localStorage.getItem('sessionId');
            const savedUser = localStorage.getItem('currentUser');
            const savedWorkshopStart = localStorage.getItem('workshopStartTime');

            if (savedSessionId && savedUser) {
                sessionId = savedSessionId;
                currentUser = savedUser;
                
                // ì‚¬ìš©ì ì •ë³´ ì„ì‹œ í‘œì‹œ (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
                showMainScreen({ team: '', position: '' });
                
                if (savedWorkshopStart) {
                    workshopStartTime = new Date(savedWorkshopStart);
                    document.getElementById('timerCard').classList.remove('hidden');
                    startTimer();
                } else {
                    showWorkshopAlert();
                }
            }
        });
    </script>
</body>
</html>
