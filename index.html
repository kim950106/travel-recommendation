<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>투어패스사업부 2025 워크숍</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        select, input {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .menu-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: #333;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .menu-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .menu-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .menu-desc {
            font-size: 12px;
            color: #666;
        }

        .timer-card {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-text {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .timer-display {
            font-size: 36px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .user-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #666;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <h1>투어패스사업부</h1>
            <p>2025 워크숍</p>
        </div>

        <!-- 로그인 화면 -->
        <div id="loginScreen" class="card">
            <div class="login-form">
                <div class="form-group">
                    <label for="userName">이름을 선택하세요</label>
                    <select id="userName" required>
                        <option value="">이름을 선택해주세요</option>
                        <option value="남도현">남도현</option>
                        <option value="김수인">김수인</option>
                        <option value="고다현">고다현</option>
                        <option value="심재희">심재희</option>
                        <option value="판티니안">판티니안</option>
                        <option value="김현철">김현철</option>
                        <option value="이유진">이유진</option>
                        <option value="정어진">정어진</option>
                        <option value="장원준">장원준</option>
                        <option value="김대진">김대진</option>
                        <option value="손현우">손현우</option>
                        <option value="이주아">이주아</option>
                        <option value="장은진">장은진</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="userMBTI">MBTI를 입력하세요</label>
                    <select id="userMBTI" required>
                        <option value="">MBTI를 선택해주세요</option>
                        <option value="INTJ">INTJ - 건축가</option>
                        <option value="INTP">INTP - 논리술사</option>
                        <option value="ENTJ">ENTJ - 통솔자</option>
                        <option value="ENTP">ENTP - 토론가</option>
                        <option value="INFJ">INFJ - 옹호자</option>
                        <option value="INFP">INFP - 중재자</option>
                        <option value="ENFJ">ENFJ - 선도자</option>
                        <option value="ENFP">ENFP - 활동가</option>
                        <option value="ISTJ">ISTJ - 현실주의자</option>
                        <option value="ISFJ">ISFJ - 수호자</option>
                        <option value="ESTJ">ESTJ - 경영자</option>
                        <option value="ESFJ">ESFJ - 집정관</option>
                        <option value="ISTP">ISTP - 만능재주꾼</option>
                        <option value="ISFP">ISFP - 모험가</option>
                        <option value="ESTP">ESTP - 사업가</option>
                        <option value="ESFP">ESFP - 연예인</option>
                    </select>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="handleLogin()">
                    로그인
                </button>
            </div>
        </div>

        <!-- 메인 화면 -->
        <div id="mainScreen" class="hidden">
            <!-- 사용자 정보 -->
            <div id="userInfo" class="user-info">
                <h3 id="userNameDisplay"></h3>
                <p id="userTeamDisplay"></p>
            </div>

            <!-- 워크숍 시작 알림 -->
            <div id="workshopAlert" class="card hidden">
                <h3 style="margin-bottom: 15px; color: #667eea;">🎉 워크숍에 오신 것을 환영합니다!</h3>
                <p style="margin-bottom: 20px; color: #666; line-height: 1.5;">
                    투어패스사업부 2025 워크숍이 시작됩니다.<br>
                    아래 버튼을 눌러 48시간의 특별한 여정을 시작해보세요!
                </p>
                <button class="btn btn-primary" onclick="startWorkshop()">
                    워크숍 참여하기 🚀
                </button>
            </div>

            <!-- 타이머 -->
            <div id="timerCard" class="card timer-card hidden">
                <div class="timer-text">워크숍 남은 시간</div>
                <div id="timerDisplay" class="timer-display">48:00:00</div>
            </div>

            <!-- 메뉴 그리드 -->
            <div class="menu-grid">
                <a href="#" class="menu-item" onclick="openMBTIRelations()">
                    <span class="menu-icon">👥</span>
                    <div class="menu-title">참가자 현황</div>
                    <div class="menu-desc">MBTI 입력/수정 & 팀 보기</div>
                </a>

                <a href="#" class="menu-item" onclick="openSchedule()">
                    <span class="menu-icon">📅</span>
                    <div class="menu-title">워크샵 일정</div>
                    <div class="menu-desc">상세 일정 및 프로그램</div>
                </a>

                <a href="#" class="menu-item" onclick="openPsychTest()">
                    <span class="menu-icon">🧠</span>
                    <div class="menu-title">여행심리테스트</div>
                    <div class="menu-desc">여행 성향/동행 궁합 보기</div>
                </a>

                <a href="#" class="menu-item" onclick="openLinkStorage()">
                    <span class="menu-icon">📦</span>
                    <div class="menu-title">투어패스 보관함</div>
                    <div class="menu-desc">개인 링크 저장소</div>
                </a>

                <a href="#" class="menu-item" onclick="openSurvey()">
                    <span class="menu-icon">📝</span>
                    <div class="menu-title">설문조사</div>
                    <div class="menu-desc">워크샵 만족도</div>
                </a>

                <a href="https://chatgpt.com/g/g-6899821cd87481919c7a20d26b89f0ce-tueopaeseusaeobbu-weokeusyob-aieosiseuteonteu" target="_blank" class="menu-item">
                    <span class="menu-icon">🤖</span>
                    <div class="menu-title">워크숍 챗봇</div>
                    <div class="menu-desc">대화형 도우미 바로가기</div>
                </a>
            </div>
        </div>

        <!-- 알림 메시지 -->
        <div id="alertMessage" class="hidden"></div>
    </div>

    <script>
        // 전역 변수
        let currentUser = null;
        let sessionId = null;
        let workshopStartTime = null;
        let timerInterval = null;

        // API 엔드포인트 (실제 Google Apps Script 웹앱 URL로 교체 필요)
        const API_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL';

        // 로그인 처리
        async function handleLogin() {
            const userName = document.getElementById('userName').value;
            const userMBTI = document.getElementById('userMBTI').value;

            if (!userName || !userMBTI) {
                showAlert('이름과 MBTI를 모두 선택해주세요.', 'error');
                return;
            }

            try {
                console.log('Sending login request...'); // 디버깅용

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'login',
                        name: userName,
                        mbti: userMBTI
                    })
                });

                console.log('Response status:', response.status); // 디버깅용
                
                // 응답이 JSON인지 확인
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Non-JSON response:', text);
                    showAlert('서버 응답 형식 오류입니다. 관리자에게 문의하세요.', 'error');
                    return;
                }

                const result = await response.json();
                console.log('Response data:', result); // 디버깅용

                if (result.success) {
                    currentUser = userName;
                    sessionId = result.data.sessionId;
                    
                    // 로컬 스토리지에 세션 정보 저장
                    localStorage.setItem('sessionId', sessionId);
                    localStorage.setItem('currentUser', userName);
                    
                    showMainScreen(result.data.userInfo);
                    showWorkshopAlert();
                } else {
                    showAlert(result.message, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showAlert('로그인 중 오류가 발생했습니다. API URL을 확인해주세요.', 'error');
            }
        }

        // 메인 화면 표시
        function showMainScreen(userInfo) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            
            document.getElementById('userNameDisplay').textContent = currentUser;
            document.getElementById('userTeamDisplay').textContent = 
                `${userInfo.team} | ${userInfo.position}`;
            
            // 관리자인 경우 관리자 메뉴 추가
            if (currentUser === '김현철') {
                addAdminMenu();
            }
        }

        // 워크숍 알림 표시
        function showWorkshopAlert() {
            document.getElementById('workshopAlert').classList.remove('hidden');
        }

        // 워크숍 시작
        async function startWorkshop() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'startWorkshop',
                        name: currentUser,
                        sessionId: sessionId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    workshopStartTime = new Date(result.data.startTime);
                    localStorage.setItem('workshopStartTime', workshopStartTime.toISOString());
                    
                    document.getElementById('workshopAlert').classList.add('hidden');
                    document.getElementById('timerCard').classList.remove('hidden');
                    
                    startTimer();
                    showAlert('워크숍이 시작되었습니다! 🎉', 'success');
                } else {
                    showAlert(result.message, 'error');
                }
            } catch (error) {
                showAlert('워크숍 시작 중 오류가 발생했습니다.', 'error');
            }
        }

        // 타이머 시작
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        // 타이머 업데이트
        function updateTimer() {
            if (!workshopStartTime) return;

            const now = new Date();
            const elapsed = now - workshopStartTime;
            const remaining = (48 * 60 * 60 * 1000) - elapsed; // 48시간

            if (remaining <= 0) {
                document.getElementById('timerDisplay').textContent = '00:00:00';
                clearInterval(timerInterval);
                showAlert('워크숍이 종료되었습니다! 🏁', 'success');
                return;
            }

            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeString;
        }

        // 메뉴 기능들 (각각 별도 페이지로 구현)
        function openMBTIRelations() {
            window.location.href = 'mbti-relations.html';
        }

        function openSchedule() {
            window.location.href = 'schedule.html';
        }

        function openPsychTest() {
            window.location.href = 'psych-test.html';
        }

        function openLinkStorage() {
            window.location.href = 'link-storage.html';
        }

        function openSurvey() {
            window.location.href = 'survey.html';
        }

        // 알림 메시지 표시
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.classList.remove('hidden');

            setTimeout(() => {
                alertDiv.classList.add('hidden');
            }, 3000);
        }

        // 관리자 메뉴 추가
        function addAdminMenu() {
            const menuGrid = document.querySelector('.menu-grid');
            
            // 관리자 전용 메뉴 아이템 생성
            const adminMenuItem = document.createElement('a');
            adminMenuItem.href = 'admin-dashboard.html';
            adminMenuItem.className = 'menu-item';
            adminMenuItem.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            adminMenuItem.style.color = 'white';
            adminMenuItem.innerHTML = `
                <span class="menu-icon">🛡️</span>
                <div class="menu-title">관리자 대시보드</div>
                <div class="menu-desc">워크숍 전체 관리</div>
            `;
            
            // 첫 번째 위치에 추가
            menuGrid.insertBefore(adminMenuItem, menuGrid.firstChild);
            
            // 사용자 정보에 관리자 표시 추가
            const userInfo = document.getElementById('userInfo');
            const adminBadge = document.createElement('span');
            adminBadge.style.cssText = `
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                margin-left: 10px;
            `;
            adminBadge.textContent = '🛡️ 관리자';
            
            const nameDisplay = document.getElementById('userNameDisplay');
            nameDisplay.appendChild(adminBadge);
        }

        // 페이지 로드 시 세션 복원
        window.addEventListener('load', function() {
            const savedSessionId = localStorage.getItem('sessionId');
            const savedUser = localStorage.getItem('currentUser');
            const savedWorkshopStart = localStorage.getItem('workshopStartTime');

            if (savedSessionId && savedUser) {
                sessionId = savedSessionId;
                currentUser = savedUser;
                
                // 사용자 정보 임시 표시 (실제로는 API에서 가져와야 함)
                showMainScreen({ team: '', position: '' });
                
                if (savedWorkshopStart) {
                    workshopStartTime = new Date(savedWorkshopStart);
                    document.getElementById('timerCard').classList.remove('hidden');
                    startTimer();
                } else {
                    showWorkshopAlert();
                }
            }
        });
    </script>
</body>
</html>
