<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ 2025 ì›Œí¬ìˆ</title>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

    :root {
      --primary-brand: #1e40af;
      --secondary-brand: #3b82f6;
      --accent-warm: #f59e0b;
      --accent-cool: #06b6d4;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --surface-primary: #ffffff;
      --surface-secondary: #f8fafc;
      --surface-elevated: #f1f5f9;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --gradient-brand: linear-gradient(135deg, var(--primary-brand), var(--secondary-brand));
      --gradient-warm: linear-gradient(135deg, #fbbf24, #f59e0b);
      --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,'Segoe UI','Malgun Gothic','ë§‘ì€ ê³ ë”•',sans-serif;background:var(--surface-secondary);color:var(--text-primary);line-height:1.7}
    .container{max-width:428px;margin:0 auto;padding:1.5rem;min-height:100vh}
    .header{text-align:center;margin-bottom:3rem;padding:3rem 0}
    .header h1{font-size:2.25rem;font-weight:800;margin-bottom:.5rem}
    .header p{font-size:1.25rem;color:var(--text-secondary)}
    .card{background:var(--surface-primary);border-radius:24px;padding:2rem;margin-bottom:1.5rem;box-shadow:var(--shadow-md);border:1px solid rgba(59,130,246,.1)}
    .form-group{margin-bottom:1.5rem}
    label{display:block;font-weight:600;margin-bottom:.5rem;font-size:.875rem}
    select,input,textarea{width:100%;padding:1rem 1.25rem;border:1.5px solid #e2e8f0;border-radius:16px;font-size:1rem;font-family:inherit}
    select:focus,input:focus,textarea:focus{outline:none;border-color:var(--secondary-brand);box-shadow:0 0 0 3px rgba(59,130,246,.1)}
    .btn{padding:1rem 1.5rem;border:none;border-radius:16px;font-size:1rem;font-weight:600;cursor:pointer;transition:.2s;width:100%}
    .btn-primary{background:var(--gradient-brand);color:#fff}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
    .btn-secondary{background:var(--surface-elevated);color:var(--text-primary)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .menu-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:2rem}
    .menu-item{background:var(--surface-primary);border:1.5px solid rgba(59,130,246,.1);border-radius:20px;padding:1.5rem;text-align:center;cursor:pointer;transition:.3s;text-decoration:none;color:inherit}
    .menu-item:hover{transform:translateY(-4px);box-shadow:var(--shadow-xl);border-color:var(--secondary-brand)}
    .menu-title{font-weight:700;font-size:1.125rem;margin-bottom:.5rem}
    .menu-desc{font-size:.875rem;color:var(--text-secondary)}
    .timer-card{background:var(--gradient-brand);color:#fff;text-align:center}
    .timer-display{font-size:3.5rem;font-weight:800}
    .user-info{background:var(--gradient-surface);border:1.5px solid rgba(59,130,246,.1);padding:1.5rem;border-radius:20px;margin-bottom:1.5rem;text-align:center}
    .alert{padding:1rem;border-radius:16px;margin-bottom:1.5rem;text-align:center;animation:slideIn .4s}
    @keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    .alert-success{background:rgba(16,185,129,.1);color:#047857;border:1px solid rgba(16,185,129,.3)}
    .alert-error{background:rgba(239,68,68,.1);color:#dc2626;border:1px solid rgba(239,68,68,.3)}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;overflow-y:auto}
    .modal-content{background:#fff;margin:50px auto;padding:0;width:90%;max-width:600px;border-radius:24px;animation:modalSlideIn .3s}
    @keyframes modalSlideIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    .modal-header{padding:1.5rem;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}
    .modal-header h2{margin:0;font-size:1.5rem}
    .close-btn{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-muted)}
    .modal-body{padding:1.5rem}
    .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
    .stat-card{background:var(--surface-elevated);padding:1.5rem;border-radius:16px;text-align:center}
    .stat-number{font-size:2rem;font-weight:800;color:var(--primary-brand)}
    .stat-label{font-size:.875rem;color:var(--text-secondary)}
    .mbti-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem}
    .mbti-item{background:var(--surface-elevated);padding:1rem;border-radius:12px;text-align:center;border:1px solid #e2e8f0}
    .mbti-type{font-weight:700;color:var(--primary-brand);font-size:.875rem;margin-bottom:.25rem}
    .mbti-count{font-size:1.5rem;font-weight:800}
    .schedule-item{background:#fff;padding:1.25rem;border-radius:16px;margin-bottom:1rem;border-left:4px solid var(--secondary-brand);border:1px solid #e2e8f0}
    .schedule-time{font-weight:700;color:var(--primary-brand);font-size:.875rem;margin-bottom:.5rem}
    .schedule-title{font-weight:600;margin-bottom:.25rem}
    .schedule-desc{font-size:.875rem;color:var(--text-secondary)}
    .radio-group{display:flex;flex-direction:column;gap:.75rem}
    .radio-item{display:flex;align-items:center;padding:.75rem;background:var(--surface-elevated);border-radius:12px;cursor:pointer;border:1px solid #e2e8f0}
    .radio-item:hover{background:#e2e8f0}
    .radio-item input[type="radio"]{margin-right:.75rem}
    .loading{text-align:center;padding:3rem;color:var(--text-muted)}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€</h1>
      <p>2025 ì›Œí¬ìˆ</p>
    </div>

    <!-- ë¡œê·¸ì¸ -->
    <div id="loginScreen" class="card">
      <div class="form-group">
        <label for="userName">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</label>
        <select id="userName" required>
          <option value="">ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          <option value="ë‚¨ë„í˜„">ë‚¨ë„í˜„</option>
          <option value="ê¹€ìˆ˜ì¸">ê¹€ìˆ˜ì¸</option>
          <option value="ê³ ë‹¤í˜„">ê³ ë‹¤í˜„</option>
          <option value="ì‹¬ì¬í¬">ì‹¬ì¬í¬</option>
          <option value="íŒí‹°ë‹ˆì•ˆ">íŒí‹°ë‹ˆì•ˆ</option>
          <option value="ê¹€í˜„ì² ">ê¹€í˜„ì² </option>
          <option value="ì´ìœ ì§„">ì´ìœ ì§„</option>
          <option value="ì •ì–´ì§„">ì •ì–´ì§„</option>
          <option value="ì¥ì›ì¤€">ì¥ì›ì¤€</option>
          <option value="ê¹€ëŒ€ì§„">ê¹€ëŒ€ì§„</option>
          <option value="ì†í˜„ìš°">ì†í˜„ìš°</option>
          <option value="ì´ì£¼ì•„">ì´ì£¼ì•„</option>
          <option value="ì¥ì€ì§„">ì¥ì€ì§„</option>
        </select>
      </div>
      <div class="form-group">
        <label for="userMBTI">MBTIë¥¼ ì„ íƒí•˜ì„¸ìš”</label>
        <select id="userMBTI" required>
          <option value="">MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          <option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
          <option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
          <option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
          <option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
        </select>
      </div>
      <button class="btn btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>
    </div>

    <!-- ë©”ì¸ -->
    <div id="mainScreen" class="hidden">
      <div class="user-info">
        <h3 id="userNameDisplay"></h3>
        <p id="userTeamDisplay"></p>
        <button class="btn btn-secondary" id="logoutBtn" style="margin-top:1rem;">ë¡œê·¸ì•„ì›ƒ</button>
      </div>

      <div id="timerCard" class="card timer-card">
        <div style="font-size:1.125rem;margin-bottom:1rem;opacity:.9;">ì›Œí¬ìˆ ë‚¨ì€ ì‹œê°„</div>
        <div id="timerDisplay" class="timer-display">48:00:00</div>
      </div>

      <div class="menu-grid">
        <div class="menu-item" id="mbtiMenu">
          <div class="menu-title">ì°¸ê°€ì í˜„í™©</div>
          <div class="menu-desc">MBTI ë¶„í¬</div>
        </div>
        <div class="menu-item" id="scheduleMenu">
          <div class="menu-title">ì›Œí¬ìƒµ ì¼ì •</div>
          <div class="menu-desc">í”„ë¡œê·¸ë¨</div>
        </div>
        <div class="menu-item" id="linkMenu">
          <div class="menu-title">ë§í¬ ë³´ê´€í•¨</div>
          <div class="menu-desc">ìë£Œ ì €ì¥</div>
        </div>
        <div class="menu-item" id="surveyMenu">
          <div class="menu-title">ì„¤ë¬¸ì¡°ì‚¬</div>
          <div class="menu-desc">ë§Œì¡±ë„</div>
        </div>
      </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div id="alertMessage" class="hidden"></div>
  </div>

  <!-- MBTI ëª¨ë‹¬ -->
  <div id="mbtiModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ì°¸ê°€ì í˜„í™©</h2>
        <button class="close-btn" data-close="mbtiModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalParticipants">0</div>
            <div class="stat-label">ì´ ì°¸ê°€ì</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="onlineCount">0</div>
            <div class="stat-label">í˜„ì¬ ì ‘ì†</div>
          </div>
        </div>
        <h3>MBTI ë¶„í¬</h3>
        <div class="mbti-grid" id="mbtiDistribution"></div>
        <h3 style="margin-top:2rem;">íŒ€ë³„ ë¶„í¬</h3>
        <div id="teamDistribution"><p style="color:var(--text-muted);">íŒ€ ë¶„í¬ëŠ” ì¶”í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •</p></div>
      </div>
    </div>
  </div>

  <!-- ì¼ì • ëª¨ë‹¬ -->
  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ì›Œí¬ìˆ ì¼ì •</h2>
        <button class="close-btn" data-close="scheduleModal">&times;</button>
      </div>
      <div class="modal-body">
        <h3>1ì¼ì°¨</h3>
        <div class="schedule-item"><div class="schedule-time">14:50</div><div class="schedule-title">ë¡œë¹„ ì§‘í•©</div><div class="schedule-desc">ë¶€ì—¬ë¡¯ë°ë¦¬ì¡°íŠ¸</div></div>
        <div class="schedule-item"><div class="schedule-time">15:30</div><div class="schedule-title">ì²´í¬ì¸ ë° ë°±ì œë¬¸í™”ë‹¨ì§€</div><div class="schedule-desc">ê´€ê´‘ ë° ì²´í—˜</div></div>
        <div class="schedule-item"><div class="schedule-time">18:30</div><div class="schedule-title">ì €ë…ì‹ì‚¬</div><div class="schedule-desc">ì„œë™í•œìš° êµ¬ì–‘ì </div></div>
        <div class="schedule-item"><div class="schedule-time">21:00</div><div class="schedule-title">íšŒì‹ ë° ë ˆí¬ë ˆì´ì…˜</div><div class="schedule-desc">ë¶€ì—¬ë¡¯ë°ë¦¬ì¡°íŠ¸</div></div>
        <h3 style="margin-top:2rem;">2ì¼ì°¨</h3>
        <div class="schedule-item"><div class="schedule-time">11:00</div><div class="schedule-title">ì•„ì¹¨ê²¸ ì ì‹¬</div><div class="schedule-desc">ì¥ì›ë§‰êµ­ìˆ˜</div></div>
        <div class="schedule-item"><div class="schedule-time">12:30</div><div class="schedule-title">ì›Œí¬ìˆ</div><div class="schedule-desc">ì‚¬ë¹„123ì°½ì‘ì„¼í„°</div></div>
        <div class="schedule-item"><div class="schedule-time">14:10</div><div class="schedule-title">ê·€ê°€</div><div class="schedule-desc">ì›Œí¬ìˆ ì¢…ë£Œ</div></div>
      </div>
    </div>
  </div>

  <!-- ë§í¬ ëª¨ë‹¬ -->
  <div id="linkModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ë§í¬ ë³´ê´€í•¨</h2>
        <button class="close-btn" data-close="linkModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="card">
          <h3>ìƒˆ ë§í¬ ì¶”ê°€</h3>
          <div class="form-group"><input type="text" id="linkTitle" placeholder="ì œëª©"></div>
          <div class="form-group"><input type="url" id="linkUrl" placeholder="URL (https://...)"></div>
          <div class="form-group">
            <select id="linkCategory">
              <option>ì›Œí¬ìˆ ìë£Œ</option><option>ì—…ë¬´ ë„êµ¬</option>
              <option>ì°¸ê³  ìë£Œ</option><option>ê¸°íƒ€</option>
            </select>
          </div>
          <div class="form-group"><textarea id="linkDescription" rows="3" placeholder="ì„¤ëª… (ì„ íƒ)"></textarea></div>
          <button class="btn btn-primary" id="saveLinkBtn">ë§í¬ ì €ì¥</button>
        </div>

        <h3 style="margin-top:2rem;">ì €ì¥ëœ ë§í¬</h3>
        <div id="linksList"></div>
      </div>
    </div>
  </div>

  <!-- ì„¤ë¬¸ ëª¨ë‹¬ -->
  <div id="surveyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ë§Œì¡±ë„ ì„¤ë¬¸ì¡°ì‚¬</h2>
        <button class="close-btn" data-close="surveyModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>1. ì›Œí¬ìˆ ì „ë°˜ì ì¸ ë§Œì¡±ë„</label>
          <div class="radio-group">
            <label class="radio-item"><input type="radio" name="satisfaction" value="5">ë§¤ìš° ë§Œì¡±</label>
            <label class="radio-item"><input type="radio" name="satisfaction" value="4">ë§Œì¡±</label>
            <label class="radio-item"><input type="radio" name="satisfaction" value="3">ë³´í†µ</label>
            <label class="radio-item"><input type="radio" name="satisfaction" value="2">ë¶ˆë§Œì¡±</label>
            <label class="radio-item"><input type="radio" name="satisfaction" value="1">ë§¤ìš° ë¶ˆë§Œì¡±</label>
          </div>
        </div>
        <div class="form-group">
          <label>2. ê°€ì¥ ìœ ìš©í–ˆë˜ í”„ë¡œê·¸ë¨</label>
          <div class="radio-group">
            <label class="radio-item"><input type="radio" name="useful_program" value="ë°±ì œë¬¸í™”ë‹¨ì§€">ë°±ì œë¬¸í™”ë‹¨ì§€</label>
            <label class="radio-item"><input type="radio" name="useful_program" value="ì›Œí¬ìˆ">ì›Œí¬ìˆ ì„¸ì…˜</label>
            <label class="radio-item"><input type="radio" name="useful_program" value="ë ˆí¬ë ˆì´ì…˜">ë ˆí¬ë ˆì´ì…˜</label>
            <label class="radio-item"><input type="radio" name="useful_program" value="ê¸°íƒ€">ê¸°íƒ€</label>
          </div>
        </div>
        <div class="form-group">
          <label>3. ê°œì„ ì‚¬í•­ ë° ì˜ê²¬</label>
          <textarea id="feedback" rows="4" placeholder="ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”"></textarea>
        </div>
        <button class="btn btn-primary" id="submitSurveyBtn">ì„¤ë¬¸ ì œì¶œ</button>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
  <div id="adminModal" class="modal">
    <div class="modal-content" style="max-width:800px;">
      <div class="modal-header">
        <h2>ğŸ›¡ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
        <button class="close-btn" data-close="adminModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="stats-grid" style="grid-template-columns:repeat(4,1fr);">
          <div class="stat-card"><div class="stat-number" id="adminTotal">0</div><div class="stat-label">ì´ ì°¸ê°€ì</div></div>
          <div class="stat-card"><div class="stat-number" id="adminOnline">0</div><div class="stat-label">í˜„ì¬ ì ‘ì†</div></div>
          <div class="stat-card"><div class="stat-number" id="adminSurveys">0</div><div class="stat-label">ì„¤ë¬¸ ì™„ë£Œ</div></div>
          <div class="stat-card"><div class="stat-number" id="adminLinks">0</div><div class="stat-label">ì €ì¥ ë§í¬</div></div>
        </div>
        <h3 style="margin-top:2rem;">ì°¸ê°€ì ëª©ë¡</h3>
        <div id="participantsList" style="max-height:300px;overflow-y:auto;">
          <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        <h3 style="margin-top:2rem;">ìµœê·¼ í™œë™ ë¡œê·¸</h3>
        <div id="activityLog" style="max-height:200px;overflow-y:auto;background:var(--surface-elevated);padding:1rem;border-radius:12px;">
          <div class="loading">ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        <div style="margin-top:2rem;display:flex;gap:1rem;">
          <button class="btn btn-primary" id="exportBtn">ğŸ“Š ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn btn-secondary" id="refreshBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***** í™˜ê²½ì„¤ì •: ë°°í¬í•œ ì›¹ ì•± URLì„ ë„£ìœ¼ì„¸ìš” *****/
    const API_URL = 'https://script.google.com/macros/s/AKfycbxP7oI1CUK7vvga2HJbUp6r_U5bOsFWwFzcIAhIrRjKfCbUf7Mwlu56Ayqa3EokUJXz/exec';

    /***** ì „ì—­ ìƒíƒœ *****/
    let currentUser = null;
    let sessionId = null;
    let workshopStartTime = null;
    let timerInterval = null;

    const TEMP_USER_DATA = {
      "ë‚¨ë„í˜„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€", position:"ì´ì‚¬" },
      "ê¹€ìˆ˜ì¸": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 1íŒ€", position:"íŒ€ì¥" },
      "ê³ ë‹¤í˜„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 1íŒ€", position:"ì‚¬ì›" },
      "ì‹¬ì¬í¬": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 1íŒ€", position:"ë§¤ë‹ˆì €" },
      "íŒí‹°ë‹ˆì•ˆ": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 1íŒ€", position:"ë§¤ë‹ˆì €" },
      "ê¹€í˜„ì² ": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"íŒ€ì¥" },
      "ì´ìœ ì§„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"ì‚¬ì›" },
      "ì •ì–´ì§„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"ì‚¬ì›" },
      "ì¥ì›ì¤€": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"ì‚¬ì›" },
      "ê¹€ëŒ€ì§„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"íŒ€ì¥" },
      "ì†í˜„ìš°": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"ëŒ€ë¦¬" },
      "ì´ì£¼ì•„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"ì£¼ì„" },
      "ì¥ì€ì§„": { team:"íˆ¬ì–´íŒ¨ìŠ¤ì‚¬ì—…ë¶€ ì˜ì—… 2íŒ€", position:"ì£¼ì„" }
    };

    /***** ê³µí†µ ìœ í‹¸ *****/
    function escapeHtml(s=''){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;')}
    function escapeAttr(s=''){return escapeHtml(s).replaceAll(' ','%20')}

    function showAlert(message, type) {
      const alert = document.getElementById('alertMessage');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      alert.classList.remove('hidden');
      setTimeout(() => alert.classList.add('hidden'), 3000);
    }

    /***** API ìš”ì²­ (CORS ëŒ€ì‘) *****/
    async function apiRequest(action, data = {}) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' }, // preflight íšŒí”¼
          body: JSON.stringify({ action, sessionId, ...data })
        });
        if (!response.ok) return { success: false, error: `HTTP ${response.status}` };
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('API ì˜¤ë¥˜:', error);
        return { success: false, error: error.message };
      }
    }

    /***** ë¡œê·¸ì¸ *****/
    async function handleLogin() {
      const userName = document.getElementById('userName').value;
      const userMBTI = document.getElementById('userMBTI').value;
      if (!userName || !userMBTI) {
        showAlert('ì´ë¦„ê³¼ MBTIë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
        return;
      }
      currentUser = userName;
      sessionId = 'session_' + Date.now();
      const userInfo = TEMP_USER_DATA[userName];

      const res = await apiRequest('login', {
        userName, mbti: userMBTI, team: userInfo.team, position: userInfo.position
      });
      if (!res.success) {
        showAlert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (res.error || ''), 'error');
        return;
      }

      localStorage.setItem('currentUser', userName);
      localStorage.setItem('userMBTI', userMBTI);
      localStorage.setItem('sessionId', sessionId);

      showMainScreen();
      showAlert('í™˜ì˜í•©ë‹ˆë‹¤, ' + userName + 'ë‹˜!', 'success');
    }

    function showMainScreen() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainScreen').classList.remove('hidden');

      const userInfo = TEMP_USER_DATA[currentUser];
      document.getElementById('userNameDisplay').innerHTML = escapeHtml(currentUser);
      document.getElementById('userTeamDisplay').textContent = `${userInfo.team} | ${userInfo.position}`;

      // ê´€ë¦¬ì ë°°ì§€ + ë©”ë‰´
      if (currentUser === 'ê¹€í˜„ì² ') addAdminMenu();

      workshopStartTime = new Date('2025-01-17T15:00:00');
      startTimer();
    }

    function addAdminMenu() {
      const menuGrid = document.querySelector('.menu-grid');
      if (document.getElementById('adminMenu')) return;
      const adminMenu = document.createElement('div');
      adminMenu.className = 'menu-item';
      adminMenu.id = 'adminMenu';
      adminMenu.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
      adminMenu.innerHTML = `<div class="menu-title" style="color:#fff;">ê´€ë¦¬ì</div><div class="menu-desc" style="color:#fff;">ì „ì²´ ê´€ë¦¬</div>`;
      menuGrid.appendChild(adminMenu);

      const nameDisplay = document.getElementById('userNameDisplay');
      nameDisplay.innerHTML += ' <span style="background: var(--accent-warm); color: white; padding: 0.25rem 0.5rem; border-radius: 8px; font-size: 0.75rem; margin-left: 0.5rem;">ê´€ë¦¬ì</span>';

      adminMenu.addEventListener('click', openAdminDashboard);
    }

    /***** íƒ€ì´ë¨¸ *****/
    function startTimer() {
      const updateTimer = () => {
        const now = new Date();
        const end = new Date(workshopStartTime);
        end.setHours(end.getHours() + 48);
        const remaining = end - now;
        const display = document.getElementById('timerDisplay');

        if (remaining <= 0) {
          display.textContent = 'ì¢…ë£Œë¨';
          clearInterval(timerInterval);
          return;
        }
        const hours = Math.floor(remaining / (1000*60*60));
        const minutes = Math.floor((remaining % (1000*60*60)) / (1000*60));
        const seconds = Math.floor((remaining % (1000*60)) / 1000);
        display.textContent =
          `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
      };
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
    }

    /***** MBTI í†µê³„ *****/
    async function loadMBTIStats() {
      document.getElementById('mbtiModal').style.display = 'block';
      const res = await apiRequest('getMBTIStats');
      if (!res.success) {
        showAlert('í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤', 'error');
        return;
      }
      document.getElementById('totalParticipants').textContent = res.totalParticipants || 0;
      document.getElementById('onlineCount').textContent = res.onlineUsers || 0;

      const mbtiGrid = document.getElementById('mbtiDistribution');
      mbtiGrid.innerHTML = '';
      const allMBTI = ['INTJ','INTP','ENTJ','ENTP','INFJ','INFP','ENFJ','ENFP','ISTJ','ISFJ','ESTJ','ESFJ','ISTP','ISFP','ESTP','ESFP'];
      allMBTI.forEach(type => {
        const count = (res.mbtiDistribution && res.mbtiDistribution[type]) || 0;
        const item = document.createElement('div');
        item.className = 'mbti-item';
        if (count > 0) { item.style.background = 'rgba(59,130,246,.1)'; item.style.borderColor = 'var(--secondary-brand)'; }
        item.innerHTML = `<div class="mbti-type">${type}</div><div class="mbti-count">${count}</div>`;
        mbtiGrid.appendChild(item);
      });
    }

    /***** ë§í¬ ì €ì¥/ì¡°íšŒ *****/
    async function saveLink() {
      const title = document.getElementById('linkTitle').value.trim();
      const url = document.getElementById('linkUrl').value.trim();
      const category = document.getElementById('linkCategory').value;
      const description = document.getElementById('linkDescription').value.trim();

      if (!title || !url) {
        showAlert('ì œëª©ê³¼ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }
      const res = await apiRequest('saveLink', { user: currentUser, title, url, category, description });
      if (!res.success) {
        showAlert('ë§í¬ ì €ì¥ ì‹¤íŒ¨: ' + (res.error || ''), 'error');
        return;
      }
      showAlert('ë§í¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      document.getElementById('linkTitle').value = '';
      document.getElementById('linkUrl').value = '';
      document.getElementById('linkDescription').value = '';
      loadLinks();
    }

    async function loadLinks() {
      const linksList = document.getElementById('linksList');
      linksList.innerHTML = '<div class="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
      const res = await apiRequest('getLinks', { user: currentUser });
      if (!res.success) {
        linksList.innerHTML = '<p style="text-align:center;color:var(--error);">ë§í¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
        return;
      }
      const links = res.items || [];
      if (links.length === 0) {
        linksList.innerHTML = '<p style="text-align:center;color:var(--text-muted);">ì €ì¥ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
        return;
      }
      linksList.innerHTML = links.map(link => `
        <div class="card" style="margin-bottom:1rem;">
          <strong>${escapeHtml(link.title)}</strong><br>
          <a href="${escapeAttr(link.url)}" target="_blank" style="color: var(--secondary-brand);">${escapeHtml(link.url)}</a><br>
          <small style="color: var(--text-secondary);">${escapeHtml(link.category || '')}</small>
          ${link.description ? `<br><small>${escapeHtml(link.description)}</small>` : ''}
        </div>
      `).join('');
    }

    /***** ì„¤ë¬¸ *****/
    async function submitSurvey() {
      const satisfaction = document.querySelector('input[name="satisfaction"]:checked');
      const useful_program = document.querySelector('input[name="useful_program"]:checked');
      const feedback = document.getElementById('feedback').value;
      if (!satisfaction || !useful_program) {
        showAlert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
        return;
      }
      const res = await apiRequest('saveSurvey', {
        user: currentUser,
        satisfaction: satisfaction.value,
        useful_program: useful_program.value,
        feedback
      });
      if (!res.success) {
        showAlert('ì„¤ë¬¸ ì œì¶œ ì‹¤íŒ¨: ' + (res.error || ''), 'error');
        return;
      }
      showAlert('ì„¤ë¬¸ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!', 'success');
      document.getElementById('surveyModal').style.display = 'none';
    }

    /***** ê´€ë¦¬ì *****/
    async function openAdminDashboard() {
      document.getElementById('adminModal').style.display = 'block';
      await loadAdminData();
    }

    async function loadAdminData() {
      // ê°„ë‹¨ ì§‘ê³„: ì„œë²„ í†µê³„ + í˜„ì¬ ì‚¬ìš©ì í‘œê¸°
      const stats = await apiRequest('getMBTIStats');
      document.getElementById('adminTotal').textContent = stats.success ? (stats.totalParticipants||0) : '0';
      document.getElementById('adminOnline').textContent = stats.success ? (stats.onlineUsers||0) : '0';

      // ì„¤ë¬¸/ë§í¬ ìˆ˜ëŠ” ê°„ë‹¨ í‘œì‹œ(í•„ìš”ì‹œ ë³„ë„ API í™•ì¥)
      document.getElementById('adminSurveys').textContent = 'â€”';
      document.getElementById('adminLinks').textContent = 'â€”';

      const participantsList = document.getElementById('participantsList');
      participantsList.innerHTML = `
        <table style="width:100%;border-collapse:collapse;">
          <thead>
            <tr style="background:var(--surface-elevated);">
              <th style="padding:.5rem;text-align:left;">ì´ë¦„</th>
              <th style="padding:.5rem;text-align:left;">íŒ€</th>
              <th style="padding:.5rem;text-align:left;">MBTI</th>
              <th style="padding:.5rem;text-align:left;">ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:.5rem;">${escapeHtml(currentUser)}</td>
              <td style="padding:.5rem;">${escapeHtml(TEMP_USER_DATA[currentUser].team)}</td>
              <td style="padding:.5rem;">${escapeHtml(localStorage.getItem('userMBTI')||'')}</td>
              <td style="padding:.5rem;"><span style="color: var(--success);">â—</span> ì˜¨ë¼ì¸</td>
            </tr>
          </tbody>
        </table>
      `;

      const activityLog = document.getElementById('activityLog');
      const now = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
      activityLog.innerHTML = `
        <div style="padding:.5rem 0;border-bottom:1px solid #e2e8f0;">
          <span style="color:var(--text-muted);margin-right:1rem;">${now}</span>
          <strong>${escapeHtml(currentUser)}</strong> ë‹˜ì´ ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤
        </div>
      `;
    }

    function exportData() { showAlert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'success'); }
    function refreshAdminData() { loadAdminData(); showAlert('ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤', 'success'); }

    /***** ì´ë²¤íŠ¸ ë°”ì¸ë”© *****/
    function setupEnterKeyLogin() {
      const selects = document.querySelectorAll('#loginScreen select');
      selects.forEach(el => el.addEventListener('keypress', e => { if (e.key === 'Enter') handleLogin(); }));
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupEnterKeyLogin();
      document.getElementById('loginBtn').addEventListener('click', handleLogin);
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (!currentUser) return location.reload();
        if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          await apiRequest('updateUserStatus', { userName: currentUser, status: 'offline' });
          localStorage.clear();
          location.reload();
        }
      });
      document.getElementById('mbtiMenu').addEventListener('click', loadMBTIStats);
      document.getElementById('scheduleMenu').addEventListener('click', () => { document.getElementById('scheduleModal').style.display = 'block'; });
      document.getElementById('linkMenu').addEventListener('click', () => { document.getElementById('linkModal').style.display = 'block'; loadLinks(); });
      document.getElementById('surveyMenu').addEventListener('click', () => { document.getElementById('surveyModal').style.display = 'block'; });
      document.getElementById('saveLinkBtn').addEventListener('click', saveLink);
      document.getElementById('submitSurveyBtn').addEventListener('click', submitSurvey);
      document.getElementById('exportBtn')?.addEventListener('click', exportData);
      document.getElementById('refreshBtn')?.addEventListener('click', refreshAdminData);

      document.querySelectorAll('.close-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const targetId = this.getAttribute('data-close');
          if (targetId) document.getElementById(targetId).style.display = 'none';
          else this.closest('.modal').style.display = 'none';
        });
      });
      window.addEventListener('click', e => {
        if (e.target.classList && e.target.classList.contains('modal')) e.target.style.display = 'none';
      });

      // ì„¸ì…˜ ë³µì›
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = savedUser;
        sessionId = localStorage.getItem('sessionId');
        document.getElementById('mainScreen').classList.remove('hidden');
        document.getElementById('loginScreen').classList.add('hidden');
        const userInfo = TEMP_USER_DATA[currentUser];
        document.getElementById('userNameDisplay').textContent = currentUser;
        document.getElementById('userTeamDisplay').textContent = `${userInfo.team} | ${userInfo.position}`;
        if (currentUser === 'ê¹€í˜„ì² ') addAdminMenu();
        workshopStartTime = new Date('2025-01-17T15:00:00');
        startTimer();
      }
    });
  </script>
</body>
</html>
